(window.webpackJsonp=window.webpackJsonp||[]).push([[321],{1859:function(e,t,s){"use strict";s.r(t);var i=s(325),n=s(327),r=s(349),o=s.n(r),a=s(2),l=s(335),p=s(31),c=s(497),m=s(955),u=(s(757),s(351)),d=s.n(u),h=s(765),g=s(759),b=s(431);class f extends a.PureComponent{constructor(){super(...arguments),this.handleToggleUser=(e,t)=>e.permissions.includes(t)?this.props.revokePermissionFromUser(e.login,t):this.props.grantPermissionToUser(e.login,t),this.handleToggleGroup=(e,t)=>e.permissions.includes(t)?this.props.revokePermissionFromGroup(e.name,t):this.props.grantPermissionToGroup(e.name,t),this.handleSelectPermission=e=>{this.props.onPermissionSelect(e)}}render(){const{filter:e,groups:t,groupsPaging:s,users:i,usersPaging:n}=this.props;let r=b.a[this.props.component.qualifier];"public"===this.props.visibility&&(r=o()(r,"user","codeviewer"));const l=Object(b.d)(r,"projects_role");let p=0,c=0;return"users"!==e&&(p+=t.length,c+=s?s.total:t.length),"groups"!==e&&(p+=i.length,c+=n?n.total:i.length),a.createElement(a.Fragment,null,a.createElement(h.a,{filter:this.props.filter,groups:this.props.groups,onSelectPermission:this.handleSelectPermission,onToggleGroup:this.handleToggleGroup,onToggleUser:this.handleToggleUser,permissions:l,query:this.props.query,selectedPermission:this.props.selectedPermission,users:this.props.users},a.createElement(g.a,{filter:this.props.filter,onFilter:this.props.onFilterChange,onSearch:this.props.onQueryChange,query:this.props.query})),a.createElement(d.a,{count:p,loadMore:this.props.onLoadMore,total:c}))}}var y=s(312),P=s(337),j=s(956);class v extends a.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={applyTemplateModal:!1},this.handleApplyTemplate=()=>{this.setState({applyTemplateModal:!0})},this.handleApplyTemplateClose=()=>{this.mounted&&this.setState({applyTemplateModal:!1})}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{component:e}=this.props,{configuration:t}=e,s=null!=t&&t.canApplyPermissionTemplate;let i=Object(p.translate)("roles.page.description2");Object(P.e)(e.qualifier)?i=Object(p.translate)("roles.page.description_portfolio"):Object(P.d)(e.qualifier)&&(i=Object(p.translate)("roles.page.description_application"));const n="TRK"===e.qualifier&&e.visibility?Object(p.translate)("visibility",e.visibility,"description",e.qualifier):void 0;return a.createElement("header",{className:"page-header"},a.createElement("h1",{className:"page-title"},Object(p.translate)("permissions.page")),this.props.loading&&a.createElement("i",{className:"spinner"}),s&&a.createElement("div",{className:"page-actions"},a.createElement(y.Button,{className:"js-apply-template",onClick:this.handleApplyTemplate},Object(p.translate)("projects_role.apply_template")),this.state.applyTemplateModal&&a.createElement(j.a,{onApply:this.props.loadHolders,onClose:this.handleApplyTemplateClose,project:e})),a.createElement("div",{className:"page-description"},a.createElement("p",null,i),n&&a.createElement("p",null,n)))}}var O=s(358),E=s.n(O),_=s(322);function C({component:e,onClose:t,onConfirm:s}){const{qualifier:i}=e;return a.createElement(E.a,{confirmButtonText:Object(p.translate)("projects_role.turn_project_to_public",i),header:Object(p.translateWithParameters)("projects_role.turn_x_to_public",e.name),onClose:t,onConfirm:s},a.createElement(_.Alert,{variant:"warning"},Object(p.translate)("projects_role.are_you_sure_to_turn_project_to_public.warning",i)),a.createElement("p",null,Object(p.translate)("projects_role.are_you_sure_to_turn_project_to_public",i)))}function k(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function S(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?k(Object(s),!0).forEach((function(t){T(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):k(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function T(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class N extends a.PureComponent{constructor(e){super(e),this.mounted=!1,this.stopLoading=()=>{this.mounted&&this.setState({loading:!1})},this.loadUsersAndGroups=(e,t)=>{const{component:s}=this.props,{filter:i,query:n,selectedPermission:r}=this.state,o="groups"!==i?c.n({projectKey:s.key,q:n||void 0,permission:r,p:e}):Promise.resolve({paging:void 0,users:[]}),a="users"!==i?c.m({projectKey:s.key,q:n||void 0,permission:r,p:t}):Promise.resolve({paging:void 0,groups:[]});return Promise.all([o,a])},this.loadHolders=()=>(this.setState({loading:!0}),this.loadUsersAndGroups().then(([e,t])=>{this.mounted&&this.setState({groups:t.groups,groupsPaging:t.paging,loading:!1,users:e.users,usersPaging:e.paging})},this.stopLoading)),this.onLoadMore=()=>{const{usersPaging:e,groupsPaging:t}=this.state;return this.setState({loading:!0}),this.loadUsersAndGroups(e?e.pageIndex+1:1,t?t.pageIndex+1:1).then(([e,t])=>{this.mounted&&this.setState(({groups:s,users:i})=>({groups:[...s,...t.groups],groupsPaging:t.paging,loading:!1,users:[...i,...e.users],usersPaging:e.paging}))},this.stopLoading)},this.handleFilterChange=e=>{this.mounted&&this.setState({filter:e},this.loadHolders)},this.handleQueryChange=e=>{this.mounted&&this.setState({query:e},this.loadHolders)},this.handlePermissionSelect=e=>{this.mounted&&this.setState(t=>({selectedPermission:t.selectedPermission===e?void 0:e}),this.loadHolders)},this.addPermissionToGroup=(e,t)=>this.state.groups.map(s=>s.name===e?S({},s,{permissions:[...s.permissions,t]}):s),this.addPermissionToUser=(e,t)=>this.state.users.map(s=>s.login===e?S({},s,{permissions:[...s.permissions,t]}):s),this.removePermissionFromGroup=(e,t)=>this.state.groups.map(s=>s.name===e?S({},s,{permissions:o()(s.permissions,t)}):s),this.removePermissionFromUser=(e,t)=>this.state.users.map(s=>s.login===e?S({},s,{permissions:o()(s.permissions,t)}):s),this.grantPermissionToGroup=(e,t)=>this.mounted?(this.setState({loading:!0,groups:this.addPermissionToGroup(e,t)}),c.o({projectKey:this.props.component.key,groupName:e,permission:t}).then(this.stopLoading,()=>{this.mounted&&this.setState({loading:!1,groups:this.removePermissionFromGroup(e,t)})})):Promise.resolve(),this.grantPermissionToUser=(e,t)=>this.mounted?(this.setState({loading:!0,users:this.addPermissionToUser(e,t)}),c.p({projectKey:this.props.component.key,login:e,permission:t}).then(this.stopLoading,()=>{this.mounted&&this.setState({loading:!1,users:this.removePermissionFromUser(e,t)})})):Promise.resolve(),this.revokePermissionFromGroup=(e,t)=>this.mounted?(this.setState({loading:!0,groups:this.removePermissionFromGroup(e,t)}),c.t({projectKey:this.props.component.key,groupName:e,permission:t}).then(this.stopLoading,()=>{this.mounted&&this.setState({loading:!1,groups:this.addPermissionToGroup(e,t)})})):Promise.resolve(),this.revokePermissionFromUser=(e,t)=>this.mounted?(this.setState({loading:!0,users:this.removePermissionFromUser(e,t)}),c.u({projectKey:this.props.component.key,login:e,permission:t}).then(this.stopLoading,()=>{this.mounted&&this.setState({loading:!1,users:this.addPermissionToUser(e,t)})})):Promise.resolve(),this.handleVisibilityChange=e=>{"public"===e?this.openDisclaimer():this.turnProjectToPrivate()},this.turnProjectToPublic=()=>{this.props.onComponentChange({visibility:"public"}),c.e(this.props.component.key,"public").then(()=>{this.loadHolders()},()=>{this.props.onComponentChange({visibility:"private"})})},this.turnProjectToPrivate=()=>{this.props.onComponentChange({visibility:"private"}),c.e(this.props.component.key,"private").then(()=>{this.loadHolders()},()=>{this.props.onComponentChange({visibility:"public"})})},this.openDisclaimer=()=>{this.mounted&&this.setState({disclaimer:!0})},this.closeDisclaimer=()=>{this.mounted&&this.setState({disclaimer:!1})},this.state={disclaimer:!1,filter:"all",groups:[],loading:!0,query:"",users:[]}}componentDidMount(){this.mounted=!0,this.loadHolders()}componentWillUnmount(){this.mounted=!1}render(){const{component:e}=this.props,t=e.configuration&&e.configuration.canUpdateProjectVisibilityToPrivate;return a.createElement("div",{className:"page page-limited",id:"project-permissions-page"},a.createElement(l.a,{defer:!1,title:Object(p.translate)("permissions.page")}),a.createElement(v,{component:e,loadHolders:this.loadHolders,loading:this.state.loading}),a.createElement("div",null,a.createElement(m.a,{canTurnToPrivate:t,className:"big-spacer-top big-spacer-bottom",onChange:this.handleVisibilityChange,visibility:e.visibility}),this.state.disclaimer&&a.createElement(C,{component:e,onClose:this.closeDisclaimer,onConfirm:this.turnProjectToPublic})),a.createElement(f,{component:e,filter:this.state.filter,grantPermissionToGroup:this.grantPermissionToGroup,grantPermissionToUser:this.grantPermissionToUser,groups:this.state.groups,groupsPaging:this.state.groupsPaging,onFilterChange:this.handleFilterChange,onLoadMore:this.onLoadMore,onPermissionSelect:this.handlePermissionSelect,onQueryChange:this.handleQueryChange,query:this.state.query,revokePermissionFromGroup:this.revokePermissionFromGroup,revokePermissionFromUser:this.revokePermissionFromUser,selectedPermission:this.state.selectedPermission,users:this.state.users,usersPaging:this.state.usersPaging,visibility:e.visibility}))}}t.default=Object(i.b)(e=>({currentUser:Object(n.getCurrentUser)(e)}))(N)},431:function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return l})),s.d(t,"a",(function(){return c})),s.d(t,"e",(function(){return u})),s.d(t,"d",(function(){return d})),s.d(t,"f",(function(){return h}));var i=s(31),n=s(6);function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function o(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const a=["user","codeviewer","issueadmin","securityhotspotadmin","admin","scan"],l=["admin",{category:"administer",permissions:["gateadmin","profileadmin"]},"scan",{category:"creator",permissions:["provisioning","applicationcreator","portfoliocreator"]}],p=["user","admin"],c={TRK:a,VW:p,SVW:p,APP:p,DEV:["user","admin"]};function m(e,t){const s=e=>{const t="".concat(e,".sonarcloud");return Object(n.isSonarCloud)()&&Object(i.hasMessage)(t)?Object(i.translate)(t):Object(i.translate)(e)};return{key:e,name:s("".concat(t,".").concat(e)),description:s("".concat(t,".").concat(e,".desc"))}}function u(e,t,s){return e.map(e=>"object"==typeof e&&"creator"===e.category?function(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){o(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}({},e,{permissions:e.permissions.filter(e=>"provisioning"===e||"portfoliocreator"===e&&s||"applicationcreator"===e&&t)}):e)}function d(e,t){return e.map(e=>"object"==typeof e?{category:e.category,permissions:e.permissions.map(e=>m(e,t))}:m(e,t))}function h(e){return Boolean(e&&e.category)}},497:function(e,t,s){"use strict";s.d(t,"p",(function(){return r})),s.d(t,"u",(function(){return o})),s.d(t,"o",(function(){return a})),s.d(t,"t",(function(){return l})),s.d(t,"l",(function(){return p})),s.d(t,"f",(function(){return c})),s.d(t,"y",(function(){return m})),s.d(t,"g",(function(){return u})),s.d(t,"x",(function(){return d})),s.d(t,"b",(function(){return h})),s.d(t,"c",(function(){return g})),s.d(t,"r",(function(){return b})),s.d(t,"w",(function(){return f})),s.d(t,"q",(function(){return y})),s.d(t,"v",(function(){return P})),s.d(t,"a",(function(){return j})),s.d(t,"s",(function(){return v})),s.d(t,"n",(function(){return O})),s.d(t,"m",(function(){return E})),s.d(t,"i",(function(){return _})),s.d(t,"h",(function(){return C})),s.d(t,"k",(function(){return k})),s.d(t,"j",(function(){return S})),s.d(t,"e",(function(){return T})),s.d(t,"d",(function(){return N}));var i=s(9),n=s(324);function r(e){return Object(i.post)("/api/permissions/add_user",e).catch(n.a)}function o(e){return Object(i.post)("/api/permissions/remove_user",e).catch(n.a)}function a(e){return Object(i.post)("/api/permissions/add_group",e).catch(n.a)}function l(e){return Object(i.post)("/api/permissions/remove_group",e).catch(n.a)}function p(){return Object(i.getJSON)("/api/permissions/search_templates")}function c(e){return Object(i.postJSON)("/api/permissions/create_template",e)}function m(e){return Object(i.post)("/api/permissions/update_template",e)}function u(e){return Object(i.post)("/api/permissions/delete_template",e).catch(n.a)}function d(e,t){return Object(i.post)("/api/permissions/set_default_template",{templateId:e,qualifier:t})}function h(e){return Object(i.post)("/api/permissions/apply_template",e).catch(n.a)}function g(e){return Object(i.post)("/api/permissions/bulk_apply_template",e)}function b(e){return Object(i.post)("/api/permissions/add_user_to_template",e)}function f(e){return Object(i.post)("/api/permissions/remove_user_from_template",e)}function y(e){return Object(i.post)("/api/permissions/add_group_to_template",e)}function P(e){return Object(i.post)("/api/permissions/remove_group_from_template",e)}function j(e,t){return Object(i.post)("/api/permissions/add_project_creator_to_template",{templateId:e,permission:t})}function v(e,t){return Object(i.post)("/api/permissions/remove_project_creator_from_template",{templateId:e,permission:t})}function O(e){return e.ps||(e.ps=100),Object(i.getJSON)("/api/permissions/users",e).catch(n.a)}function E(e){return e.ps||(e.ps=100),Object(i.getJSON)("/api/permissions/groups",e).catch(n.a)}function _(e){return e.ps||(e.ps=100),Object(i.getJSON)("/api/permissions/users",e)}function C(e){return e.ps||(e.ps=100),Object(i.getJSON)("/api/permissions/groups",e)}function k(e,t,s){const n={templateId:e,ps:100};return t&&(n.q=t),s&&(n.permission=s),Object(i.getJSON)("/api/permissions/template_users",n).then(e=>e.users)}function S(e,t,s){const n={templateId:e,ps:100};return t&&(n.q=t),s&&(n.permission=s),Object(i.getJSON)("/api/permissions/template_groups",n).then(e=>e.groups)}function T(e,t){return Object(i.post)("/api/projects/update_visibility",{project:e,visibility:t}).catch(n.a)}function N(e){return Object(i.post)("/api/projects/update_default_visibility",{projectVisibility:e}).catch(n.a)}},757:function(e,t,s){var i=s(313),n=s(758);"string"==typeof(n=n.__esModule?n.default:n)&&(n=[[e.i,n,""]]);var r={insert:"head",singleton:!1},o=(i(n,r),n.locals?n.locals:{});e.exports=o},758:function(e,t,s){(t=s(314)(!1)).push([e.i,'.permissions-table .permission-column.selected{background-color:#d9edf7}.permissions-table .permission-column-inner{width:90px}.permissions-table .divider{background:#fff;padding:16px 0}.permissions-table .divider:after{display:block;content:"";background:#e6e6e6;height:1px;width:100%}.permissions-table td:first-of-type{max-width:320px}',""]),e.exports=t},759:function(e,t,s){"use strict";s.d(t,"a",(function(){return p}));var i=s(2),n=s(397),r=s.n(n),o=s(355),a=s.n(o),l=s(31);function p(e){const t=[{value:"all",label:Object(l.translate)("all")},{value:"users",label:Object(l.translate)("users.page")},{value:"groups",label:Object(l.translate)("user_groups.page")}];return i.createElement("div",{className:"display-flex-row"},i.createElement(r.a,{name:"users-or-groups",onCheck:e.onFilter,options:t,value:e.filter}),i.createElement("div",{className:"flex-1 spacer-left"},i.createElement(a.a,{minLength:3,onChange:e.onSearch,placeholder:Object(l.translate)("search.search_for_users_or_groups"),value:e.query})))}},765:function(e,t,s){"use strict";s.d(t,"a",(function(){return x}));var i=s(330),n=s.n(i),r=s(502),o=s.n(r),a=s(2),l=s(31),p=s(431),c=s(349),m=s.n(c),u=s(619),d=s.n(u),h=s(311),g=s(338),b=s.n(g);class f extends a.PureComponent{render(){const{loading:e,onCheck:t,permission:s,permissionItem:i,selectedPermission:n}=this.props;return Object(p.f)(s)?a.createElement("td",{className:"text-middle"},s.permissions.map(s=>a.createElement("div",{key:s.key},a.createElement(b.a,{checked:i.permissions.includes(s.key),disabled:e.includes(s.key),id:s.key,onCheck:t},a.createElement("span",{className:"little-spacer-left"},s.name))))):a.createElement("td",{className:h("permission-column text-center text-middle",{selected:s.key===n})},a.createElement(b.a,{checked:i.permissions.includes(s.key),disabled:e.includes(s.key),id:s.key,onCheck:t}))}}class y extends a.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={loading:[]},this.stopLoading=e=>{this.mounted&&this.setState(t=>({loading:m()(t.loading,e)}))},this.handleCheck=(e,t)=>{void 0!==t&&(this.setState(e=>({loading:[...e.loading,t]})),this.props.onToggle(this.props.group,t).then(()=>this.stopLoading(t),()=>this.stopLoading(t)))}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{group:e}=this.props;return a.createElement("tr",null,a.createElement("td",{className:"nowrap text-middle"},a.createElement("div",{className:"display-flex-center"},a.createElement(d.a,{className:"big-spacer-right"}),a.createElement("div",{className:"max-width-100"},a.createElement("div",{className:"max-width-100 text-ellipsis"},a.createElement("strong",null,e.name)),a.createElement("div",{className:"little-spacer-top",style:{whiteSpace:"normal"}},e.description)))),this.props.permissions.map(t=>a.createElement(f,{key:Object(p.f)(t)?t.category:t.key,loading:this.state.loading,onCheck:this.handleCheck,permission:t,permissionItem:e,selectedPermission:this.props.selectedPermission})))}}var P=s(323),j=s.n(P),v=s(317),O=s.n(v),E=s(322),_=s(460);class C extends a.PureComponent{constructor(){super(...arguments),this.handlePermissionClick=e=>{e.preventDefault(),e.currentTarget.blur();const{permission:t}=this.props;this.props.onSelectPermission&&!Object(p.f)(t)&&this.props.onSelectPermission(t.key)},this.getTooltipOverlay=()=>{const{permission:e}=this.props;return Object(p.f)(e)?e.permissions.map(e=>a.createElement(a.Fragment,{key:e.key},a.createElement("b",{className:"little-spacer-right"},e.name,":"),a.createElement(_.a,{key:e.key,message:e.description}),a.createElement("br",null))):this.props.showPublicProjectsWarning&&["user","codeviewer"].includes(e.key)?a.createElement("div",null,a.createElement(_.a,{message:e.description}),a.createElement(E.Alert,{className:"spacer-top",variant:"warning"},Object(l.translate)("projects_role.public_projects_warning"))):a.createElement(_.a,{message:e.description})}}render(){const{onSelectPermission:e,permission:t}=this.props;let s;return s=Object(p.f)(t)?Object(l.translate)("global_permissions",t.category):e?a.createElement(O.a,{overlay:Object(l.translateWithParameters)("global_permissions.filter_by_x_permission",t.name)},a.createElement("a",{href:"#",onClick:this.handlePermissionClick},t.name)):t.name,a.createElement("th",{className:h("permission-column text-center text-middle",{selected:!Object(p.f)(t)&&t.key===this.props.selectedPermission})},a.createElement("div",{className:"permission-column-inner"},s,a.createElement(j.a,{className:"spacer-left",overlay:this.getTooltipOverlay()})))}}var k=s(389);class S extends a.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={loading:[]},this.stopLoading=e=>{this.mounted&&this.setState(t=>({loading:m()(t.loading,e)}))},this.handleCheck=(e,t)=>{void 0!==t&&(this.setState(e=>({loading:[...e.loading,t]})),this.props.onToggle(this.props.user,t).then(()=>this.stopLoading(t),()=>this.stopLoading(t)))}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{user:e}=this.props,t=this.props.permissions.map(t=>a.createElement(f,{key:Object(p.f)(t)?t.category:t.key,loading:this.state.loading,onCheck:this.handleCheck,permission:t,permissionItem:e,selectedPermission:this.props.selectedPermission}));return"<creator>"===e.login?a.createElement("tr",null,a.createElement("td",{className:"nowrap text-middle"},a.createElement("div",null,a.createElement("strong",null,e.name)),a.createElement("div",{className:"little-spacer-top",style:{whiteSpace:"normal"}},Object(l.translate)("permission_templates.project_creators.explanation"))),t):a.createElement("tr",null,a.createElement("td",{className:"nowrap text-middle"},a.createElement("div",{className:"display-flex-center"},a.createElement(k.a,{className:"text-middle big-spacer-right flex-0",hash:e.avatar,name:e.name,size:36}),a.createElement("div",{className:"max-width-100"},a.createElement("div",{className:"max-width-100 text-ellipsis"},a.createElement("strong",null,e.name),a.createElement("span",{className:"note spacer-left"},e.login)),a.createElement("div",{className:"little-spacer-top max-width-100 text-ellipsis"},e.email)))),t)}}function T(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,i)}return s}function N(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?T(Object(s),!0).forEach((function(t){w(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):T(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function w(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class x extends a.PureComponent{constructor(){super(...arguments),this.state={initialPermissionsCount:{}},this.handleGroupToggle=(e,t)=>{const s=e.id||e.name;return void 0===this.state.initialPermissionsCount[s]&&this.setState(t=>({initialPermissionsCount:N({},t.initialPermissionsCount,{[s]:e.permissions.length})})),this.props.onToggleGroup(e,t)},this.handleUserToggle=(e,t)=>(void 0===this.state.initialPermissionsCount[e.login]&&this.setState(t=>({initialPermissionsCount:N({},t.initialPermissionsCount,{[e.login]:e.permissions.length})})),this.props.onToggleUser(e,t)),this.getItemInitialPermissionsCount=e=>{const t=this.isPermissionUser(e)?e.login:e.id||e.name;return void 0!==this.state.initialPermissionsCount[t]?this.state.initialPermissionsCount[t]:e.permissions.length}}componentDidUpdate(e){this.props.filter===e.filter&&this.props.query===e.query||this.setState({initialPermissionsCount:{}})}isPermissionUser(e){return void 0!==e.login}renderEmpty(){const e=this.props.permissions.length+1;return a.createElement("tr",null,a.createElement("td",{colSpan:e},Object(l.translate)("no_results_search")))}renderItem(e,t){return this.isPermissionUser(e)?a.createElement(S,{key:"user-".concat(e.login),onToggle:this.handleUserToggle,permissions:t,selectedPermission:this.props.selectedPermission,user:e}):a.createElement(y,{group:e,key:"group-".concat(e.id||e.name),onToggle:this.handleGroupToggle,permissions:t,selectedPermission:this.props.selectedPermission})}render(){const{permissions:e}=this.props,t=n()([...this.props.users,...this.props.groups],e=>this.isPermissionUser(e)&&"<creator>"===e.login?0:e.name),[s,i]=o()(t,e=>this.getItemInitialPermissionsCount(e));return a.createElement("div",{className:"boxed-group boxed-group-inner"},a.createElement("table",{className:"data zebra permissions-table"},a.createElement("thead",null,a.createElement("tr",null,a.createElement("td",{className:"nowrap bordered-bottom"},this.props.children),e.map(e=>a.createElement(C,{key:Object(p.f)(e)?e.category:e.key,onSelectPermission:this.props.onSelectPermission,permission:e,selectedPermission:this.props.selectedPermission,showPublicProjectsWarning:this.props.showPublicProjectsWarning})))),a.createElement("tbody",null,0===t.length&&!this.props.loading&&this.renderEmpty(),s.map(t=>this.renderItem(t,e)),s.length>0&&i.length>0&&a.createElement(a.Fragment,null,a.createElement("tr",null,a.createElement("td",{className:"divider",colSpan:20})),a.createElement("tr",null)),i.map(t=>this.renderItem(t,e)))))}}},955:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var i=s(311),n=s(2),r=s(398),o=s.n(r),a=s(31);class l extends n.PureComponent{render(){return n.createElement("div",{className:i(this.props.className)},["public","private"].map(e=>n.createElement(o.a,{className:"huge-spacer-right visibility-".concat(e),key:e,value:e,checked:this.props.visibility===e,onCheck:this.props.onChange,disabled:"private"===e&&!this.props.canTurnToPrivate},n.createElement("div",null,Object(a.translate)("visibility",e),this.props.showDetails&&n.createElement("p",{className:"note"},Object(a.translate)("visibility",e,"description.long"))))))}}},956:function(e,t,s){"use strict";s.d(t,"a",(function(){return y}));var i=s(2),n=s(312),r=s(348),o=s.n(r),a=s(332),l=s.n(a),p=s(322),c=s(319),m=s.n(c),u=s(340),d=s.n(u),h=s(346),g=s.n(h),b=s(31),f=s(497);class y extends i.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={done:!1,loading:!0},this.fetchPermissionTemplates=()=>{Object(f.l)().then(({permissionTemplates:e})=>{this.mounted&&this.setState({loading:!1,permissionTemplates:e})},()=>{this.mounted&&this.setState({loading:!1})})},this.handleSubmit=()=>this.state.permissionTemplate?Object(f.b)({projectKey:this.props.project.key,templateId:this.state.permissionTemplate}).then(()=>{this.mounted&&(this.props.onApply&&this.props.onApply(),this.setState({done:!0}))}):Promise.reject(void 0),this.handlePermissionTemplateChange=({value:e})=>{this.setState({permissionTemplate:e})}}componentDidMount(){this.mounted=!0,this.fetchPermissionTemplates()}componentWillUnmount(){this.mounted=!1}render(){const e=Object(b.translateWithParameters)("projects_role.apply_template_to_xxx",this.props.project.name);return i.createElement(l.a,{header:e,onClose:this.props.onClose,onSubmit:this.handleSubmit,size:"small"},({onCloseClick:t,onFormSubmit:s,submitting:r})=>i.createElement("form",{id:"project-permissions-apply-template-form",onSubmit:s},i.createElement("header",{className:"modal-head"},i.createElement("h2",null,e)),i.createElement("div",{className:"modal-body"},this.state.done&&i.createElement(p.Alert,{variant:"success"},Object(b.translate)("projects_role.apply_template.success")),this.state.loading&&i.createElement("i",{className:"spinner"}),!this.state.done&&!this.state.loading&&i.createElement(i.Fragment,null,i.createElement(g.a,{className:"modal-field"}),i.createElement("div",{className:"modal-field"},i.createElement("label",{htmlFor:"project-permissions-template"},Object(b.translate)("template"),i.createElement(d.a,null)),this.state.permissionTemplates&&i.createElement(o.a,{clearable:!1,id:"project-permissions-template",onChange:this.handlePermissionTemplateChange,options:this.state.permissionTemplates.map(e=>({label:e.name,value:e.id})),value:this.state.permissionTemplate})))),i.createElement("footer",{className:"modal-foot"},i.createElement(m.a,{className:"spacer-right",loading:r}),!this.state.done&&i.createElement(n.SubmitButton,{disabled:r||!this.state.permissionTemplate},Object(b.translate)("apply")),i.createElement(n.ResetButtonLink,{onClick:t},Object(b.translate)(this.state.done?"close":"cancel")))))}}}}]);
//# sourceMappingURL=321.m.775bbdee.chunk.js.map