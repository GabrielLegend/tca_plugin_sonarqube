{"version":3,"sources":["webpack:///./node_modules/lodash/noop.js","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/ComponentSourceSnippetGroupViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/CrossComponentSourceViewerWrapper.tsx","webpack:///./node_modules/sonar-ui-common/components/controls/ActionsDropdown.js","webpack:///./node_modules/sonar-ui-common/components/icons/SettingsIcon.js","webpack:///./node_modules/lodash/groupBy.js","webpack:///./node_modules/lodash/toInteger.js","webpack:///./node_modules/lodash/_baseFindIndex.js","webpack:///./node_modules/lodash/findLastIndex.js","webpack:///./src/main/js/components/SourceViewer/helpers/indexing.ts","webpack:///./src/main/js/components/SourceViewer/helpers/highlight.ts","webpack:///./src/main/js/components/SourceViewer/helpers/issueLocations.ts","webpack:///./src/main/js/components/SourceViewer/SourceViewerContext.tsx","webpack:///./node_modules/lodash/intersection.js","webpack:///./node_modules/sonar-ui-common/components/icons/ExpandSnippetIcon.js","webpack:///./node_modules/lodash/_baseIntersection.js","webpack:///./node_modules/lodash/_castArrayLikeObject.js","webpack:///./src/main/js/components/SourceViewer/SourceViewerHeaderSlim.tsx","webpack:///./src/main/js/components/SourceViewer/SourceViewerHeaderSlim.css?94e1","webpack:///./src/main/js/components/SourceViewer/SourceViewerHeaderSlim.css","webpack:///./node_modules/lodash/times.js","webpack:///./src/main/js/components/SourceViewer/components/Line.css?69c4","webpack:///./src/main/js/components/SourceViewer/components/Line.css","webpack:///./src/main/js/components/SourceViewer/helpers/lines.ts","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/utils.ts","webpack:///./src/main/js/components/SourceViewer/components/LineIssuesList.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineCode.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineCoverage.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineDuplicationBlock.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineIssuesIndicator.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineOptionsPopup.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineNumber.tsx","webpack:///./src/main/js/components/SourceViewer/components/SCMPopup.tsx","webpack:///./src/main/js/components/SourceViewer/components/LineSCM.tsx","webpack:///./src/main/js/components/SourceViewer/components/Line.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.tsx","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css?ff37","webpack:///./src/main/js/apps/issues/crossComponentSourceViewer/SnippetViewer.css","webpack:///./src/main/js/components/SourceViewer/components/DuplicationPopup.tsx","webpack:///./src/main/js/components/SourceViewer/helpers/duplications.ts"],"names":["module","exports","mounted","rootNodeRef","state","additionalLines","highlightedSymbols","loading","openIssuesByLine","snippets","expandBlock","snippetIndex","direction","branchLike","snippetGroup","this","props","key","component","snippet","find","s","index","Promise","reject","extension","range","from","Math","max","start","to","end","then","lines","reduce","lineMap","line","coverageStatus","getCoverageStatus","newLinesMapped","animateBlockExpansion","expandComponent","setState","length","handleOpenIssues","handleCloseIssues","handleSymbolClick","clickedSymbols","filter","symb","includes","loadDuplications","renderDuplicationPopup","createSnippetsFromProps","issue","locations","root","current","element","querySelector","wrapper","table","firstChild","nodes","getNodes","style","marginTop","maxHeight","value","up","undefined","getBoundingClientRect","height","startHeight","transition","setTimeout","newSnippets","deletedSnippets","toDelete","forEach","setMaxHeight","resolve","cleanDom","issuesByLine","lastSnippetOfLastGroup","locationsByLine","SnippetViewer","duplications","duplicationsByLine","highlightedLocationMessage","issuePopup","onIssueChange","onIssuePopupToggle","onLocationSelect","scroll","isLastOccurenceOfPrimaryComponent","lastSnippetGroup","textRange","fullyShown","measures","parseInt","snippetLines","sources","includeIssueLocation","secondaryLocations","className","ref","SourceViewerHeaderSlim","expandable","onExpand","sourceViewerFile","Issue","onChange","onClick","onPopupToggle","openPopup","name","selected","map","id","renderSnippet","components","notAccessible","fetchDuplications","r","duplicatedFiles","files","handleIssuePopupToggle","popupName","open","samePopup","blocks","Consumer","openComponent","DuplicationPopup","inRemovedComponent","fetchIssueFlowSnippets","newProps","issueKey","onLoaded","response","status","throwGlobalError","Alert","variant","issuesByComponent","issues","locationsByComponent","lastOccurenceOfPrimaryComponent","i","SourceViewerContext","Provider","selectedFlowIndex","file","extendStatics","__extends","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","defineProperty","classNames","React","react_router_1","l10n_1","DropdownIcon_1","SettingsIcon_1","buttons_1","clipboard_1","Dropdown_1","Tooltip_1","default","children","overlayPlacement","small","toggleClassName","createElement","onOpen","overlay","Button","size","ActionsDropdownItem","_super","_this","apply","arguments","handleClick","event","preventDefault","currentTarget","blur","render","destructive","download","href","Link","copyValue","ClipboardBase","_a","setCopyButton","copySuccess","translate","visible","PureComponent","ActionsDropdownDivider","__assign","assign","t","n","call","__rest","e","indexOf","getOwnPropertySymbols","propertyIsEnumerable","Icon_1","_b","fill","_c","iconProps","viewBox","transform","baseAssignValue","createAggregator","groupBy","result","push","toFinite","remainder","array","predicate","fromIndex","fromRight","baseFindIndex","baseIteratee","toInteger","nativeMax","nativeMin","min","endLine","issuesByComponentAndLine","mapping","location","duplicationIndex","block","_ref","symbolsByLine","tokens","code","symbols","token","keys","match","splitByTokens","rootClassName","container","document","innerHTML","childNodes","node","nodeType","fullClassName","innerTokens","concat","nodeValue","markers","text","highlightSymbol","symbol","symbolRegExp","RegExp","test","part","str","acc","substr","highlightIssueLocations","issueLocations","nextTokens","markerAdded","startLine","x","s1","e1","s2","e2","p1","p2","p3","newClassName","slice","getLinearLocations","startOffset","endOffset","getSecondaryIssueLocationsForLine","highlightedLocations","l","msg","arrayMap","baseIntersection","baseRest","castArrayLikeObject","intersection","arrays","mapped","fillRule","stroke","strokeWidth","SetCache","arrayIncludes","arrayIncludesWith","baseUnary","cacheHas","iteratee","comparator","othLength","othIndex","caches","maxLength","Infinity","seen","outer","computed","cache","isArrayLikeObject","displayProjectName","linkToProject","path","project","projectName","q","subProject","subProjectName","projectNameLabel","qualifier","Project","SubProject","resolved","api","content","__esModule","options","exported","locals","___CSS_LOADER_API_IMPORT___","optimizeHighlightedSymbols","symbolsForLine","optimizeLocationMessage","optimizedSecondaryIssueLocations","some","optimizeSelectedIssue","selectedIssue","issuesForLine","MERGE_DISTANCE","LINES_BELOW_ISSUE","EXPAND_BY_LINES","collision","startA","endA","startB","endB","getPrimaryLocation","createSnippets","params","hasSecondaryLocations","ranges","loc","startIndex","endIndex","locationEnd","issueEndLine","addLinesBellow","firstCollision","keep","sort","a","linesForSnippets","componentLines","groupLocationsByComponent","currentGroup","currentComponent","groups","addGroup","componentKey","uuid","every","expandSnippet","snippetToExpand","Error","inSnippet","LineIssuesList","displayLocationsCount","displayIssueLocationsCount","displayLocationsLink","displayIssueLocationsLink","onIssueClick","super","onSymbolClick","attachEvents","activeMarkerNode","nextProps","detachEvents","prevProps","codeNode","querySelectorAll","addEventListener","message","leading","LocationIndex","LocationMessage","onIssueSelect","padding","secondaryIssueLocations","showIssues","highlight","renderedTokens","leadingMarker","displayLocationMarkers","marker","renderMarker","trim","paddingBottom","filteredSelectedIssues","scrollToUncoveredLine","coverageMarker","conditions","coveredConditions","getStatusTooltip","placement","blocksLoaded","duplicated","dropdownOpen","setDropdownOpen","onRequestClose","Dropdown","RightTop","role","tabIndex","issuesOpen","hasIssues","mostImportantIssue","tooltipContent","type","firstLineNumber","codeLocation","codeUrl","isAtTop","noPadding","BottomLeft","TopLeft","ActionsDropdown","displayOptions","isOpen","setOpen","lineNumber","closeOnClickOutside","hasAuthor","scmAuthor","hasDate","scmDate","date","scmRevision","previousLine","hasPopup","cell","changed","isSCMChanged","ariaLabel","handleIssuesIndicatorClick","openIssues","onIssuesClose","onIssueUnselect","onIssuesOpen","displayAllIssues","displayCoverage","displayDuplications","displayLineNumberOptions","displayIssues","displaySCM","duplicationsCount","highlighted","last","verticalBuffer","isNew","bottomPadding","Boolean","doScroll","parent","snippetNodeRef","offset","width","leftOffset","rightOffset","scrollToLastExpandedRow","snippetNode","rows","lastRow","lineDuplications","isSinkLine","noop","lastLine","bottomLine","issueLine","lowestVisibleIssue","k","renderLine","isDifferentComponent","handleFileClick","dataset","shouldLink","Number","title","groupedBlocks","fileRef","duplication","renderDuplication","filterDuplicationBlocksByLine","foundOne","outOfBounds","shouldDisplay","isOk","getDuplicationBlocksForIndex","isDuplicationBlockInRemovedComponent"],"mappings":"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","file":"js/286.m.de3aad75.chunk.js","sourcesContent":["/**\n * This method returns `undefined`.\n *\n * @static\n * @memberOf _\n * @since 2.3.0\n * @category Util\n * @example\n *\n * _.times(2, _.noop);\n * // => [undefined, undefined]\n */\nfunction noop() {\n  // No operation performed.\n}\n\nmodule.exports = noop;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { noop } from 'lodash';\nimport * as React from 'react';\nimport { getSources } from '../../../api/components';\nimport Issue from '../../../components/issue/Issue';\nimport getCoverageStatus from '../../../components/SourceViewer/helpers/getCoverageStatus';\nimport { locationsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport SourceViewerHeaderSlim from '../../../components/SourceViewer/SourceViewerHeaderSlim';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport SnippetViewer from './SnippetViewer';\nimport {\n  createSnippets,\n  expandSnippet,\n  EXPAND_BY_LINES,\n  linesForSnippets,\n  MERGE_DISTANCE\n} from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  isLastOccurenceOfPrimaryComponent: boolean;\n  issue: T.Issue;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetGroup: boolean;\n  loadDuplications: (component: string, line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  renderDuplicationPopup: (\n    component: T.SourceViewerFile,\n    index: number,\n    line: number\n  ) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset: number) => void;\n  snippetGroup: T.SnippetGroup;\n}\n\ninterface State {\n  additionalLines: { [line: number]: T.SourceLine };\n  highlightedSymbols: string[];\n  loading: boolean;\n  openIssuesByLine: T.Dict<boolean>;\n  snippets: T.Snippet[];\n}\n\nexport default class ComponentSourceSnippetGroupViewer extends React.PureComponent<Props, State> {\n  mounted = false;\n  rootNodeRef = React.createRef<HTMLDivElement>();\n  state: State = {\n    additionalLines: {},\n    highlightedSymbols: [],\n    loading: false,\n    openIssuesByLine: {},\n    snippets: []\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.createSnippetsFromProps();\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  createSnippetsFromProps() {\n    const { issue, snippetGroup } = this.props;\n\n    const snippets = createSnippets({\n      component: snippetGroup.component.key,\n      issue,\n      locations: snippetGroup.locations\n    });\n\n    this.setState({ snippets });\n  }\n\n  getNodes(index: number): { wrapper: HTMLElement; table: HTMLElement } | undefined {\n    const root = this.rootNodeRef.current;\n    if (!root) {\n      return undefined;\n    }\n    const element = root.querySelector(`#snippet-wrapper-${index}`);\n    if (!element) {\n      return undefined;\n    }\n    const wrapper = element.querySelector<HTMLElement>('.snippet');\n    if (!wrapper) {\n      return undefined;\n    }\n    const table = wrapper.firstChild as HTMLElement;\n    if (!table) {\n      return undefined;\n    }\n\n    return { wrapper, table };\n  }\n\n  /*\n   * Clean after animation\n   */\n  cleanDom(index: number) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    table.style.marginTop = '';\n    wrapper.style.maxHeight = '';\n  }\n\n  setMaxHeight(index: number, value?: number, up = false) {\n    const nodes = this.getNodes(index);\n\n    if (!nodes) {\n      return;\n    }\n\n    const { wrapper, table } = nodes;\n\n    const maxHeight = value !== undefined ? value : table.getBoundingClientRect().height;\n\n    if (up) {\n      const startHeight = wrapper.getBoundingClientRect().height;\n      table.style.transition = 'none';\n      table.style.marginTop = `${startHeight - maxHeight}px`;\n\n      // animate!\n      setTimeout(() => {\n        table.style.transition = '';\n        table.style.marginTop = '0px';\n        wrapper.style.maxHeight = `${maxHeight + 20}px`;\n      }, 0);\n    } else {\n      wrapper.style.maxHeight = `${maxHeight + 20}px`;\n    }\n  }\n\n  expandBlock = (snippetIndex: number, direction: T.ExpandDirection): Promise<void> => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n    const { snippets } = this.state;\n    const snippet = snippets.find(s => s.index === snippetIndex);\n    if (!snippet) {\n      return Promise.reject();\n    }\n    // Extend by EXPAND_BY_LINES and add buffer for merging snippets\n    const extension = EXPAND_BY_LINES + MERGE_DISTANCE - 1;\n    const range =\n      direction === 'up'\n        ? {\n            from: Math.max(1, snippet.start - extension),\n            to: snippet.start - 1\n          }\n        : {\n            from: snippet.end + 1,\n            to: snippet.end + extension\n          };\n    return getSources({\n      key,\n      ...range,\n      ...getBranchLikeQuery(branchLike)\n    })\n      .then(lines =>\n        lines.reduce((lineMap: T.Dict<T.SourceLine>, line) => {\n          line.coverageStatus = getCoverageStatus(line);\n          lineMap[line.line] = line;\n          return lineMap;\n        }, {})\n      )\n      .then(newLinesMapped => this.animateBlockExpansion(snippetIndex, direction, newLinesMapped));\n  };\n\n  animateBlockExpansion(\n    snippetIndex: number,\n    direction: T.ExpandDirection,\n    newLinesMapped: T.Dict<T.SourceLine>\n  ): Promise<void> {\n    if (this.mounted) {\n      const { snippets } = this.state;\n\n      const newSnippets = expandSnippet({\n        direction,\n        snippetIndex,\n        snippets\n      });\n\n      const deletedSnippets = newSnippets.filter(s => s.toDelete);\n\n      // set max-height to current height for CSS transitions\n      deletedSnippets.forEach(s => this.setMaxHeight(s.index));\n      this.setMaxHeight(snippetIndex);\n\n      return new Promise(resolve => {\n        this.setState(\n          ({ additionalLines, snippets }) => {\n            const combinedLines = { ...additionalLines, ...newLinesMapped };\n            return {\n              additionalLines: combinedLines,\n              snippets\n            };\n          },\n          () => {\n            // Set max-height 0 to trigger CSS transitions\n            deletedSnippets.forEach(s => {\n              this.setMaxHeight(s.index, 0);\n            });\n            this.setMaxHeight(snippetIndex, undefined, direction === 'up');\n\n            // Wait for transition to finish before updating dom\n            setTimeout(() => {\n              this.setState({ snippets: newSnippets.filter(s => !s.toDelete) }, resolve);\n              this.cleanDom(snippetIndex);\n            }, 200);\n          }\n        );\n      });\n    }\n    return Promise.resolve();\n  }\n\n  expandComponent = () => {\n    const { branchLike, snippetGroup } = this.props;\n    const { key } = snippetGroup.component;\n\n    this.setState({ loading: true });\n\n    getSources({ key, ...getBranchLikeQuery(branchLike) }).then(\n      lines => {\n        if (this.mounted) {\n          this.setState(({ additionalLines }) => {\n            const combinedLines = { ...additionalLines, ...lines };\n            return {\n              additionalLines: combinedLines,\n              loading: false,\n              snippets: [{ start: 0, end: lines[lines.length - 1].line, index: -1 }]\n            };\n          });\n        }\n      },\n      () => {\n        if (this.mounted) {\n          this.setState({ loading: false });\n        }\n      }\n    );\n  };\n\n  handleOpenIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: true }\n    }));\n  };\n\n  handleCloseIssues = (line: T.SourceLine) => {\n    this.setState(state => ({\n      openIssuesByLine: { ...state.openIssuesByLine, [line.line]: false }\n    }));\n  };\n\n  handleSymbolClick = (clickedSymbols: string[]) => {\n    this.setState(({ highlightedSymbols }) => {\n      const newHighlightedSymbols = clickedSymbols.filter(\n        symb => !highlightedSymbols.includes(symb)\n      );\n      return { highlightedSymbols: newHighlightedSymbols };\n    });\n  };\n\n  loadDuplications = (line: T.SourceLine) => {\n    this.props.loadDuplications(this.props.snippetGroup.component.key, line);\n  };\n\n  renderDuplicationPopup = (index: number, line: number) => {\n    return this.props.renderDuplicationPopup(this.props.snippetGroup.component, index, line);\n  };\n\n  renderSnippet({\n    index,\n    issuesByLine,\n    lastSnippetOfLastGroup,\n    locationsByLine,\n    snippet\n  }: {\n    index: number;\n    issuesByLine: T.IssuesByLine;\n    lastSnippetOfLastGroup: boolean;\n    locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n    snippet: T.SourceLine[];\n  }) {\n    return (\n      <SnippetViewer\n        branchLike={this.props.branchLike}\n        component={this.props.snippetGroup.component}\n        duplications={this.props.duplications}\n        duplicationsByLine={this.props.duplicationsByLine}\n        expandBlock={this.expandBlock}\n        handleCloseIssues={this.handleCloseIssues}\n        handleOpenIssues={this.handleOpenIssues}\n        handleSymbolClick={this.handleSymbolClick}\n        highlightedLocationMessage={this.props.highlightedLocationMessage}\n        highlightedSymbols={this.state.highlightedSymbols}\n        index={index}\n        issue={this.props.issue}\n        issuePopup={this.props.issuePopup}\n        issuesByLine={issuesByLine}\n        lastSnippetOfLastGroup={lastSnippetOfLastGroup}\n        loadDuplications={this.loadDuplications}\n        locations={this.props.locations}\n        locationsByLine={locationsByLine}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onLocationSelect={this.props.onLocationSelect}\n        openIssuesByLine={this.state.openIssuesByLine}\n        renderDuplicationPopup={this.renderDuplicationPopup}\n        scroll={this.props.scroll}\n        snippet={snippet}\n      />\n    );\n  }\n\n  render() {\n    const {\n      branchLike,\n      isLastOccurenceOfPrimaryComponent,\n      issue,\n      issuesByLine,\n      issuePopup,\n      lastSnippetGroup,\n      snippetGroup\n    } = this.props;\n    const { additionalLines, loading, snippets } = this.state;\n    const locations =\n      issue.component === snippetGroup.component.key && issue.textRange !== undefined\n        ? locationsByLine([issue])\n        : {};\n\n    const fullyShown =\n      snippets.length === 1 &&\n      snippetGroup.component.measures &&\n      snippets[0].end - snippets[0].start ===\n        parseInt(snippetGroup.component.measures.lines || '', 10);\n\n    const snippetLines = linesForSnippets(snippets, {\n      ...snippetGroup.sources,\n      ...additionalLines\n    });\n\n    const isFlow = issue.secondaryLocations.length === 0;\n    const includeIssueLocation = isFlow ? isLastOccurenceOfPrimaryComponent : true;\n\n    return (\n      <div className=\"component-source-container\" ref={this.rootNodeRef}>\n        <SourceViewerHeaderSlim\n          branchLike={branchLike}\n          expandable={!fullyShown}\n          loading={loading}\n          onExpand={this.expandComponent}\n          sourceViewerFile={snippetGroup.component}\n        />\n        {issue.component === snippetGroup.component.key && issue.textRange === undefined && (\n          <div className=\"padded-top padded-left padded-right\">\n            <Issue\n              issue={issue}\n              onChange={this.props.onIssueChange}\n              onClick={noop}\n              onPopupToggle={this.props.onIssuePopupToggle}\n              openPopup={issuePopup && issuePopup.issue === issue.key ? issuePopup.name : undefined}\n              selected={true}\n            />\n          </div>\n        )}\n        {snippetLines.map((snippet, index) => (\n          <div id={`snippet-wrapper-${snippets[index].index}`} key={snippets[index].index}>\n            {this.renderSnippet({\n              snippet,\n              index: snippets[index].index,\n              issuesByLine,\n              locationsByLine: includeIssueLocation ? locations : {},\n              lastSnippetOfLastGroup: lastSnippetGroup && index === snippets.length - 1\n            })}\n          </div>\n        ))}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { findLastIndex } from 'lodash';\nimport * as React from 'react';\nimport { Alert } from 'sonar-ui-common/components/ui/Alert';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getDuplications } from '../../../api/components';\nimport { getIssueFlowSnippets } from '../../../api/issues';\nimport throwGlobalError from '../../../app/utils/throwGlobalError';\nimport DuplicationPopup from '../../../components/SourceViewer/components/DuplicationPopup';\nimport {\n  filterDuplicationBlocksByLine,\n  getDuplicationBlocksForIndex,\n  isDuplicationBlockInRemovedComponent\n} from '../../../components/SourceViewer/helpers/duplications';\nimport {\n  duplicationsByLine as getDuplicationsByLine,\n  issuesByComponentAndLine\n} from '../../../components/SourceViewer/helpers/indexing';\nimport { SourceViewerContext } from '../../../components/SourceViewer/SourceViewerContext';\nimport { WorkspaceContext } from '../../../components/workspace/context';\nimport { getBranchLikeQuery } from '../../../helpers/branch-like';\nimport { BranchLike } from '../../../types/branch-like';\nimport ComponentSourceSnippetGroupViewer from './ComponentSourceSnippetGroupViewer';\nimport { groupLocationsByComponent } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  highlightedLocationMessage?: { index: number; text: string | undefined };\n  issue: T.Issue;\n  issues: T.Issue[];\n  locations: T.FlowLocation[];\n  onIssueChange: (issue: T.Issue) => void;\n  onLoaded?: () => void;\n  onLocationSelect: (index: number) => void;\n  scroll?: (element: HTMLElement) => void;\n  selectedFlowIndex: number | undefined;\n}\n\ninterface State {\n  components: T.Dict<T.SnippetsByComponent>;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  duplications?: T.Duplication[];\n  duplicationsByLine: { [line: number]: number[] };\n  issuePopup?: { issue: string; name: string };\n  loading: boolean;\n  notAccessible: boolean;\n}\n\nexport default class CrossComponentSourceViewerWrapper extends React.PureComponent<Props, State> {\n  mounted = false;\n  state: State = {\n    components: {},\n    duplicationsByLine: {},\n    loading: true,\n    notAccessible: false\n  };\n\n  componentDidMount() {\n    this.mounted = true;\n    this.fetchIssueFlowSnippets(this.props.issue.key);\n  }\n\n  componentWillReceiveProps(newProps: Props) {\n    if (newProps.issue.key !== this.props.issue.key) {\n      this.fetchIssueFlowSnippets(newProps.issue.key);\n    }\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  fetchDuplications = (component: string) => {\n    getDuplications({\n      key: component,\n      ...getBranchLikeQuery(this.props.branchLike)\n    }).then(\n      r => {\n        if (this.mounted) {\n          this.setState({\n            duplicatedFiles: r.files,\n            duplications: r.duplications,\n            duplicationsByLine: getDuplicationsByLine(r.duplications)\n          });\n        }\n      },\n      () => {}\n    );\n  };\n\n  fetchIssueFlowSnippets(issueKey: string) {\n    this.setState({ loading: true });\n    getIssueFlowSnippets(issueKey).then(\n      components => {\n        if (this.mounted) {\n          this.setState({\n            components,\n            issuePopup: undefined,\n            loading: false\n          });\n          if (this.props.onLoaded) {\n            this.props.onLoaded();\n          }\n        }\n      },\n      (response: Response) => {\n        if (response.status !== 403) {\n          throwGlobalError(response);\n        }\n        if (this.mounted) {\n          this.setState({ loading: false, notAccessible: response.status === 403 });\n        }\n      }\n    );\n  }\n\n  handleIssuePopupToggle = (issue: string, popupName: string, open?: boolean) => {\n    this.setState((state: State) => {\n      const samePopup =\n        state.issuePopup && state.issuePopup.name === popupName && state.issuePopup.issue === issue;\n      if (open !== false && !samePopup) {\n        return { issuePopup: { issue, name: popupName } };\n      } else if (open !== true && samePopup) {\n        return { issuePopup: undefined };\n      }\n      return null;\n    });\n  };\n\n  renderDuplicationPopup = (component: T.SourceViewerFile, index: number, line: number) => {\n    const { duplicatedFiles, duplications } = this.state;\n\n    if (!component || !duplicatedFiles) {\n      return null;\n    }\n\n    const blocks = getDuplicationBlocksForIndex(duplications, index);\n\n    return (\n      <WorkspaceContext.Consumer>\n        {({ openComponent }) => (\n          <DuplicationPopup\n            blocks={filterDuplicationBlocksByLine(blocks, line)}\n            branchLike={this.props.branchLike}\n            duplicatedFiles={duplicatedFiles}\n            inRemovedComponent={isDuplicationBlockInRemovedComponent(blocks)}\n            openComponent={openComponent}\n            sourceViewerFile={component}\n          />\n        )}\n      </WorkspaceContext.Consumer>\n    );\n  };\n\n  render() {\n    const { loading, notAccessible } = this.state;\n\n    if (loading) {\n      return (\n        <div>\n          <DeferredSpinner />\n        </div>\n      );\n    }\n\n    if (notAccessible) {\n      return (\n        <Alert className=\"spacer-top\" variant=\"warning\">\n          {translate('code_viewer.no_source_code_displayed_due_to_security')}\n        </Alert>\n      );\n    }\n\n    const { issue, locations } = this.props;\n    const { components, duplications, duplicationsByLine } = this.state;\n    const issuesByComponent = issuesByComponentAndLine(this.props.issues);\n    const locationsByComponent = groupLocationsByComponent(issue, locations, components);\n\n    const lastOccurenceOfPrimaryComponent = findLastIndex(\n      locationsByComponent,\n      ({ component }) => component.key === issue.component\n    );\n\n    return (\n      <div>\n        {locationsByComponent.map((snippetGroup, i) => {\n          return (\n            <SourceViewerContext.Provider\n              // eslint-disable-next-line react/no-array-index-key\n              key={`${issue.key}-${this.props.selectedFlowIndex || 0}-${i}`}\n              value={{ branchLike: this.props.branchLike, file: snippetGroup.component }}>\n              <ComponentSourceSnippetGroupViewer\n                branchLike={this.props.branchLike}\n                duplications={duplications}\n                duplicationsByLine={duplicationsByLine}\n                highlightedLocationMessage={this.props.highlightedLocationMessage}\n                issue={issue}\n                issuePopup={this.state.issuePopup}\n                issuesByLine={issuesByComponent[snippetGroup.component.key] || {}}\n                isLastOccurenceOfPrimaryComponent={i === lastOccurenceOfPrimaryComponent}\n                lastSnippetGroup={i === locationsByComponent.length - 1}\n                loadDuplications={this.fetchDuplications}\n                locations={snippetGroup.locations || []}\n                onIssueChange={this.props.onIssueChange}\n                onIssuePopupToggle={this.handleIssuePopupToggle}\n                onLocationSelect={this.props.onLocationSelect}\n                renderDuplicationPopup={this.renderDuplicationPopup}\n                scroll={this.props.scroll}\n                snippetGroup={snippetGroup}\n              />\n            </SourceViewerContext.Provider>\n          );\n        })}\n      </div>\n    );\n  }\n}\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar classNames = require(\"classnames\");\nvar React = require(\"react\");\nvar react_router_1 = require(\"react-router\");\nvar l10n_1 = require(\"../../helpers/l10n\");\nvar DropdownIcon_1 = require(\"../icons/DropdownIcon\");\nvar SettingsIcon_1 = require(\"../icons/SettingsIcon\");\nvar buttons_1 = require(\"./buttons\");\nvar clipboard_1 = require(\"./clipboard\");\nvar Dropdown_1 = require(\"./Dropdown\");\nvar Tooltip_1 = require(\"./Tooltip\");\nfunction ActionsDropdown(props) {\n    var children = props.children, className = props.className, overlayPlacement = props.overlayPlacement, small = props.small, toggleClassName = props.toggleClassName;\n    return (React.createElement(Dropdown_1.default, { className: className, onOpen: props.onOpen, overlay: React.createElement(\"ul\", { className: \"menu\" }, children), overlayPlacement: overlayPlacement },\n        React.createElement(buttons_1.Button, { className: classNames('dropdown-toggle', toggleClassName, {\n                'button-small': small,\n            }) },\n            React.createElement(SettingsIcon_1.default, { size: small ? 12 : 14 }),\n            React.createElement(DropdownIcon_1.default, { className: \"little-spacer-left\" }))));\n}\nexports.default = ActionsDropdown;\nvar ActionsDropdownItem = (function (_super) {\n    __extends(ActionsDropdownItem, _super);\n    function ActionsDropdownItem() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.handleClick = function (event) {\n            event.preventDefault();\n            event.currentTarget.blur();\n            if (_this.props.onClick) {\n                _this.props.onClick();\n            }\n        };\n        return _this;\n    }\n    ActionsDropdownItem.prototype.render = function () {\n        var _this = this;\n        var className = classNames(this.props.className, { 'text-danger': this.props.destructive });\n        if (this.props.download && typeof this.props.to === 'string') {\n            return (React.createElement(\"li\", null,\n                React.createElement(\"a\", { className: className, download: this.props.download, href: this.props.to, id: this.props.id }, this.props.children)));\n        }\n        if (this.props.to) {\n            return (React.createElement(\"li\", null,\n                React.createElement(react_router_1.Link, { className: className, id: this.props.id, to: this.props.to }, this.props.children)));\n        }\n        if (this.props.copyValue) {\n            return (React.createElement(clipboard_1.ClipboardBase, null, function (_a) {\n                var setCopyButton = _a.setCopyButton, copySuccess = _a.copySuccess;\n                return (React.createElement(Tooltip_1.default, { overlay: l10n_1.translate('copied_action'), visible: copySuccess },\n                    React.createElement(\"li\", { \"data-clipboard-text\": _this.props.copyValue, ref: setCopyButton },\n                        React.createElement(\"a\", { className: className, href: \"#\", id: _this.props.id, onClick: _this.handleClick }, _this.props.children))));\n            }));\n        }\n        return (React.createElement(\"li\", null,\n            React.createElement(\"a\", { className: className, href: \"#\", id: this.props.id, onClick: this.handleClick }, this.props.children)));\n    };\n    return ActionsDropdownItem;\n}(React.PureComponent));\nexports.ActionsDropdownItem = ActionsDropdownItem;\nfunction ActionsDropdownDivider() {\n    return React.createElement(\"li\", { className: \"divider\" });\n}\nexports.ActionsDropdownDivider = ActionsDropdownDivider;\n//# sourceMappingURL=ActionsDropdown.js.map","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar React = require(\"react\");\nvar Icon_1 = require(\"./Icon\");\nfunction SettingsIcon(_a) {\n    var _b = _a.fill, fill = _b === void 0 ? 'currentColor' : _b, _c = _a.size, size = _c === void 0 ? 14 : _c, iconProps = __rest(_a, [\"fill\", \"size\"]);\n    return (React.createElement(Icon_1.default, __assign({ size: size, viewBox: \"0 0 14 14\" }, iconProps),\n        React.createElement(\"g\", { transform: \"matrix(0.0364583,0,0,0.0364583,0,-1.16667)\" },\n            React.createElement(\"path\", { d: \"M256,224C256,206.333 249.75,191.25 237.25,178.75C224.75,166.25 209.667,160 192,160C174.333,160 159.25,166.25 146.75,178.75C134.25,191.25 128,206.333 128,224C128,241.667 134.25,256.75 146.75,269.25C159.25,281.75 174.333,288 192,288C209.667,288 224.75,281.75 237.25,269.25C249.75,256.75 256,241.667 256,224ZM384,196.75L384,252.25C384,254.25 383.333,256.167 382,258C380.667,259.833 379,260.917 377,261.25L330.75,268.25C327.583,277.25 324.333,284.833 321,291C326.833,299.333 335.75,310.833 347.75,325.5C349.417,327.5 350.25,329.583 350.25,331.75C350.25,333.917 349.5,335.833 348,337.5C343.5,343.667 335.25,352.667 323.25,364.5C311.25,376.333 303.417,382.25 299.75,382.25C297.75,382.25 295.583,381.5 293.25,380L258.75,353C251.417,356.833 243.833,360 236,362.5C233.333,385.167 230.917,400.667 228.75,409C227.583,413.667 224.583,416 219.75,416L164.25,416C161.917,416 159.875,415.292 158.125,413.875C156.375,412.458 155.417,410.667 155.25,408.5L148.25,362.5C140.083,359.833 132.583,356.75 125.75,353.25L90.5,380C88.833,381.5 86.75,382.25 84.25,382.25C81.917,382.25 79.833,381.333 78,379.5C57,360.5 43.25,346.5 36.75,337.5C35.583,335.833 35,333.917 35,331.75C35,329.75 35.667,327.833 37,326C39.5,322.5 43.75,316.958 49.75,309.375C55.75,301.792 60.25,295.917 63.25,291.75C58.75,283.417 55.333,275.167 53,267L7.25,260.25C5.083,259.917 3.333,258.875 2,257.125C0.667,255.375 0,253.417 0,251.25L0,195.75C0,193.75 0.667,191.833 2,190C3.333,188.167 4.917,187.083 6.75,186.75L53.25,179.75C55.583,172.083 58.833,164.417 63,156.75C56.333,147.25 47.417,135.75 36.25,122.25C34.583,120.25 33.75,118.25 33.75,116.25C33.75,114.583 34.5,112.667 36,110.5C40.333,104.5 48.542,95.542 60.625,83.625C72.708,71.708 80.583,65.75 84.25,65.75C86.417,65.75 88.583,66.583 90.75,68.25L125.25,95C132.583,91.167 140.167,88 148,85.5C150.667,62.833 153.083,47.333 155.25,39C156.417,34.333 159.417,32 164.25,32L219.75,32C222.083,32 224.125,32.708 225.875,34.125C227.625,35.542 228.583,37.333 228.75,39.5L235.75,85.5C243.917,88.167 251.417,91.25 258.25,94.75L293.75,68C295.25,66.5 297.25,65.75 299.75,65.75C301.917,65.75 304,66.583 306,68.25C327.5,88.083 341.25,102.25 347.25,110.75C348.417,112.083 349,113.917 349,116.25C349,118.25 348.333,120.167 347,122C344.5,125.5 340.25,131.042 334.25,138.625C328.25,146.208 323.75,152.083 320.75,156.25C325.083,164.583 328.5,172.75 331,180.75L376.75,187.75C378.917,188.083 380.667,189.125 382,190.875C383.333,192.625 384,194.583 384,196.75Z\", style: { fill: fill } }))));\n}\nexports.default = SettingsIcon;\n//# sourceMappingURL=SettingsIcon.js.map","var baseAssignValue = require('./_baseAssignValue'),\n    createAggregator = require('./_createAggregator');\n\n/** Used for built-in method references. */\nvar objectProto = Object.prototype;\n\n/** Used to check objects for own properties. */\nvar hasOwnProperty = objectProto.hasOwnProperty;\n\n/**\n * Creates an object composed of keys generated from the results of running\n * each element of `collection` thru `iteratee`. The order of grouped values\n * is determined by the order they occur in `collection`. The corresponding\n * value of each key is an array of elements responsible for generating the\n * key. The iteratee is invoked with one argument: (value).\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Collection\n * @param {Array|Object} collection The collection to iterate over.\n * @param {Function} [iteratee=_.identity] The iteratee to transform keys.\n * @returns {Object} Returns the composed aggregate object.\n * @example\n *\n * _.groupBy([6.1, 4.2, 6.3], Math.floor);\n * // => { '4': [4.2], '6': [6.1, 6.3] }\n *\n * // The `_.property` iteratee shorthand.\n * _.groupBy(['one', 'two', 'three'], 'length');\n * // => { '3': ['one', 'two'], '5': ['three'] }\n */\nvar groupBy = createAggregator(function(result, value, key) {\n  if (hasOwnProperty.call(result, key)) {\n    result[key].push(value);\n  } else {\n    baseAssignValue(result, key, [value]);\n  }\n});\n\nmodule.exports = groupBy;\n","var toFinite = require('./toFinite');\n\n/**\n * Converts `value` to an integer.\n *\n * **Note:** This method is loosely based on\n * [`ToInteger`](http://www.ecma-international.org/ecma-262/7.0/#sec-tointeger).\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Lang\n * @param {*} value The value to convert.\n * @returns {number} Returns the converted integer.\n * @example\n *\n * _.toInteger(3.2);\n * // => 3\n *\n * _.toInteger(Number.MIN_VALUE);\n * // => 0\n *\n * _.toInteger(Infinity);\n * // => 1.7976931348623157e+308\n *\n * _.toInteger('3.2');\n * // => 3\n */\nfunction toInteger(value) {\n  var result = toFinite(value),\n      remainder = result % 1;\n\n  return result === result ? (remainder ? result - remainder : result) : 0;\n}\n\nmodule.exports = toInteger;\n","/**\n * The base implementation of `_.findIndex` and `_.findLastIndex` without\n * support for iteratee shorthands.\n *\n * @private\n * @param {Array} array The array to inspect.\n * @param {Function} predicate The function invoked per iteration.\n * @param {number} fromIndex The index to search from.\n * @param {boolean} [fromRight] Specify iterating from right to left.\n * @returns {number} Returns the index of the matched value, else `-1`.\n */\nfunction baseFindIndex(array, predicate, fromIndex, fromRight) {\n  var length = array.length,\n      index = fromIndex + (fromRight ? 1 : -1);\n\n  while ((fromRight ? index-- : ++index < length)) {\n    if (predicate(array[index], index, array)) {\n      return index;\n    }\n  }\n  return -1;\n}\n\nmodule.exports = baseFindIndex;\n","var baseFindIndex = require('./_baseFindIndex'),\n    baseIteratee = require('./_baseIteratee'),\n    toInteger = require('./toInteger');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMax = Math.max,\n    nativeMin = Math.min;\n\n/**\n * This method is like `_.findIndex` except that it iterates over elements\n * of `collection` from right to left.\n *\n * @static\n * @memberOf _\n * @since 2.0.0\n * @category Array\n * @param {Array} array The array to inspect.\n * @param {Function} [predicate=_.identity] The function invoked per iteration.\n * @param {number} [fromIndex=array.length-1] The index to search from.\n * @returns {number} Returns the index of the found element, else `-1`.\n * @example\n *\n * var users = [\n *   { 'user': 'barney',  'active': true },\n *   { 'user': 'fred',    'active': false },\n *   { 'user': 'pebbles', 'active': false }\n * ];\n *\n * _.findLastIndex(users, function(o) { return o.user == 'pebbles'; });\n * // => 2\n *\n * // The `_.matches` iteratee shorthand.\n * _.findLastIndex(users, { 'user': 'barney', 'active': true });\n * // => 0\n *\n * // The `_.matchesProperty` iteratee shorthand.\n * _.findLastIndex(users, ['active', false]);\n * // => 2\n *\n * // The `_.property` iteratee shorthand.\n * _.findLastIndex(users, 'active');\n * // => 0\n */\nfunction findLastIndex(array, predicate, fromIndex) {\n  var length = array == null ? 0 : array.length;\n  if (!length) {\n    return -1;\n  }\n  var index = length - 1;\n  if (fromIndex !== undefined) {\n    index = toInteger(fromIndex);\n    index = fromIndex < 0\n      ? nativeMax(length + index, 0)\n      : nativeMin(index, length - 1);\n  }\n  return baseFindIndex(array, baseIteratee(predicate, 3), index, true);\n}\n\nmodule.exports = findLastIndex;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { flatten } from 'lodash';\nimport { splitByTokens } from './highlight';\nimport { getLinearLocations } from './issueLocations';\n\nexport function issuesByLine(issues: T.Issue[]) {\n  const index: { [line: number]: T.Issue[] } = {};\n  issues.forEach(issue => {\n    const line = issue.textRange ? issue.textRange.endLine : 0;\n    if (!(line in index)) {\n      index[line] = [];\n    }\n    index[line].push(issue);\n  });\n  return index;\n}\n\nexport function issuesByComponentAndLine(\n  issues: T.Issue[] = []\n): { [component: string]: { [line: number]: T.Issue[] } } {\n  return issues.reduce((mapping: { [component: string]: { [line: number]: T.Issue[] } }, issue) => {\n    mapping[issue.component] = mapping[issue.component] || {};\n    const line = issue.textRange ? issue.textRange.endLine : 0;\n    mapping[issue.component][line] = mapping[issue.component][line] || [];\n    mapping[issue.component][line].push(issue);\n    return mapping;\n  }, {});\n}\n\nexport function locationsByLine(issues: Pick<T.Issue, 'textRange'>[]) {\n  const index: { [line: number]: T.LinearIssueLocation[] } = {};\n  issues.forEach(issue => {\n    getLinearLocations(issue.textRange).forEach(location => {\n      if (!(location.line in index)) {\n        index[location.line] = [];\n      }\n      index[location.line].push(location);\n    });\n  });\n  return index;\n}\n\nexport function duplicationsByLine(duplications: T.Duplication[] | undefined) {\n  if (duplications == null) {\n    return {};\n  }\n\n  const duplicationsByLine: { [line: number]: number[] } = {};\n\n  duplications.forEach(({ blocks }, duplicationIndex) => {\n    blocks.forEach(block => {\n      // eslint-disable-next-line no-underscore-dangle\n      if (block._ref === '1') {\n        for (let line = block.from; line < block.from + block.size; line++) {\n          if (!(line in duplicationsByLine)) {\n            duplicationsByLine[line] = [];\n          }\n          duplicationsByLine[line].push(duplicationIndex);\n        }\n      }\n    });\n  });\n\n  return duplicationsByLine;\n}\n\nexport function symbolsByLine(sources: T.SourceLine[]) {\n  const index: { [line: number]: string[] } = {};\n  sources.forEach(line => {\n    const tokens = splitByTokens(line.code || '');\n    const symbols = flatten(\n      tokens.map(token => {\n        const keys = token.className.match(/sym-\\d+/g);\n        return keys != null ? keys : [];\n      })\n    );\n    index[line.line] = symbols.filter(key => key);\n  });\n  return index;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { uniq } from 'lodash';\n\nexport interface Token {\n  className: string;\n  markers: number[];\n  text: string;\n}\n\nconst ISSUE_LOCATION_CLASS = 'source-line-code-issue';\n\nexport function splitByTokens(code: string, rootClassName = ''): Token[] {\n  const container = document.createElement('div');\n  let tokens: Token[] = [];\n  container.innerHTML = code;\n  [].forEach.call(container.childNodes, (node: Element) => {\n    if (node.nodeType === 1) {\n      // ELEMENT NODE\n      const fullClassName = rootClassName ? rootClassName + ' ' + node.className : node.className;\n      const innerTokens = splitByTokens(node.innerHTML, fullClassName);\n      tokens = tokens.concat(innerTokens);\n    }\n    if (node.nodeType === 3 && node.nodeValue) {\n      // TEXT NODE\n      tokens.push({ className: rootClassName, markers: [], text: node.nodeValue });\n    }\n  });\n  return tokens;\n}\n\nexport function highlightSymbol(tokens: Token[], symbol: string): Token[] {\n  const symbolRegExp = new RegExp(`\\\\b${symbol}\\\\b`);\n  return tokens.map(token =>\n    symbolRegExp.test(token.className)\n      ? { ...token, className: `${token.className} highlighted` }\n      : token\n  );\n}\n\n/**\n * Intersect two ranges\n * @param s1 Start position of the first range\n * @param e1 End position of the first range\n * @param s2 Start position of the second range\n * @param e2 End position of the second range\n */\nfunction intersect(s1: number, e1: number, s2: number, e2: number) {\n  return { from: Math.max(s1, s2), to: Math.min(e1, e2) };\n}\n\n/**\n * Get the substring of a string\n * @param str A string\n * @param from \"From\" offset\n * @param to \"To\" offset\n * @param acc Global offset to eliminate\n */\nfunction part(str: string, from: number, to: number, acc: number): string {\n  // we do not want negative number as the first argument of `substr`\n  return from >= acc ? str.substr(from - acc, to - from) : str.substr(0, to - from);\n}\n\n/**\n * Highlight issue locations in the list of tokens\n */\nexport function highlightIssueLocations(\n  tokens: Token[],\n  issueLocations: T.LinearIssueLocation[],\n  rootClassName: string = ISSUE_LOCATION_CLASS\n): Token[] {\n  issueLocations.forEach(location => {\n    const nextTokens: Token[] = [];\n    let acc = 0;\n    let markerAdded = location.line !== location.startLine;\n    tokens.forEach(token => {\n      const x = intersect(acc, acc + token.text.length, location.from, location.to);\n      const p1 = part(token.text, acc, x.from, acc);\n      const p2 = part(token.text, x.from, x.to, acc);\n      const p3 = part(token.text, x.to, acc + token.text.length, acc);\n      if (p1.length) {\n        nextTokens.push({ ...token, text: p1 });\n      }\n      if (p2.length) {\n        const newClassName =\n          token.className.indexOf(rootClassName) === -1\n            ? `${token.className} ${rootClassName}`\n            : token.className;\n        nextTokens.push({\n          className: newClassName,\n          markers:\n            !markerAdded && location.index != null\n              ? uniq([...token.markers, location.index])\n              : token.markers,\n          text: p2\n        });\n        markerAdded = true;\n      }\n      if (p3.length) {\n        nextTokens.push({ ...token, text: p3 });\n      }\n      acc += token.text.length;\n    });\n    tokens = nextTokens.slice();\n  });\n  return tokens;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nexport function getLinearLocations(textRange: T.TextRange | undefined): T.LinearIssueLocation[] {\n  if (!textRange) {\n    return [];\n  }\n  const locations = [];\n\n  // go through all lines of the `textRange`\n  for (let line = textRange.startLine; line <= textRange.endLine; line++) {\n    // TODO fix 999999\n    const from = line === textRange.startLine ? textRange.startOffset : 0;\n    const to = line === textRange.endLine ? textRange.endOffset : 999999;\n    locations.push({ line, from, to });\n  }\n  return locations;\n}\n\nexport function getSecondaryIssueLocationsForLine(\n  line: T.SourceLine,\n  highlightedLocations: (T.FlowLocation | undefined)[] | undefined\n): T.LinearIssueLocation[] {\n  if (!highlightedLocations) {\n    return [];\n  }\n  return highlightedLocations.reduce((locations, location) => {\n    const linearLocations: T.LinearIssueLocation[] = location\n      ? getLinearLocations(location.textRange)\n          .filter(l => l.line === line.line)\n          .map(l => ({\n            ...l,\n            startLine: location.textRange.startLine,\n            index: location.index,\n            text: location.msg\n          }))\n      : [];\n    return [...locations, ...linearLocations];\n  }, []);\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { BranchLike } from '../../types/branch-like';\n\ninterface SourceViewerContextShape {\n  branchLike?: BranchLike;\n  file: T.SourceViewerFile;\n}\n\nexport const SourceViewerContext = React.createContext<SourceViewerContextShape>({\n  branchLike: {} as BranchLike,\n  file: {} as T.SourceViewerFile\n});\n","var arrayMap = require('./_arrayMap'),\n    baseIntersection = require('./_baseIntersection'),\n    baseRest = require('./_baseRest'),\n    castArrayLikeObject = require('./_castArrayLikeObject');\n\n/**\n * Creates an array of unique values that are included in all given arrays\n * using [`SameValueZero`](http://ecma-international.org/ecma-262/7.0/#sec-samevaluezero)\n * for equality comparisons. The order and references of result values are\n * determined by the first array.\n *\n * @static\n * @memberOf _\n * @since 0.1.0\n * @category Array\n * @param {...Array} [arrays] The arrays to inspect.\n * @returns {Array} Returns the new array of intersecting values.\n * @example\n *\n * _.intersection([2, 1], [2, 3]);\n * // => [2]\n */\nvar intersection = baseRest(function(arrays) {\n  var mapped = arrayMap(arrays, castArrayLikeObject);\n  return (mapped.length && mapped[0] === arrays[0])\n    ? baseIntersection(mapped)\n    : [];\n});\n\nmodule.exports = intersection;\n","\"use strict\";\nvar __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __rest = (this && this.__rest) || function (s, e) {\n    var t = {};\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\n        t[p] = s[p];\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\n                t[p[i]] = s[p[i]];\n        }\n    return t;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar React = require(\"react\");\nvar Icon_1 = require(\"./Icon\");\nfunction ExpandSnippetIcon(_a) {\n    var _b = _a.fill, fill = _b === void 0 ? 'currentColor' : _b, iconProps = __rest(_a, [\"fill\"]);\n    return (React.createElement(Icon_1.default, __assign({}, iconProps),\n        React.createElement(\"g\", { fill: \"none\", fillRule: \"evenodd\" },\n            React.createElement(\"path\", { d: \"M8 1v4H4\", stroke: fill, strokeWidth: \"2\", transform: \"scale(-.83333 -.84583) rotate(45 7.66 -19.75)\" }),\n            React.createElement(\"path\", { d: \"M3 5.78h10v1.7H3z\", fill: fill }),\n            React.createElement(\"path\", { d: \"M7.17 2.4h1.66v5.07H7.17z\", fill: fill }),\n            React.createElement(\"g\", null,\n                React.createElement(\"path\", { d: \"M8.16 1.81V6.1H3.9\", stroke: fill, strokeWidth: \"2\", transform: \"scale(.83333 .84583) rotate(45 -4.2 13.2)\" }),\n                React.createElement(\"path\", { d: \"M13 10.01H3v-1.7h10z\", fill: fill }),\n                React.createElement(\"path\", { d: \"M8.83 13.4H7.17V9.15h1.66z\", fill: fill })))));\n}\nexports.default = ExpandSnippetIcon;\n//# sourceMappingURL=ExpandSnippetIcon.js.map","var SetCache = require('./_SetCache'),\n    arrayIncludes = require('./_arrayIncludes'),\n    arrayIncludesWith = require('./_arrayIncludesWith'),\n    arrayMap = require('./_arrayMap'),\n    baseUnary = require('./_baseUnary'),\n    cacheHas = require('./_cacheHas');\n\n/* Built-in method references for those with the same name as other `lodash` methods. */\nvar nativeMin = Math.min;\n\n/**\n * The base implementation of methods like `_.intersection`, without support\n * for iteratee shorthands, that accepts an array of arrays to inspect.\n *\n * @private\n * @param {Array} arrays The arrays to inspect.\n * @param {Function} [iteratee] The iteratee invoked per element.\n * @param {Function} [comparator] The comparator invoked per element.\n * @returns {Array} Returns the new array of shared values.\n */\nfunction baseIntersection(arrays, iteratee, comparator) {\n  var includes = comparator ? arrayIncludesWith : arrayIncludes,\n      length = arrays[0].length,\n      othLength = arrays.length,\n      othIndex = othLength,\n      caches = Array(othLength),\n      maxLength = Infinity,\n      result = [];\n\n  while (othIndex--) {\n    var array = arrays[othIndex];\n    if (othIndex && iteratee) {\n      array = arrayMap(array, baseUnary(iteratee));\n    }\n    maxLength = nativeMin(array.length, maxLength);\n    caches[othIndex] = !comparator && (iteratee || (length >= 120 && array.length >= 120))\n      ? new SetCache(othIndex && array)\n      : undefined;\n  }\n  array = arrays[0];\n\n  var index = -1,\n      seen = caches[0];\n\n  outer:\n  while (++index < length && result.length < maxLength) {\n    var value = array[index],\n        computed = iteratee ? iteratee(value) : value;\n\n    value = (comparator || value !== 0) ? value : 0;\n    if (!(seen\n          ? cacheHas(seen, computed)\n          : includes(result, computed, comparator)\n        )) {\n      othIndex = othLength;\n      while (--othIndex) {\n        var cache = caches[othIndex];\n        if (!(cache\n              ? cacheHas(cache, computed)\n              : includes(arrays[othIndex], computed, comparator))\n            ) {\n          continue outer;\n        }\n      }\n      if (seen) {\n        seen.push(computed);\n      }\n      result.push(value);\n    }\n  }\n  return result;\n}\n\nmodule.exports = baseIntersection;\n","var isArrayLikeObject = require('./isArrayLikeObject');\n\n/**\n * Casts `value` to an empty array if it's not an array like object.\n *\n * @private\n * @param {*} value The value to inspect.\n * @returns {Array|Object} Returns the cast array-like object.\n */\nfunction castArrayLikeObject(value) {\n  return isArrayLikeObject(value) ? value : [];\n}\n\nmodule.exports = castArrayLikeObject;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { Link } from 'react-router';\nimport { ButtonIcon } from 'sonar-ui-common/components/controls/buttons';\nimport { ClipboardIconButton } from 'sonar-ui-common/components/controls/clipboard';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport QualifierIcon from 'sonar-ui-common/components/icons/QualifierIcon';\nimport DeferredSpinner from 'sonar-ui-common/components/ui/DeferredSpinner';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { collapsedDirFromPath, fileFromPath } from 'sonar-ui-common/helpers/path';\nimport { getPathUrlAsString } from 'sonar-ui-common/helpers/urls';\nimport { getBranchLikeQuery } from '../../helpers/branch-like';\nimport { getBranchLikeUrl, getComponentIssuesUrl } from '../../helpers/urls';\nimport { BranchLike } from '../../types/branch-like';\nimport { ComponentQualifier } from '../../types/component';\nimport './SourceViewerHeaderSlim.css';\n\nexport interface Props {\n  branchLike: BranchLike | undefined;\n  expandable?: boolean;\n  displayProjectName?: boolean;\n  linkToProject?: boolean;\n  loading?: boolean;\n  onExpand?: () => void;\n  sourceViewerFile: T.SourceViewerFile;\n}\n\nexport default function SourceViewerHeaderSlim(props: Props) {\n  const {\n    branchLike,\n    expandable,\n    displayProjectName = true,\n    linkToProject = true,\n    loading,\n    onExpand,\n    sourceViewerFile\n  } = props;\n  const { measures, path, project, projectName, q, subProject, subProjectName } = sourceViewerFile;\n\n  const projectNameLabel = (\n    <>\n      <QualifierIcon qualifier={ComponentQualifier.Project} /> <span>{projectName}</span>\n    </>\n  );\n\n  return (\n    <div className=\"source-viewer-header-slim display-flex-row display-flex-space-between\">\n      <div className=\"display-flex-center flex-1\">\n        {displayProjectName && (\n          <div className=\"spacer-right\">\n            {linkToProject ? (\n              <a\n                className=\"link-with-icon\"\n                href={getPathUrlAsString(getBranchLikeUrl(project, branchLike))}>\n                {projectNameLabel}\n              </a>\n            ) : (\n              projectNameLabel\n            )}\n          </div>\n        )}\n\n        {subProject !== undefined && (\n          <>\n            <QualifierIcon qualifier={ComponentQualifier.SubProject} />{' '}\n            <span className=\"spacer-right\">{subProjectName}</span>\n          </>\n        )}\n\n        <div className=\"spacer-right\">\n          <QualifierIcon qualifier={q} /> <span>{collapsedDirFromPath(path)}</span>\n          <span className=\"component-name-file\">{fileFromPath(path)}</span>\n        </div>\n\n        <div className=\"spacer-right\">\n          <ClipboardIconButton className=\"button-link link-no-underline\" copyValue={path} />\n        </div>\n      </div>\n\n      {measures.issues !== undefined && (\n        <div\n          className={classNames('flex-0 big-spacer-left', {\n            'little-spacer-right': !expandable || loading\n          })}>\n          <Link\n            to={getComponentIssuesUrl(project, {\n              ...getBranchLikeQuery(branchLike),\n              files: path,\n              resolved: 'false'\n            })}>\n            {translate('source_viewer.view_all_issues')}\n          </Link>\n        </div>\n      )}\n\n      {expandable && (\n        <DeferredSpinner className=\"little-spacer-right\" loading={loading}>\n          <div className=\"flex-0 big-spacer-left\">\n            <ButtonIcon className=\"js-actions\" onClick={onExpand}>\n              <ExpandSnippetIcon />\n            </ButtonIcon>\n          </div>\n        </DeferredSpinner>\n      )}\n    </div>\n  );\n}\n","var api = require(\"!../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../node_modules/postcss-loader/src/index.js??postcss!./SourceViewerHeaderSlim.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".source-viewer-header-slim{padding:4px 10px;border-bottom:1px solid #cdcdcd;background-color:#f3f3f3;align-items:center;min-height:25px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/**\n * The base implementation of `_.times` without support for iteratee shorthands\n * or max array length checks.\n *\n * @private\n * @param {number} n The number of times to invoke `iteratee`.\n * @param {Function} iteratee The function invoked per iteration.\n * @returns {Array} Returns the array of results.\n */\nfunction baseTimes(n, iteratee) {\n  var index = -1,\n      result = Array(n);\n\n  while (++index < n) {\n    result[index] = iteratee(index);\n  }\n  return result;\n}\n\nmodule.exports = baseTimes;\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./Line.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".source-line:hover .source-line-coverage,.source-line:hover .source-line-duplications,.source-line:hover .source-line-duplications-extra,.source-line:hover .source-line-issues,.source-line:hover .source-line-number,.source-line:hover .source-line-scm{border-color:#e9e9e9;background-color:#e9e9e9}.source-line:hover .source-line-code{background-color:#f5f5f5}.source-line [role=button]{cursor:pointer}.source-line-highlighted .source-line-coverage,.source-line-highlighted .source-line-duplications,.source-line-highlighted .source-line-duplications-extra,.source-line-highlighted .source-line-issues,.source-line-highlighted .source-line-number,.source-line-highlighted .source-line-scm,.source-line-highlighted:hover .source-line-coverage,.source-line-highlighted:hover .source-line-duplications,.source-line-highlighted:hover .source-line-duplications-extra,.source-line-highlighted:hover .source-line-issues,.source-line-highlighted:hover .source-line-number,.source-line-highlighted:hover .source-line-scm{border-color:#c4dfec!important;background-color:#c4dfec}.source-line-highlighted .source-line-code,.source-line-highlighted:hover .source-line-code{background-color:#d9edf7}.source-line-filtered .source-line-code{background-color:#fbf3d5!important}.source-line-filtered.source-line-highlighted .source-line-code,.source-line-filtered.source-line-highlighted:hover .source-line-code{background-color:#cdd9c4!important}.source-line-filtered.source-line-filtered-dark .source-line-code{background-color:#f9ebb7!important}.source-line-filtered.source-line-filtered-dark:hover .source-line-code,.source-line-filtered:hover .source-line-code{background-color:#f1e8cb!important}.source-line-last .source-line-code{padding-bottom:160px}.source-line-number,.source-line-scm,.source-viewer pre{line-height:18px;font-family:Consolas,Ubuntu Mono,Liberation Mono,Menlo,Courier,monospace;font-size:12px}.source-line-code{position:relative;padding:0 10px}.source-line-code pre{float:left;word-wrap:break-word;white-space:pre-wrap}.source-line-code .issue-list{margin-left:-10px;margin-right:-10px}.source-line-code-inner{min-height:18px}.source-line-code-inner:after,.source-line-code-inner:before{display:table;content:\\\"\\\";line-height:0}.source-line-code-inner:after{clear:both}.source-line-code-inner pre{-moz-tab-size:4;tab-size:4}.source-line-code-issue{display:inline-block;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAGCAYAAAAPDoR2AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo1M0M2Rjk4M0M3QUYxMUUzODkzRUREMUM5OTNDMjY4QSIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo1M0M2Rjk4NEM3QUYxMUUzODkzRUREMUM5OTNDMjY4QSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjUzQzZGOTgxQzdBRjExRTM4OTNFREQxQzk5M0MyNjhBIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjUzQzZGOTgyQzdBRjExRTM4OTNFREQxQzk5M0MyNjhBIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+bcqJtQAAAEhJREFUeNpi+G+swwDGDAwgbAWlwZiJAQFCgfgwEIfDRaC67ID4NRDnQ2kQnwFZwgFqnANMAQOUYY9sF0wBiCGH5CBkrAgQYACuWi4sSGW8yAAAAABJRU5ErkJggg==);background-repeat:repeat-x;background-size:4px;background-position:bottom}.source-meta{position:relative;vertical-align:top;width:1px;background-clip:padding-box;-webkit-user-select:none;-ms-user-select:none;user-select:none}.source-meta:focus{outline:none}.source-line-number{min-width:18px;padding:0 10px;background-color:#f3f3f3;color:#666;text-align:right}.source-line-issues{position:relative;padding:0 2px;background-color:#f3f3f3;white-space:nowrap}.source-line-with-issues svg{padding-right:2px;vertical-align:middle}.source-line-issues-counter{position:absolute;left:17px;line-height:8px;font-size:8px;z-index:900}.source-line-coverage,.source-line-duplications,.source-line-duplications-extra{background-color:#f3f3f3}.source-line-duplications-extra{display:none}.source-line-scm{padding:0 5px;background-color:#f3f3f3}.source-line-scm .dropdown{display:block}.source-line-scm [role=button]{height:18px}.source-line-scm-inner{max-width:40px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.source-line-bar{width:5px;height:18px}.source-line-bar:focus{outline:none}.source-line-covered{background-color:#b4dd78!important}.source-line-partially-covered,.source-line-uncovered{background-color:#a4030f!important}.source-line-partially-covered{background-image:repeating-linear-gradient(45deg,hsla(0,0%,100%,.5) 4px,transparent 0,transparent 8px,hsla(0,0%,100%,.5) 0,hsla(0,0%,100%,.5) 12px,transparent 0,transparent 16px,hsla(0,0%,100%,.5) 0,hsla(0,0%,100%,.5) 20px)!important}.source-line-duplicated{background-color:#797979!important}.source-viewer-bubble-popup a{font-family:Helvetica Neue,Helvetica,Arial,sans-serif;font-size:13px;text-align:left;-webkit-user-select:text;-ms-user-select:text;user-select:text;border-bottom:none;transition:none;color:unset}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { intersection } from 'lodash';\n\nexport function optimizeHighlightedSymbols(\n  symbolsForLine: string[] = [],\n  highlightedSymbols: string[] = []\n): string[] | undefined {\n  const symbols = intersection(symbolsForLine, highlightedSymbols);\n\n  return symbols.length ? symbols : undefined;\n}\n\nexport function optimizeLocationMessage(\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined,\n  optimizedSecondaryIssueLocations: T.LinearIssueLocation[]\n) {\n  return highlightedLocationMessage != null &&\n    optimizedSecondaryIssueLocations.some(\n      location => location.index === highlightedLocationMessage.index\n    )\n    ? highlightedLocationMessage\n    : undefined;\n}\n\nexport function optimizeSelectedIssue(selectedIssue: string | undefined, issuesForLine: T.Issue[]) {\n  return selectedIssue !== undefined && issuesForLine.find(issue => issue.key === selectedIssue)\n    ? selectedIssue\n    : undefined;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nconst LINES_ABOVE = 5;\nconst LINES_BELOW = 5;\nexport const MERGE_DISTANCE = 11; // Merge if snippets are eleven lines away (separated by 10 lines) or fewer\nexport const LINES_BELOW_ISSUE = 9;\nexport const EXPAND_BY_LINES = 50;\n\nfunction unknownComponent(key: string): T.SnippetsByComponent {\n  return {\n    component: {\n      key,\n      measures: {},\n      path: '',\n      project: '',\n      projectName: '',\n      q: 'FIL',\n      uuid: ''\n    },\n    sources: []\n  };\n}\n\nfunction collision([startA, endA]: number[], [startB, endB]: number[]) {\n  return !(startA > endB + MERGE_DISTANCE || endA < startB - MERGE_DISTANCE);\n}\n\nexport function getPrimaryLocation(issue: T.Issue): T.FlowLocation {\n  return {\n    component: issue.component,\n    textRange: issue.textRange || {\n      endLine: 0,\n      endOffset: 0,\n      startLine: 0,\n      startOffset: 0\n    }\n  };\n}\n\nfunction addLinesBellow(params: { issue: T.Issue; locationEnd: number }) {\n  const { issue, locationEnd } = params;\n  const issueEndLine = (issue.textRange && issue.textRange.endLine) || 0;\n\n  if (!issueEndLine || issueEndLine === locationEnd) {\n    return locationEnd + LINES_BELOW_ISSUE;\n  }\n\n  return locationEnd + LINES_BELOW;\n}\n\nexport function createSnippets(params: {\n  component: string;\n  issue: T.Issue;\n  locations: T.FlowLocation[];\n}): T.Snippet[] {\n  const { component, issue, locations } = params;\n\n  const hasSecondaryLocations = issue.secondaryLocations.length > 0;\n  const addIssueLocation =\n    hasSecondaryLocations && issue.component === component && issue.textRange !== undefined;\n\n  // For each location: compute its range, and then compare with other ranges\n  // to merge snippets that collide.\n  const ranges = (addIssueLocation ? [getPrimaryLocation(issue), ...locations] : locations).reduce(\n    (snippets: T.Snippet[], loc, index) => {\n      const startIndex = Math.max(1, loc.textRange.startLine - LINES_ABOVE);\n      const endIndex = addLinesBellow({ issue, locationEnd: loc.textRange.endLine });\n\n      let firstCollision: { start: number; end: number } | undefined;\n\n      // Remove ranges that collide into the first collision\n      snippets = snippets.filter(snippet => {\n        if (collision([snippet.start, snippet.end], [startIndex, endIndex])) {\n          let keep = false;\n          // Check if we've already collided\n          if (!firstCollision) {\n            firstCollision = snippet;\n            keep = true;\n          }\n          // Merge with first collision:\n          firstCollision.start = Math.min(startIndex, snippet.start, firstCollision.start);\n          firstCollision.end = Math.max(endIndex, snippet.end, firstCollision.end);\n\n          // remove the range if it was not the first collision\n          return keep;\n        }\n        return true;\n      });\n\n      if (firstCollision === undefined) {\n        snippets.push({\n          start: startIndex,\n          end: endIndex,\n          index\n        });\n      }\n\n      return snippets;\n    },\n    []\n  );\n\n  // Sort snippets by line number in the case of secondary locations\n  // Preserve location order for flows!\n  return hasSecondaryLocations ? ranges.sort((a, b) => a.start - b.start) : ranges;\n}\n\nexport function linesForSnippets(snippets: T.Snippet[], componentLines: T.LineMap) {\n  return snippets\n    .map(snippet => {\n      const lines = [];\n      for (let i = snippet.start; i <= snippet.end; i++) {\n        if (componentLines[i]) {\n          lines.push(componentLines[i]);\n        }\n      }\n      return lines;\n    })\n    .filter(snippet => snippet.length > 0);\n}\n\nexport function groupLocationsByComponent(\n  issue: T.Issue,\n  locations: T.FlowLocation[],\n  components: { [key: string]: T.SnippetsByComponent }\n) {\n  let currentComponent = '';\n  let currentGroup: T.SnippetGroup;\n  const groups: T.SnippetGroup[] = [];\n\n  const addGroup = (componentKey: string) => {\n    currentGroup = {\n      ...(components[componentKey] || unknownComponent(componentKey)),\n      locations: []\n    };\n    groups.push(currentGroup);\n    currentComponent = componentKey;\n  };\n\n  if (\n    issue.secondaryLocations.length > 0 &&\n    locations.every(loc => loc.component !== issue.component)\n  ) {\n    addGroup(issue.component);\n  }\n\n  locations.forEach((loc, index) => {\n    if (loc.component !== currentComponent) {\n      addGroup(loc.component);\n    }\n    loc.index = index;\n    currentGroup.locations.push(loc);\n  });\n\n  return groups;\n}\n\nexport function expandSnippet({\n  direction,\n  snippetIndex,\n  snippets\n}: {\n  direction: T.ExpandDirection;\n  snippetIndex: number;\n  snippets: T.Snippet[];\n}) {\n  const snippetToExpand = snippets.find(s => s.index === snippetIndex);\n  if (!snippetToExpand) {\n    throw new Error(`Snippet ${snippetIndex} not found`);\n  }\n\n  snippetToExpand.start = Math.max(\n    0,\n    snippetToExpand.start - (direction === 'up' ? EXPAND_BY_LINES : 0)\n  );\n  snippetToExpand.end += direction === 'down' ? EXPAND_BY_LINES : 0;\n\n  return snippets.map(snippet => {\n    if (snippet.index === snippetIndex) {\n      return snippetToExpand;\n    }\n    if (collision([snippet.start, snippet.end], [snippetToExpand.start, snippetToExpand.end])) {\n      // Merge with expanded snippet\n      snippetToExpand.start = Math.min(snippet.start, snippetToExpand.start);\n      snippetToExpand.end = Math.max(snippet.end, snippetToExpand.end);\n      snippet.toDelete = true;\n    }\n    return snippet;\n  });\n}\n\nexport function inSnippet(line: number, snippet: T.SourceLine[]) {\n  return line >= snippet[0].line && line <= snippet[snippet.length - 1].line;\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { BranchLike } from '../../../types/branch-like';\nimport Issue from '../../issue/Issue';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  displayIssueLocationsCount?: boolean;\n  displayIssueLocationsLink?: boolean;\n  issuePopup: { issue: string; name: string } | undefined;\n  issues: T.Issue[];\n  onIssueChange: (issue: T.Issue) => void;\n  onIssueClick: (issueKey: string) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  selectedIssue: string | undefined;\n}\n\nexport default function LineIssuesList(props: Props) {\n  const { issuePopup } = props;\n\n  return (\n    <div className=\"issue-list\">\n      {props.issues.map(issue => (\n        <Issue\n          branchLike={props.branchLike}\n          displayLocationsCount={props.displayIssueLocationsCount}\n          displayLocationsLink={props.displayIssueLocationsLink}\n          issue={issue}\n          key={issue.key}\n          onChange={props.onIssueChange}\n          onClick={props.onIssueClick}\n          onPopupToggle={props.onIssuePopupToggle}\n          openPopup={issuePopup && issuePopup.issue === issue.key ? issuePopup.name : undefined}\n          selected={props.selectedIssue === issue.key}\n        />\n      ))}\n    </div>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { BranchLike } from '../../../types/branch-like';\nimport LocationIndex from '../../common/LocationIndex';\nimport LocationMessage from '../../common/LocationMessage';\nimport {\n  highlightIssueLocations,\n  highlightSymbol,\n  splitByTokens,\n  Token\n} from '../helpers/highlight';\nimport LineIssuesList from './LineIssuesList';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  displayIssueLocationsCount?: boolean;\n  displayIssueLocationsLink?: boolean;\n  displayLocationMarkers?: boolean;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[] | undefined;\n  issueLocations: T.LinearIssueLocation[];\n  issuePopup: { issue: string; name: string } | undefined;\n  issues: T.Issue[];\n  line: T.SourceLine;\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onIssueSelect: (issueKey: string) => void;\n  onLocationSelect: ((index: number) => void) | undefined;\n  onSymbolClick: (symbols: Array<string>) => void;\n  padding?: number;\n  scroll?: (element: HTMLElement) => void;\n  secondaryIssueLocations: T.LinearIssueLocation[];\n  selectedIssue: string | undefined;\n  showIssues?: boolean;\n}\n\ninterface State {\n  tokens: Token[];\n}\n\nexport default class LineCode extends React.PureComponent<Props, State> {\n  activeMarkerNode?: HTMLElement | null;\n  codeNode?: HTMLElement | null;\n  symbols?: NodeListOf<HTMLElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.state = {\n      tokens: splitByTokens(props.line.code || '')\n    };\n  }\n\n  componentDidMount() {\n    this.attachEvents();\n    if (this.props.highlightedLocationMessage && this.activeMarkerNode && this.props.scroll) {\n      this.props.scroll(this.activeMarkerNode);\n    }\n  }\n\n  componentWillReceiveProps(nextProps: Props) {\n    if (nextProps.line.code !== this.props.line.code) {\n      this.setState({\n        tokens: splitByTokens(nextProps.line.code || '')\n      });\n    }\n  }\n\n  componentWillUpdate() {\n    this.detachEvents();\n  }\n\n  componentDidUpdate(prevProps: Props) {\n    this.attachEvents();\n    if (\n      this.props.highlightedLocationMessage &&\n      (!prevProps.highlightedLocationMessage ||\n        prevProps.highlightedLocationMessage.index !==\n          this.props.highlightedLocationMessage.index) &&\n      this.activeMarkerNode &&\n      this.props.scroll\n    ) {\n      this.props.scroll(this.activeMarkerNode);\n    }\n  }\n\n  componentWillUnmount() {\n    this.detachEvents();\n  }\n\n  attachEvents() {\n    if (this.codeNode) {\n      this.symbols = this.codeNode.querySelectorAll('.sym');\n      if (this.symbols) {\n        for (let i = 0; i < this.symbols.length; i++) {\n          const symbol = this.symbols[i];\n          symbol.addEventListener('click', this.handleSymbolClick);\n        }\n      }\n    }\n  }\n\n  detachEvents() {\n    if (this.symbols) {\n      for (let i = 0; i < this.symbols.length; i++) {\n        const symbol = this.symbols[i];\n        symbol.addEventListener('click', this.handleSymbolClick);\n      }\n    }\n  }\n\n  handleSymbolClick = (event: MouseEvent) => {\n    event.preventDefault();\n    const keys = (event.currentTarget as HTMLElement).className.match(/sym-\\d+/g);\n    if (keys && keys.length > 0) {\n      this.props.onSymbolClick(keys);\n    }\n  };\n\n  renderMarker(index: number, message: string | undefined, selected: boolean, leading: boolean) {\n    const { onLocationSelect } = this.props;\n    const onClick = onLocationSelect ? () => onLocationSelect(index) : undefined;\n    const ref = selected ? (node: HTMLElement | null) => (this.activeMarkerNode = node) : undefined;\n    return (\n      <LocationIndex\n        key={`marker-${index}`}\n        leading={leading}\n        onClick={onClick}\n        selected={selected}>\n        <span ref={ref}>{index + 1}</span>\n        {message && <LocationMessage selected={true}>{message}</LocationMessage>}\n      </LocationIndex>\n    );\n  }\n\n  render() {\n    const {\n      highlightedLocationMessage,\n      highlightedSymbols,\n      issues,\n      issueLocations,\n      line,\n      onIssueSelect,\n      padding,\n      secondaryIssueLocations,\n      selectedIssue,\n      showIssues\n    } = this.props;\n\n    let tokens = [...this.state.tokens];\n\n    if (highlightedSymbols) {\n      highlightedSymbols.forEach(symbol => {\n        tokens = highlightSymbol(tokens, symbol);\n      });\n    }\n\n    if (issueLocations.length > 0) {\n      tokens = highlightIssueLocations(tokens, issueLocations);\n    }\n\n    if (secondaryIssueLocations) {\n      tokens = highlightIssueLocations(tokens, secondaryIssueLocations, 'issue-location');\n\n      if (highlightedLocationMessage) {\n        const location = secondaryIssueLocations.find(\n          location => location.index === highlightedLocationMessage.index\n        );\n        if (location) {\n          tokens = highlightIssueLocations(tokens, [location], 'selected');\n        }\n      }\n    }\n\n    const className = classNames('source-line-code', 'code', {\n      'has-issues': issues.length > 0\n    });\n\n    const renderedTokens: React.ReactNode[] = [];\n\n    // track if the first marker is displayed before the source code\n    // set `false` for the first token in a row\n    let leadingMarker = false;\n\n    tokens.forEach((token, index) => {\n      if (this.props.displayLocationMarkers && token.markers.length > 0) {\n        token.markers.forEach(marker => {\n          const selected =\n            highlightedLocationMessage !== undefined && highlightedLocationMessage.index === marker;\n          const loc = secondaryIssueLocations.find(loc => loc.index === marker);\n          const message = loc && loc.text;\n          renderedTokens.push(this.renderMarker(marker, message, selected, leadingMarker));\n        });\n      }\n      renderedTokens.push(\n        <span className={token.className} key={index}>\n          {token.text}\n        </span>\n      );\n\n      // keep leadingMarker truthy if previous token has only whitespaces\n      leadingMarker = (index === 0 ? true : leadingMarker) && !token.text.trim().length;\n    });\n\n    const style = padding ? { paddingBottom: `${padding}px` } : undefined;\n    const filteredSelectedIssues = issues.filter(i => i.key === selectedIssue);\n\n    return (\n      <td className={className} data-line-number={line.line} style={style}>\n        <div className=\"source-line-code-inner\">\n          <pre ref={node => (this.codeNode = node)}>{renderedTokens}</pre>\n        </div>\n        {showIssues && issues.length > 0 && (\n          <LineIssuesList\n            branchLike={this.props.branchLike}\n            displayIssueLocationsCount={this.props.displayIssueLocationsCount}\n            displayIssueLocationsLink={this.props.displayIssueLocationsLink}\n            issuePopup={this.props.issuePopup}\n            issues={issues}\n            onIssueChange={this.props.onIssueChange}\n            onIssueClick={onIssueSelect}\n            onIssuePopupToggle={this.props.onIssuePopupToggle}\n            selectedIssue={selectedIssue}\n          />\n        )}\n        {selectedIssue && !showIssues && (\n          <LineIssuesList\n            branchLike={this.props.branchLike}\n            issuePopup={this.props.issuePopup}\n            issues={filteredSelectedIssues}\n            onIssueChange={this.props.onIssueChange}\n            onIssueClick={onIssueSelect}\n            onIssuePopupToggle={this.props.onIssuePopupToggle}\n            selectedIssue={selectedIssue}\n          />\n        )}\n      </td>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\n\nexport interface LineCoverageProps {\n  line: T.SourceLine;\n  scroll?: (element: HTMLElement) => void;\n  scrollToUncoveredLine?: boolean;\n}\n\nexport function LineCoverage({ line, scroll, scrollToUncoveredLine }: LineCoverageProps) {\n  const coverageMarker = React.useRef<HTMLTableDataCellElement>(null);\n  React.useEffect(() => {\n    if (scrollToUncoveredLine && scroll && coverageMarker.current) {\n      scroll(coverageMarker.current);\n    }\n  }, [scrollToUncoveredLine, scroll, coverageMarker]);\n\n  const className =\n    'source-meta source-line-coverage' +\n    (line.coverageStatus != null ? ` source-line-${line.coverageStatus}` : '');\n  const status = getStatusTooltip(line);\n\n  return (\n    <td className={className} data-line-number={line.line} ref={coverageMarker}>\n      <Tooltip overlay={status} placement=\"bottom\">\n        <div aria-label={status} className=\"source-line-bar\" />\n      </Tooltip>\n    </td>\n  );\n}\n\nfunction getStatusTooltip(line: T.SourceLine) {\n  if (line.coverageStatus === 'uncovered') {\n    if (line.conditions) {\n      return translateWithParameters('source_viewer.tooltip.uncovered.conditions', line.conditions);\n    } else {\n      return translate('source_viewer.tooltip.uncovered');\n    }\n  } else if (line.coverageStatus === 'covered') {\n    if (line.conditions) {\n      return translateWithParameters('source_viewer.tooltip.covered.conditions', line.conditions);\n    } else {\n      return translate('source_viewer.tooltip.covered');\n    }\n  } else if (line.coverageStatus === 'partially-covered') {\n    if (line.conditions) {\n      return translateWithParameters(\n        'source_viewer.tooltip.partially-covered.conditions',\n        line.coveredConditions || 0,\n        line.conditions\n      );\n    } else {\n      return translate('source_viewer.tooltip.partially-covered');\n    }\n  }\n  return undefined;\n}\n\nexport default React.memo(LineCoverage);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\nexport interface LineDuplicationBlockProps {\n  blocksLoaded: boolean;\n  duplicated: boolean;\n  index: number;\n  line: T.SourceLine;\n  onClick?: (line: T.SourceLine) => void;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n}\n\nexport function LineDuplicationBlock(props: LineDuplicationBlockProps) {\n  const { blocksLoaded, duplicated, index, line } = props;\n  const [dropdownOpen, setDropdownOpen] = React.useState(false);\n\n  const className = classNames('source-meta', 'source-line-duplications', {\n    'source-line-duplicated': duplicated\n  });\n\n  return duplicated ? (\n    <td className={className} data-index={index} data-line-number={line.line}>\n      <Tooltip\n        overlay={dropdownOpen ? undefined : translate('source_viewer.tooltip.duplicated_block')}\n        placement=\"right\">\n        <div>\n          <Toggler\n            onRequestClose={() => setDropdownOpen(false)}\n            open={dropdownOpen}\n            overlay={\n              <DropdownOverlay placement={PopupPlacement.RightTop}>\n                {props.renderDuplicationPopup(index, line.line)}\n              </DropdownOverlay>\n            }>\n            <div\n              aria-label={translate('source_viewer.tooltip.duplicated_block')}\n              className=\"source-line-bar\"\n              onClick={() => {\n                setDropdownOpen(true);\n                if (!blocksLoaded && line.duplicated && props.onClick) {\n                  props.onClick(line);\n                }\n              }}\n              role=\"button\"\n              tabIndex={0}\n            />\n          </Toggler>\n        </div>\n      </Tooltip>\n    </td>\n  ) : (\n    <td className={className} data-index={index} data-line-number={line.line}>\n      <div className=\"source-line-bar\" />\n    </td>\n  );\n}\n\nexport default React.memo(LineDuplicationBlock);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport { uniq } from 'lodash';\nimport * as React from 'react';\nimport Tooltip from 'sonar-ui-common/components/controls/Tooltip';\nimport IssueIcon from 'sonar-ui-common/components/icons/IssueIcon';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport { sortByType } from '../../../helpers/issues';\n\nexport interface LineIssuesIndicatorProps {\n  issues: T.Issue[];\n  issuesOpen?: boolean;\n  line: T.SourceLine;\n  onClick: () => void;\n}\n\nexport function LineIssuesIndicator(props: LineIssuesIndicatorProps) {\n  const { issues, issuesOpen, line } = props;\n  const hasIssues = issues.length > 0;\n  const className = classNames('source-meta', 'source-line-issues', {\n    'source-line-with-issues': hasIssues\n  });\n\n  if (!hasIssues) {\n    return <td className={className} data-line-number={line.line} />;\n  }\n\n  const mostImportantIssue = sortByType(issues)[0];\n  const issueTypes = uniq(issues.map(i => i.type));\n\n  let tooltipContent;\n  if (issueTypes.length > 1) {\n    tooltipContent = translate('source_viewer.issues_on_line.multiple_issues');\n  } else if (issues.length === 1) {\n    tooltipContent = translateWithParameters(\n      'source_viewer.issues_on_line.issue_of_type_X',\n      translate('issue.type', mostImportantIssue.type)\n    );\n  } else {\n    tooltipContent = translateWithParameters(\n      'source_viewer.issues_on_line.X_issues_of_type_Y',\n      issues.length,\n      translate('issue.type', mostImportantIssue.type, 'plural')\n    );\n  }\n\n  return (\n    <td className={className} data-line-number={line.line}>\n      <span\n        aria-label={translate('source_viewer.issues_on_line', issuesOpen ? 'hide' : 'show')}\n        onClick={(e: React.MouseEvent<HTMLElement>) => {\n          e.preventDefault();\n          e.currentTarget.blur();\n          props.onClick();\n        }}\n        role=\"button\"\n        tabIndex={0}>\n        <Tooltip overlay={tooltipContent}>\n          <IssueIcon type={mostImportantIssue.type} />\n        </Tooltip>\n        {issues.length > 1 && <span className=\"source-line-issues-counter\">{issues.length}</span>}\n      </span>\n    </td>\n  );\n}\n\nexport default React.memo(LineIssuesIndicator);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport { ActionsDropdownItem } from 'sonar-ui-common/components/controls/ActionsDropdown';\nimport { DropdownOverlay } from 'sonar-ui-common/components/controls/Dropdown';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { getPathUrlAsString } from 'sonar-ui-common/helpers/urls';\nimport { getCodeUrl } from '../../../helpers/urls';\nimport { SourceViewerContext } from '../SourceViewerContext';\n\nexport interface LineOptionsPopupProps {\n  firstLineNumber: number;\n  line: T.SourceLine;\n}\n\nexport function LineOptionsPopup({ firstLineNumber, line }: LineOptionsPopupProps) {\n  return (\n    <SourceViewerContext.Consumer>\n      {({ branchLike, file }) => {\n        const codeLocation = getCodeUrl(file.project, branchLike, file.key, line.line);\n        const codeUrl = getPathUrlAsString(codeLocation, false);\n        const isAtTop = line.line - 4 < firstLineNumber;\n        return (\n          <DropdownOverlay\n            className=\"big-spacer-left\"\n            noPadding={true}\n            placement={isAtTop ? PopupPlacement.BottomLeft : PopupPlacement.TopLeft}>\n            <ul className=\"padded source-viewer-bubble-popup nowrap\">\n              <ActionsDropdownItem copyValue={codeUrl}>\n                {translate('component_viewer.copy_permalink')}\n              </ActionsDropdownItem>\n            </ul>\n          </DropdownOverlay>\n        );\n      }}\n    </SourceViewerContext.Consumer>\n  );\n}\n\nexport default React.memo(LineOptionsPopup);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Toggler from 'sonar-ui-common/components/controls/Toggler';\nimport { translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport LineOptionsPopup from './LineOptionsPopup';\n\nexport interface LineNumberProps {\n  displayOptions: boolean;\n  firstLineNumber: number;\n  line: T.SourceLine;\n}\n\nexport function LineNumber({ displayOptions, firstLineNumber, line }: LineNumberProps) {\n  const [isOpen, setOpen] = React.useState<boolean>(false);\n  const { line: lineNumber } = line;\n  const hasLineNumber = !!lineNumber;\n\n  return hasLineNumber ? (\n    <td className=\"source-meta source-line-number\" data-line-number={lineNumber}>\n      {displayOptions ? (\n        <Toggler\n          closeOnClickOutside={true}\n          onRequestClose={() => setOpen(false)}\n          open={isOpen}\n          overlay={<LineOptionsPopup firstLineNumber={firstLineNumber} line={line} />}>\n          <span\n            aria-expanded={isOpen}\n            aria-haspopup={true}\n            aria-label={translateWithParameters('source_viewer.line_X', lineNumber)}\n            onClick={() => setOpen(true)}\n            role=\"button\"\n            tabIndex={0}>\n            {lineNumber}\n          </span>\n        </Toggler>\n      ) : (\n        lineNumber\n      )}\n    </td>\n  ) : (\n    <td className=\"source-meta source-line-number\" />\n  );\n}\n\nexport default React.memo(LineNumber);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport DateFormatter from 'sonar-ui-common/components/intl/DateFormatter';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\nexport interface SCMPopupProps {\n  line: T.SourceLine;\n}\n\nexport function SCMPopup({ line }: SCMPopupProps) {\n  const hasAuthor = line.scmAuthor !== undefined && line.scmAuthor !== '';\n  const hasDate = line.scmDate !== undefined;\n  return (\n    <div className=\"source-viewer-bubble-popup abs-width-400\">\n      {hasAuthor && (\n        <div>\n          <h4>{translate('author')}</h4>\n          {line.scmAuthor}\n        </div>\n      )}\n      {hasDate && (\n        <div className={classNames({ 'spacer-top': hasAuthor })}>\n          <h4>{translate('source_viewer.tooltip.scm.commited_on')}</h4>\n          <DateFormatter date={line.scmDate!} />\n        </div>\n      )}\n      {line.scmRevision && (\n        <div className={classNames({ 'spacer-top': hasAuthor || hasDate })}>\n          <h4>{translate('source_viewer.tooltip.scm.revision')}</h4>\n          {line.scmRevision}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default React.memo(SCMPopup);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport Dropdown from 'sonar-ui-common/components/controls/Dropdown';\nimport { PopupPlacement } from 'sonar-ui-common/components/ui/popups';\nimport { translate, translateWithParameters } from 'sonar-ui-common/helpers/l10n';\nimport SCMPopup from './SCMPopup';\n\nexport interface LineSCMProps {\n  line: T.SourceLine;\n  previousLine: T.SourceLine | undefined;\n}\n\nexport function LineSCM({ line, previousLine }: LineSCMProps) {\n  const hasPopup = !!line.line;\n  const cell = (\n    <div className=\"source-line-scm-inner\">\n      {isSCMChanged(line, previousLine) ? line.scmAuthor || '' : ' '}\n    </div>\n  );\n\n  if (hasPopup) {\n    let ariaLabel = translate('source_viewer.click_for_scm_info');\n    if (line.scmAuthor) {\n      ariaLabel = `${translateWithParameters(\n        'source_viewer.author_X',\n        line.scmAuthor\n      )}, ${ariaLabel}`;\n    }\n\n    return (\n      <td className=\"source-meta source-line-scm\" data-line-number={line.line}>\n        <Dropdown overlay={<SCMPopup line={line} />} overlayPlacement={PopupPlacement.RightTop}>\n          <div aria-label={ariaLabel} role=\"button\">\n            {cell}\n          </div>\n        </Dropdown>\n      </td>\n    );\n  } else {\n    return (\n      <td className=\"source-meta source-line-scm\" data-line-number={line.line}>\n        {cell}\n      </td>\n    );\n  }\n}\n\nfunction isSCMChanged(s: T.SourceLine, p: T.SourceLine | undefined) {\n  let changed = true;\n  if (p != null && s.scmRevision != null && p.scmRevision != null) {\n    changed = s.scmRevision !== p.scmRevision || s.scmDate !== p.scmDate;\n  }\n  return changed;\n}\n\nexport default React.memo(LineSCM);\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport { times } from 'lodash';\nimport * as React from 'react';\nimport { BranchLike } from '../../../types/branch-like';\nimport './Line.css';\nimport LineCode from './LineCode';\nimport LineCoverage from './LineCoverage';\nimport LineDuplicationBlock from './LineDuplicationBlock';\nimport LineIssuesIndicator from './LineIssuesIndicator';\nimport LineNumber from './LineNumber';\nimport LineSCM from './LineSCM';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  displayAllIssues?: boolean;\n  displayCoverage: boolean;\n  displayDuplications: boolean;\n  displayIssueLocationsCount?: boolean;\n  displayIssueLocationsLink?: boolean;\n  displayIssues: boolean;\n  displayLineNumberOptions?: boolean;\n  displayLocationMarkers?: boolean;\n  displaySCM?: boolean;\n  duplications: number[];\n  duplicationsCount: number;\n  firstLineNumber: number;\n  highlighted: boolean;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[] | undefined;\n  issueLocations: T.LinearIssueLocation[];\n  issuePopup: { issue: string; name: string } | undefined;\n  issues: T.Issue[];\n  last: boolean;\n  line: T.SourceLine;\n  loadDuplications: (line: T.SourceLine) => void;\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issueKey: string, popupName: string, open?: boolean) => void;\n  onIssuesClose: (line: T.SourceLine) => void;\n  onIssueSelect: (issueKey: string) => void;\n  onIssuesOpen: (line: T.SourceLine) => void;\n  onIssueUnselect: () => void;\n  onLocationSelect: ((x: number) => void) | undefined;\n  onSymbolClick: (symbols: string[]) => void;\n  openIssues: boolean;\n  previousLine: T.SourceLine | undefined;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement) => void;\n  scrollToUncoveredLine?: boolean;\n  secondaryIssueLocations: T.LinearIssueLocation[];\n  selectedIssue: string | undefined;\n  verticalBuffer?: number;\n}\n\nconst LINE_HEIGHT = 18;\n\nexport default class Line extends React.PureComponent<Props> {\n  handleIssuesIndicatorClick = () => {\n    if (this.props.openIssues) {\n      this.props.onIssuesClose(this.props.line);\n      this.props.onIssueUnselect();\n    } else {\n      this.props.onIssuesOpen(this.props.line);\n\n      const { issues } = this.props;\n      if (issues.length > 0) {\n        this.props.onIssueSelect(issues[0].key);\n      }\n    }\n  };\n\n  render() {\n    const {\n      branchLike,\n      displayAllIssues,\n      displayCoverage,\n      displayDuplications,\n      displayIssueLocationsCount,\n      displayIssueLocationsLink,\n      displayLineNumberOptions,\n      displayLocationMarkers,\n      highlightedLocationMessage,\n      displayIssues,\n      displaySCM = true,\n      duplications,\n      duplicationsCount,\n      firstLineNumber,\n      highlighted,\n      highlightedSymbols,\n      issueLocations,\n      issuePopup,\n      issues,\n      last,\n      line,\n      openIssues,\n      previousLine,\n      scrollToUncoveredLine,\n      secondaryIssueLocations,\n      selectedIssue,\n      verticalBuffer\n    } = this.props;\n\n    const className = classNames('source-line', {\n      'source-line-highlighted': highlighted,\n      'source-line-filtered': line.isNew,\n      'source-line-filtered-dark':\n        displayCoverage &&\n        (line.coverageStatus === 'uncovered' || line.coverageStatus === 'partially-covered'),\n      'source-line-last': last === true\n    });\n\n    const bottomPadding = verticalBuffer ? verticalBuffer * LINE_HEIGHT : undefined;\n\n    // default is true\n    const displayOptions = displayLineNumberOptions !== false;\n\n    return (\n      <tr className={className} data-line-number={line.line}>\n        <LineNumber displayOptions={displayOptions} firstLineNumber={firstLineNumber} line={line} />\n\n        {displaySCM && <LineSCM line={line} previousLine={previousLine} />}\n        {displayIssues && !displayAllIssues ? (\n          <LineIssuesIndicator\n            issues={issues}\n            issuesOpen={openIssues}\n            line={line}\n            onClick={this.handleIssuesIndicatorClick}\n          />\n        ) : (\n          <td className=\"source-meta source-line-issues\" />\n        )}\n\n        {displayDuplications && (\n          <LineDuplicationBlock\n            blocksLoaded={duplicationsCount > 0}\n            duplicated={Boolean(line.duplicated)}\n            index={0}\n            key={0}\n            line={this.props.line}\n            onClick={this.props.loadDuplications}\n            renderDuplicationPopup={this.props.renderDuplicationPopup}\n          />\n        )}\n\n        {duplicationsCount > 1 &&\n          times(duplicationsCount - 1, index => (\n            <LineDuplicationBlock\n              blocksLoaded={true}\n              duplicated={duplications.includes(index + 1)}\n              index={index + 1}\n              key={index + 1}\n              line={this.props.line}\n              renderDuplicationPopup={this.props.renderDuplicationPopup}\n            />\n          ))}\n\n        {displayCoverage && (\n          <LineCoverage\n            line={line}\n            scroll={this.props.scroll}\n            scrollToUncoveredLine={scrollToUncoveredLine}\n          />\n        )}\n\n        <LineCode\n          branchLike={branchLike}\n          displayIssueLocationsCount={displayIssueLocationsCount}\n          displayIssueLocationsLink={displayIssueLocationsLink}\n          displayLocationMarkers={displayLocationMarkers}\n          highlightedLocationMessage={highlightedLocationMessage}\n          highlightedSymbols={highlightedSymbols}\n          issueLocations={issueLocations}\n          issuePopup={issuePopup}\n          issues={issues}\n          line={line}\n          onIssueChange={this.props.onIssueChange}\n          onIssuePopupToggle={this.props.onIssuePopupToggle}\n          onIssueSelect={this.props.onIssueSelect}\n          onLocationSelect={this.props.onLocationSelect}\n          onSymbolClick={this.props.onSymbolClick}\n          padding={bottomPadding}\n          scroll={this.props.scroll}\n          secondaryIssueLocations={secondaryIssueLocations}\n          selectedIssue={selectedIssue}\n          showIssues={openIssues || displayAllIssues}\n        />\n      </tr>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport classNames from 'classnames';\nimport * as React from 'react';\nimport ExpandSnippetIcon from 'sonar-ui-common/components/icons/ExpandSnippetIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { scrollHorizontally } from 'sonar-ui-common/helpers/scrolling';\nimport Line from '../../../components/SourceViewer/components/Line';\nimport { symbolsByLine } from '../../../components/SourceViewer/helpers/indexing';\nimport { getSecondaryIssueLocationsForLine } from '../../../components/SourceViewer/helpers/issueLocations';\nimport {\n  optimizeHighlightedSymbols,\n  optimizeLocationMessage,\n  optimizeSelectedIssue\n} from '../../../components/SourceViewer/helpers/lines';\nimport { BranchLike } from '../../../types/branch-like';\nimport './SnippetViewer.css';\nimport { inSnippet, LINES_BELOW_ISSUE } from './utils';\n\ninterface Props {\n  branchLike: BranchLike | undefined;\n  component: T.SourceViewerFile;\n  displayLineNumberOptions?: boolean;\n  displaySCM?: boolean;\n  duplications?: T.Duplication[];\n  duplicationsByLine?: { [line: number]: number[] };\n  expandBlock: (snippetIndex: number, direction: T.ExpandDirection) => Promise<void>;\n  handleCloseIssues: (line: T.SourceLine) => void;\n  handleOpenIssues: (line: T.SourceLine) => void;\n  handleSymbolClick: (symbols: string[]) => void;\n  highlightedLocationMessage: { index: number; text: string | undefined } | undefined;\n  highlightedSymbols: string[];\n  index: number;\n  issue: Pick<T.Issue, 'key' | 'textRange' | 'line'>;\n  issuePopup?: { issue: string; name: string };\n  issuesByLine: T.IssuesByLine;\n  lastSnippetOfLastGroup: boolean;\n  loadDuplications?: (line: T.SourceLine) => void;\n  locations: T.FlowLocation[];\n  locationsByLine: { [line: number]: T.LinearIssueLocation[] };\n  onIssueChange: (issue: T.Issue) => void;\n  onIssuePopupToggle: (issue: string, popupName: string, open?: boolean) => void;\n  onLocationSelect: (index: number) => void;\n  openIssuesByLine: T.Dict<boolean>;\n  renderDuplicationPopup: (index: number, line: number) => React.ReactNode;\n  scroll?: (element: HTMLElement, offset?: number) => void;\n  snippet: T.SourceLine[];\n}\n\nexport default class SnippetViewer extends React.PureComponent<Props> {\n  snippetNodeRef: React.RefObject<HTMLDivElement>;\n\n  constructor(props: Props) {\n    super(props);\n    this.snippetNodeRef = React.createRef();\n  }\n\n  doScroll = (element: HTMLElement) => {\n    if (this.props.scroll) {\n      this.props.scroll(element);\n    }\n    const parent = this.snippetNodeRef.current as Element;\n\n    if (parent) {\n      const offset = parent.getBoundingClientRect().width / 2;\n\n      scrollHorizontally(element, {\n        leftOffset: offset,\n        rightOffset: offset,\n        parent\n      });\n    }\n  };\n\n  scrollToLastExpandedRow = () => {\n    if (this.props.scroll) {\n      const snippetNode = this.snippetNodeRef.current as Element;\n      if (!snippetNode) {\n        return;\n      }\n      const rows = snippetNode.querySelectorAll('tr');\n      const lastRow = rows[rows.length - 1];\n      this.props.scroll(lastRow, 100);\n    }\n  };\n\n  expandBlock = (direction: T.ExpandDirection) => () =>\n    this.props.expandBlock(this.props.index, direction).then(() => {\n      if (direction === 'down') {\n        this.scrollToLastExpandedRow();\n      }\n    });\n\n  renderLine({\n    displayDuplications,\n    displaySCM,\n    index,\n    issuesForLine,\n    issueLocations,\n    line,\n    snippet,\n    symbols,\n    verticalBuffer\n  }: {\n    displayDuplications: boolean;\n    displaySCM?: boolean;\n    index: number;\n    issuesForLine: T.Issue[];\n    issueLocations: T.LinearIssueLocation[];\n    line: T.SourceLine;\n    snippet: T.SourceLine[];\n    symbols: string[];\n    verticalBuffer: number;\n  }) {\n    const secondaryIssueLocations = getSecondaryIssueLocationsForLine(line, this.props.locations);\n\n    const { displayLineNumberOptions, duplications, duplicationsByLine } = this.props;\n    const duplicationsCount = duplications ? duplications.length : 0;\n    const lineDuplications =\n      (duplicationsCount && duplicationsByLine && duplicationsByLine[line.line]) || [];\n\n    const isSinkLine = issuesForLine.some(i => i.key === this.props.issue.key);\n    const firstLineNumber = snippet && snippet.length ? snippet[0].line : 0;\n    const noop = () => {};\n\n    return (\n      <Line\n        branchLike={this.props.branchLike}\n        displayAllIssues={false}\n        displayCoverage={true}\n        displayDuplications={displayDuplications}\n        displayIssues={!isSinkLine || issuesForLine.length > 1}\n        displayLineNumberOptions={displayLineNumberOptions}\n        displayLocationMarkers={true}\n        displaySCM={displaySCM}\n        duplications={lineDuplications}\n        duplicationsCount={duplicationsCount}\n        firstLineNumber={firstLineNumber}\n        highlighted={false}\n        highlightedLocationMessage={optimizeLocationMessage(\n          this.props.highlightedLocationMessage,\n          secondaryIssueLocations\n        )}\n        highlightedSymbols={optimizeHighlightedSymbols(symbols, this.props.highlightedSymbols)}\n        issueLocations={issueLocations}\n        issuePopup={this.props.issuePopup}\n        issues={issuesForLine}\n        key={line.line}\n        last={false}\n        line={line}\n        loadDuplications={this.props.loadDuplications || noop}\n        onIssueChange={this.props.onIssueChange}\n        onIssuePopupToggle={this.props.onIssuePopupToggle}\n        onIssueSelect={noop}\n        onIssueUnselect={noop}\n        onIssuesClose={this.props.handleCloseIssues}\n        onIssuesOpen={this.props.handleOpenIssues}\n        onLocationSelect={this.props.onLocationSelect}\n        onSymbolClick={this.props.handleSymbolClick}\n        openIssues={this.props.openIssuesByLine[line.line]}\n        previousLine={index > 0 ? snippet[index - 1] : undefined}\n        renderDuplicationPopup={this.props.renderDuplicationPopup}\n        scroll={this.doScroll}\n        secondaryIssueLocations={secondaryIssueLocations}\n        selectedIssue={optimizeSelectedIssue(this.props.issue.key, issuesForLine)}\n        verticalBuffer={verticalBuffer}\n      />\n    );\n  }\n\n  render() {\n    const {\n      component,\n      displaySCM,\n      issue,\n      issuesByLine = {},\n      lastSnippetOfLastGroup,\n      locationsByLine,\n      openIssuesByLine,\n      snippet\n    } = this.props;\n    const lastLine =\n      component.measures && component.measures.lines && parseInt(component.measures.lines, 10);\n\n    const symbols = symbolsByLine(snippet);\n\n    const bottomLine = snippet[snippet.length - 1].line;\n    const issueLine = issue.textRange ? issue.textRange.endLine : issue.line;\n    const lowestVisibleIssue = Math.max(\n      ...Object.keys(issuesByLine)\n        .map(k => parseInt(k, 10))\n        .filter(l => inSnippet(l, snippet) && (l === issueLine || openIssuesByLine[l]))\n    );\n    const verticalBuffer = lastSnippetOfLastGroup\n      ? Math.max(0, LINES_BELOW_ISSUE - (bottomLine - lowestVisibleIssue))\n      : 0;\n\n    const displayDuplications =\n      Boolean(this.props.loadDuplications) && snippet.some(s => !!s.duplicated);\n\n    return (\n      <div className=\"source-viewer-code snippet\" ref={this.snippetNodeRef}>\n        <div>\n          {snippet[0].line > 1 && (\n            <div className=\"expand-block expand-block-above\">\n              <button\n                aria-label={translate('source_viewer.expand_above')}\n                onClick={this.expandBlock('up')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n          <table\n            className={classNames('source-table', {\n              'expand-up': snippet[0].line > 1,\n              'expand-down': !lastLine || snippet[snippet.length - 1].line < lastLine\n            })}>\n            <tbody>\n              {snippet.map((line, index) =>\n                this.renderLine({\n                  displayDuplications,\n                  displaySCM,\n                  index,\n                  issuesForLine: issuesByLine[line.line] || [],\n                  issueLocations: locationsByLine[line.line] || [],\n                  line,\n                  snippet,\n                  symbols: symbols[line.line],\n                  verticalBuffer: index === snippet.length - 1 ? verticalBuffer : 0\n                })\n              )}\n            </tbody>\n          </table>\n          {(!lastLine || snippet[snippet.length - 1].line < lastLine) && (\n            <div className=\"expand-block expand-block-below\">\n              <button\n                aria-label={translate('source_viewer.expand_below')}\n                onClick={this.expandBlock('down')}\n                type=\"button\">\n                <ExpandSnippetIcon />\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  }\n}\n","var api = require(\"!../../../../../../node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\");\n            var content = require(\"!!../../../../../../node_modules/css-loader/dist/cjs.js??ref--6-1!../../../../../../node_modules/postcss-loader/src/index.js??postcss!./SnippetViewer.css\");\n\n            content = content.__esModule ? content.default : content;\n\n            if (typeof content === 'string') {\n              content = [[module.id, content, '']];\n            }\n\nvar options = {};\n\noptions.insert = \"head\";\noptions.singleton = false;\n\nvar update = api(content, options);\n\nvar exported = content.locals ? content.locals : {};\n\n\n\nmodule.exports = exported;","// Imports\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../../../../node_modules/css-loader/dist/runtime/api.js\");\nexports = ___CSS_LOADER_API_IMPORT___(false);\n// Module\nexports.push([module.id, \".snippet{margin:8px;border:1px solid #cdcdcd;overflow-x:auto;overflow-y:hidden;transition:max-height .2s}.snippet>div{display:table;width:100%;position:relative;transition:margin-top .2s}.snippet table{width:100%}.expand-block{position:absolute;z-index:2;width:100%}.expand-block>button{background:transparent;box-sizing:border-box;color:#666;height:20px;width:100%;padding:2px;border:0;text-align:left;cursor:pointer}.expand-block>button:active,.expand-block>button:focus,.expand-block>button:hover{color:#236a97;outline:none}.expand-block-above{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAAXNSR0IArs4c6QAAADdJREFUCB1dzMEKADAIAlBd1v9/bcc2YgRjHh8qq2qTxCQzsX4wM6y30RARF3sy0Es1SIK7Y64OpCES1W69JS4AAAAASUVORK5CYII=\\\");top:0}.expand-block-below{background:url(\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4wQQBjQEQVd5jwAAADhJREFUCNddyTEKADEMA8GVA/7/Z+PGwUp1cGTaYe/tv5lxrLWoKj6SiMzkjZDEG7JtANt0N+ccLrB/KZxXTt7fAAAAAElFTkSuQmCC\\\");bottom:0}.source-table.expand-up{margin-top:20px}.source-table.expand-down{margin-bottom:20px}\", \"\"]);\n// Exports\nmodule.exports = exports;\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport { groupBy, sortBy } from 'lodash';\nimport * as React from 'react';\nimport { Link } from 'react-router';\nimport QualifierIcon from 'sonar-ui-common/components/icons/QualifierIcon';\nimport { Alert } from 'sonar-ui-common/components/ui/Alert';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { collapsedDirFromPath, fileFromPath } from 'sonar-ui-common/helpers/path';\nimport { isPullRequest } from '../../../helpers/branch-like';\nimport { getProjectUrl } from '../../../helpers/urls';\nimport { BranchLike } from '../../../types/branch-like';\nimport { WorkspaceContextShape } from '../../workspace/context';\n\ninterface Props {\n  blocks: T.DuplicationBlock[];\n  branchLike: BranchLike | undefined;\n  duplicatedFiles?: T.Dict<T.DuplicatedFile>;\n  inRemovedComponent: boolean;\n  openComponent: WorkspaceContextShape['openComponent'];\n  sourceViewerFile: T.SourceViewerFile;\n}\n\nexport default class DuplicationPopup extends React.PureComponent<Props> {\n  shouldLink() {\n    const { branchLike } = this.props;\n    return !isPullRequest(branchLike);\n  }\n\n  isDifferentComponent = (\n    a: { project: string; subProject?: string },\n    b: { project: string; subProject?: string }\n  ) => {\n    return Boolean(a && b && (a.project !== b.project || a.subProject !== b.subProject));\n  };\n\n  handleFileClick = (event: React.MouseEvent<HTMLAnchorElement>) => {\n    event.preventDefault();\n    event.currentTarget.blur();\n    const { key, line } = event.currentTarget.dataset;\n    if (this.shouldLink() && key) {\n      this.props.openComponent({\n        branchLike: this.props.branchLike,\n        key,\n        line: line ? Number(line) : undefined\n      });\n    }\n  };\n\n  renderDuplication(file: T.DuplicatedFile, children: React.ReactNode, line?: number) {\n    return this.shouldLink() ? (\n      <a\n        data-key={file.key}\n        data-line={line}\n        href=\"#\"\n        onClick={this.handleFileClick}\n        title={file.name}>\n        {children}\n      </a>\n    ) : (\n      children\n    );\n  }\n\n  render() {\n    const { duplicatedFiles = {}, sourceViewerFile } = this.props;\n\n    const groupedBlocks = groupBy(this.props.blocks, '_ref');\n    let duplications = Object.keys(groupedBlocks).map(fileRef => {\n      return {\n        blocks: groupedBlocks[fileRef],\n        file: duplicatedFiles[fileRef]\n      };\n    });\n\n    // first duplications in the same file\n    // then duplications in the same sub-project\n    // then duplications in the same project\n    // then duplications in other projects\n    duplications = sortBy(\n      duplications,\n      d => d.file.projectName !== sourceViewerFile.projectName,\n      d => d.file.subProjectName !== sourceViewerFile.subProjectName,\n      d => d.file.key !== sourceViewerFile.key\n    );\n\n    return (\n      <div className=\"source-viewer-bubble-popup abs-width-400\">\n        {this.props.inRemovedComponent && (\n          <Alert variant=\"warning\">\n            {translate('duplications.dups_found_on_deleted_resource')}\n          </Alert>\n        )}\n        {duplications.length > 0 && (\n          <>\n            <h6 className=\"spacer-bottom\">\n              {translate('component_viewer.transition.duplication')}\n            </h6>\n            {duplications.map(duplication => (\n              <div className=\"spacer-top text-ellipsis\" key={duplication.file.key}>\n                <div className=\"component-name\">\n                  {this.isDifferentComponent(duplication.file, this.props.sourceViewerFile) && (\n                    <>\n                      <div className=\"component-name-parent\">\n                        <QualifierIcon className=\"little-spacer-right\" qualifier=\"TRK\" />\n                        <Link to={getProjectUrl(duplication.file.project)}>\n                          {duplication.file.projectName}\n                        </Link>\n                      </div>\n                      {duplication.file.subProject && duplication.file.subProjectName && (\n                        <div className=\"component-name-parent\">\n                          <QualifierIcon className=\"little-spacer-right\" qualifier=\"BRC\" />\n                          {duplication.file.subProjectName}\n                        </div>\n                      )}\n                    </>\n                  )}\n\n                  {duplication.file.key !== this.props.sourceViewerFile.key && (\n                    <div className=\"component-name-path\">\n                      {this.renderDuplication(\n                        duplication.file,\n                        <>\n                          <span>{collapsedDirFromPath(duplication.file.name)}</span>\n                          <span className=\"component-name-file\">\n                            {fileFromPath(duplication.file.name)}\n                          </span>\n                        </>\n                      )}\n                    </div>\n                  )}\n\n                  <div className=\"component-name-path\">\n                    {'Lines: '}\n                    {duplication.blocks.map((block, index) => (\n                      <React.Fragment key={index}>\n                        {this.renderDuplication(\n                          duplication.file,\n                          <>\n                            {block.from}\n                            {'  '}\n                            {block.from + block.size - 1}\n                          </>,\n                          block.from\n                        )}\n                        {index < duplication.blocks.length - 1 && ', '}\n                      </React.Fragment>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            ))}\n          </>\n        )}\n      </div>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n// TODO Test this function, but I don't get the logic behind it\nexport function filterDuplicationBlocksByLine(blocks: T.DuplicationBlock[], line: number) {\n  /* eslint-disable no-underscore-dangle */\n  let foundOne = false;\n  return blocks.filter(b => {\n    const outOfBounds = b.from > line || b.from + b.size < line;\n    const currentFile = b._ref === '1';\n    const shouldDisplayForCurrentFile = outOfBounds || foundOne;\n    const shouldDisplay = !currentFile || shouldDisplayForCurrentFile;\n    const isOk = b._ref !== undefined && shouldDisplay;\n    if (b._ref === '1' && !outOfBounds) {\n      foundOne = true;\n    }\n    return isOk;\n  });\n  /* eslint-enable no-underscore-dangle */\n}\n\nexport function getDuplicationBlocksForIndex(\n  duplications: T.Duplication[] | undefined,\n  index: number\n) {\n  return (duplications && duplications[index] && duplications[index].blocks) || [];\n}\n\nexport function isDuplicationBlockInRemovedComponent(blocks: T.DuplicationBlock[]) {\n  return blocks.some(b => b._ref === undefined); // eslint-disable-line no-underscore-dangle\n}\n"],"sourceRoot":""}