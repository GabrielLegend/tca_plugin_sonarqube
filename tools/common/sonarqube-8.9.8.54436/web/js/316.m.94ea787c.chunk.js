(window.webpackJsonp=window.webpackJsonp||[]).push([[316],{1839:function(e,t,n){"use strict";n.r(t),n.d(t,"UsersApp",(function(){return Ce}));var s=n(2),a=n(335),r=n(351),o=n.n(r),l=n(31),i=n(458),c=n(341),u=n(424),m=n(367),d=n(312),h=n(319),p=n.n(h),g=n(457),f=n.n(g),E=n(332),b=n.n(E),v=n(322),C=n(340),O=n.n(C),w=n(346),k=n.n(w),y=n(9),j=n(324);class N extends s.PureComponent{constructor(){super(...arguments),this.handleChange=e=>this.props.onChange(this.props.idx,e.currentTarget.value),this.handleRemove=()=>this.props.onRemove(this.props.idx)}render(){return s.createElement("div",{className:"js-scm-account display-flex-row spacer-bottom"},s.createElement("input",{maxLength:255,onChange:this.handleChange,type:"text",value:this.props.scmAccount}),s.createElement(d.DeleteButton,{onClick:this.handleRemove}))}}class _ extends s.PureComponent{constructor(e){super(e),this.mounted=!1,this.handleError=e=>this.mounted&&[400,500].includes(e.status)?Object(y.parseError)(e).then(e=>this.setState({error:e}),j.a):Object(j.a)(e),this.handleEmailChange=e=>this.setState({email:e.currentTarget.value}),this.handleLoginChange=e=>this.setState({login:e.currentTarget.value}),this.handleNameChange=e=>this.setState({name:e.currentTarget.value}),this.handlePasswordChange=e=>this.setState({password:e.currentTarget.value}),this.handleCreateUser=()=>Object(i.b)({email:this.state.email||void 0,login:this.state.login,name:this.state.name,password:this.state.password,scmAccount:f()(this.state.scmAccounts)}).then(()=>{this.props.onUpdateUsers(),this.props.onClose()},this.handleError),this.handleUpdateUser=()=>{const{user:e}=this.props;return Object(i.i)({email:e.local?this.state.email:void 0,login:this.state.login,name:e.local?this.state.name:void 0,scmAccount:f()(this.state.scmAccounts)}).then(()=>{this.props.onUpdateUsers(),this.props.onClose()},this.handleError)},this.handleAddScmAccount=()=>{this.setState(({scmAccounts:e})=>({scmAccounts:e.concat("")}))},this.handleUpdateScmAccount=(e,t)=>this.setState(({scmAccounts:n})=>{const s=n.slice();return s[e]=t,{scmAccounts:s}}),this.handleRemoveScmAccount=e=>this.setState(({scmAccounts:t})=>({scmAccounts:t.slice(0,e).concat(t.slice(e+1))}));const{user:t}=e;this.state=t?{email:t.email||"",login:t.login,name:t.name||"",password:"",scmAccounts:t.scmAccounts||[]}:{email:"",login:"",name:"",password:"",scmAccounts:[]}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{user:e}=this.props,{error:t}=this.state,n=e?Object(l.translate)("users.update_user"):Object(l.translate)("users.create_user");return s.createElement(b.a,{header:n,onClose:this.props.onClose,onSubmit:e?this.handleUpdateUser:this.handleCreateUser,size:"small"},({onCloseClick:a,onFormSubmit:r,submitting:o})=>s.createElement("form",{autoComplete:"off",id:"user-form",onSubmit:r},s.createElement("header",{className:"modal-head"},s.createElement("h2",null,n)),s.createElement("div",{className:"modal-body modal-container"},t&&s.createElement(v.Alert,{variant:"error"},t),!t&&e&&!e.local&&s.createElement(v.Alert,{variant:"warning"},Object(l.translate)("users.cannot_update_delegated_user")),s.createElement(k.a,{className:"modal-field"}),!e&&s.createElement("div",{className:"modal-field"},s.createElement("label",{htmlFor:"create-user-login"},Object(l.translate)("login"),s.createElement(O.a,null)),s.createElement("input",{className:"hidden",name:"login-fake",type:"text"}),s.createElement("input",{autoFocus:!0,id:"create-user-login",maxLength:255,minLength:3,name:"login",onChange:this.handleLoginChange,required:!0,type:"text",value:this.state.login}),s.createElement("p",{className:"note"},Object(l.translateWithParameters)("users.minimum_x_characters",3))),s.createElement("div",{className:"modal-field"},s.createElement("label",{htmlFor:"create-user-name"},Object(l.translate)("name"),s.createElement(O.a,null)),s.createElement("input",{className:"hidden",name:"name-fake",type:"text"}),s.createElement("input",{autoFocus:!!e,disabled:e&&!e.local,id:"create-user-name",maxLength:200,name:"name",onChange:this.handleNameChange,required:!0,type:"text",value:this.state.name})),s.createElement("div",{className:"modal-field"},s.createElement("label",{htmlFor:"create-user-email"},Object(l.translate)("users.email")),s.createElement("input",{className:"hidden",name:"email-fake",type:"email"}),s.createElement("input",{disabled:e&&!e.local,id:"create-user-email",maxLength:100,name:"email",onChange:this.handleEmailChange,type:"email",value:this.state.email})),!e&&s.createElement("div",{className:"modal-field"},s.createElement("label",{htmlFor:"create-user-password"},Object(l.translate)("password"),s.createElement(O.a,null)),s.createElement("input",{className:"hidden",name:"password-fake",type:"password"}),s.createElement("input",{id:"create-user-password",name:"password",onChange:this.handlePasswordChange,required:!0,type:"password",value:this.state.password})),s.createElement("div",{className:"modal-field"},s.createElement("label",null,Object(l.translate)("my_profile.scm_accounts")),this.state.scmAccounts.map((e,t)=>s.createElement(N,{idx:t,key:t,onChange:this.handleUpdateScmAccount,onRemove:this.handleRemoveScmAccount,scmAccount:e})),s.createElement("div",{className:"spacer-bottom"},s.createElement(d.Button,{className:"js-scm-account-add",onClick:this.handleAddScmAccount},Object(l.translate)("add_verb"))),s.createElement("p",{className:"note"},Object(l.translate)("user.login_or_email_used_as_scm_account")))),s.createElement("footer",{className:"modal-foot"},o&&s.createElement("i",{className:"spinner spacer-right"}),s.createElement(d.SubmitButton,{disabled:o},e?Object(l.translate)("update_verb"):Object(l.translate)("create")),s.createElement(d.ResetButtonLink,{onClick:a},Object(l.translate)("cancel")))))}}class S extends s.PureComponent{constructor(){super(...arguments),this.state={openUserForm:!1},this.handleOpenUserForm=()=>{this.setState({openUserForm:!0})},this.handleCloseUserForm=()=>{this.setState({openUserForm:!1})}}render(){return s.createElement("header",{className:"page-header",id:"users-header"},s.createElement("h1",{className:"page-title"},Object(l.translate)("users.page")),s.createElement(p.a,{loading:this.props.loading}),s.createElement("div",{className:"page-actions"},s.createElement(d.Button,{id:"users-create",onClick:this.handleOpenUserForm},Object(l.translate)("users.create_user"))),s.createElement("p",{className:"page-description"},Object(l.translate)("users.page.description")),this.state.openUserForm&&s.createElement(_,{onClose:this.handleCloseUserForm,onUpdateUsers:this.props.onUpdateUsers}))}}var P=n(355),U=n.n(P);class F extends s.PureComponent{constructor(){super(...arguments),this.handleSearch=e=>{this.props.updateQuery({search:e})}}render(){const{query:e}=this.props;return s.createElement("div",{className:"panel panel-vertical bordered-bottom spacer-bottom",id:"users-search"},s.createElement(U.a,{minLength:2,onChange:this.handleSearch,placeholder:Object(l.translate)("search.search_by_login_or_name"),value:e.search}))}}var x=n(630),T=n.n(x),D=n(366),A=n.n(D),M=n(389),R=n(316),B=n(331),q=n.n(B),L=n(982);function W(e){return s.createElement(q.a,{contentLabel:Object(l.translate)("users.tokens"),onRequestClose:e.onClose},s.createElement("header",{className:"modal-head"},s.createElement("h2",null,s.createElement(R.FormattedMessage,{defaultMessage:Object(l.translate)("users.user_X_tokens"),id:"users.user_X_tokens",values:{user:s.createElement("em",null,e.user.name)}}))),s.createElement("div",{className:"modal-body modal-container"},s.createElement(L.a,{deleteConfirmation:"inline",login:e.user.login,updateTokensCount:e.updateTokensCount})),s.createElement("footer",{className:"modal-foot"},s.createElement(d.ResetButtonLink,{onClick:e.onClose},Object(l.translate)("Done"))))}var I=n(374),G=n.n(I),z=n(353);class J extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={submitting:!1},this.handleDeactivate=e=>{e.preventDefault(),this.setState({submitting:!0}),Object(i.c)({login:this.props.user.login}).then(()=>{this.props.onUpdateUsers(),this.props.onClose()},()=>{this.mounted&&this.setState({submitting:!1})})}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{user:e}=this.props,{submitting:t}=this.state,n=Object(l.translate)("users.deactivate_user");return s.createElement(q.a,{contentLabel:n,onRequestClose:this.props.onClose},s.createElement("form",{autoComplete:"off",id:"deactivate-user-form",onSubmit:this.handleDeactivate},s.createElement("header",{className:"modal-head"},s.createElement("h2",null,n)),s.createElement("div",{className:"modal-body"},Object(l.translateWithParameters)("users.deactivate_user.confirmation",e.name,e.login)),s.createElement("footer",{className:"modal-foot"},t&&s.createElement("i",{className:"spinner spacer-right"}),s.createElement(d.SubmitButton,{className:"js-confirm button-red",disabled:t},Object(l.translate)("users.deactivate")),s.createElement(d.ResetButtonLink,{className:"js-modal-close",onClick:this.props.onClose},Object(l.translate)("cancel")))))}}var H=n(437);class Q extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={confirmPassword:"",newPassword:"",oldPassword:"",submitting:!1},this.handleError=e=>this.mounted&&400===e.status?Object(y.parseError)(e).then(e=>this.setState({error:e,submitting:!1}),j.a):Object(j.a)(e),this.handleConfirmPasswordChange=e=>this.setState({confirmPassword:e.currentTarget.value}),this.handleNewPasswordChange=e=>this.setState({newPassword:e.currentTarget.value}),this.handleOldPasswordChange=e=>this.setState({oldPassword:e.currentTarget.value}),this.handleChangePassword=e=>{e.preventDefault(),this.state.newPassword.length>0&&this.state.newPassword===this.state.confirmPassword&&(this.setState({submitting:!0}),Object(i.a)({login:this.props.user.login,password:this.state.newPassword,previousPassword:this.state.oldPassword}).then(()=>{Object(H.a)(Object(l.translate)("my_profile.password.changed")),this.props.onClose()},this.handleError))}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{error:e,submitting:t,newPassword:n,confirmPassword:a}=this.state,r=Object(l.translate)("my_profile.password.title");return s.createElement(q.a,{contentLabel:r,onRequestClose:this.props.onClose,size:"small"},s.createElement("form",{autoComplete:"off",id:"user-password-form",onSubmit:this.handleChangePassword},s.createElement("header",{className:"modal-head"},s.createElement("h2",null,r)),s.createElement("div",{className:"modal-body"},e&&s.createElement(v.Alert,{variant:"error"},e),s.createElement(k.a,{className:"modal-field"}),this.props.isCurrentUser&&s.createElement("div",{className:"modal-field"},s.createElement("label",{htmlFor:"old-user-password"},Object(l.translate)("my_profile.password.old"),s.createElement(O.a,null)),s.createElement("input",{className:"hidden",name:"old-password-fake",type:"password"}),s.createElement("input",{id:"old-user-password",name:"old-password",onChange:this.handleOldPasswordChange,required:!0,type:"password",value:this.state.oldPassword})),s.createElement("div",{className:"modal-field"},s.createElement("label",{htmlFor:"user-password"},Object(l.translate)("my_profile.password.new"),s.createElement(O.a,null)),s.createElement("input",{className:"hidden",name:"password-fake",type:"password"}),s.createElement("input",{id:"user-password",name:"password",onChange:this.handleNewPasswordChange,required:!0,type:"password",value:this.state.newPassword})),s.createElement("div",{className:"modal-field"},s.createElement("label",{htmlFor:"confirm-user-password"},Object(l.translate)("my_profile.password.confirm"),s.createElement(O.a,null)),s.createElement("input",{className:"hidden",name:"confirm-password-fake",type:"password"}),s.createElement("input",{id:"confirm-user-password",name:"confirm-password",onChange:this.handleConfirmPasswordChange,required:!0,type:"password",value:this.state.confirmPassword}))),s.createElement("footer",{className:"modal-foot"},t&&s.createElement("i",{className:"spinner spacer-right"}),s.createElement(d.SubmitButton,{disabled:t||!n||n!==a},Object(l.translate)("change_verb")),s.createElement(d.ResetButtonLink,{onClick:this.props.onClose},Object(l.translate)("cancel")))))}}class X extends s.PureComponent{constructor(){super(...arguments),this.state={},this.handleOpenDeactivateForm=()=>{this.setState({openForm:"deactivate"})},this.handleOpenPasswordForm=()=>{this.setState({openForm:"password"})},this.handleOpenUpdateForm=()=>{this.setState({openForm:"update"})},this.handleCloseForm=()=>{this.setState({openForm:void 0})},this.renderActions=()=>{const{user:e}=this.props;return s.createElement(G.a,null,s.createElement(I.ActionsDropdownItem,{className:"js-user-update",onClick:this.handleOpenUpdateForm},Object(l.translate)("update_details")),e.local&&s.createElement(I.ActionsDropdownItem,{className:"js-user-change-password",onClick:this.handleOpenPasswordForm},Object(l.translate)("my_profile.password.title")),s.createElement(I.ActionsDropdownDivider,null),Object(z.c)(e)&&s.createElement(I.ActionsDropdownItem,{className:"js-user-deactivate",destructive:!0,onClick:this.handleOpenDeactivateForm},Object(l.translate)("users.deactivate")))}}render(){const{openForm:e}=this.state,{isCurrentUser:t,onUpdateUsers:n,user:a}=this.props;return s.createElement(s.Fragment,null,this.renderActions(),"deactivate"===e&&Object(z.c)(a)&&s.createElement(J,{onClose:this.handleCloseForm,onUpdateUsers:n,user:a}),"password"===e&&s.createElement(Q,{isCurrentUser:t,onClose:this.handleCloseForm,user:a}),"update"===e&&s.createElement(_,{onClose:this.handleCloseForm,onUpdateUsers:n,user:a}))}}var V=n(349),K=n.n(V),Y=n(490),Z=n.n(Y),$=n(470),ee=n.n($),te=n(806);class ne extends s.PureComponent{constructor(e){super(e),this.mounted=!1,this.fetchUsers=e=>Object(i.e)({login:this.props.user.login,p:e.page,ps:e.pageSize,q:""!==e.query?e.query:void 0,selected:e.filter}).then(t=>{this.mounted&&this.setState(n=>{const s=null!=e.page&&e.page>1,a=s?[...n.groups,...t.groups]:t.groups,r=t.groups.filter(e=>e.selected).map(e=>e.name),o=s?[...n.selectedGroups,...r]:r;return{lastSearchParams:e,needToReload:!1,groups:a,groupsTotalCount:t.paging.total,selectedGroups:o}})}),this.handleSelect=e=>Object(te.a)({name:e,login:this.props.user.login}).then(()=>{this.mounted&&this.setState(t=>({needToReload:!0,selectedGroups:[...t.selectedGroups,e]}))}),this.handleUnselect=e=>Object(te.e)({name:e,login:this.props.user.login}).then(()=>{this.mounted&&this.setState(t=>({needToReload:!0,selectedGroups:K()(t.selectedGroups,e)}))}),this.handleCloseClick=e=>{e.preventDefault(),this.handleClose()},this.handleClose=()=>{this.props.onUpdateUsers(),this.props.onClose()},this.renderElement=e=>{const t=Z()(this.state.groups,{name:e});return s.createElement("div",{className:"select-list-list-item"},void 0===t?e:s.createElement(s.Fragment,null,t.name,s.createElement("br",null),s.createElement("span",{className:"note"},t.description)))},this.state={needToReload:!1,groups:[],selectedGroups:[]}}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const e=Object(l.translate)("users.update_groups");return s.createElement(q.a,{contentLabel:e,onRequestClose:this.handleClose},s.createElement("div",{className:"modal-head"},s.createElement("h2",null,e)),s.createElement("div",{className:"modal-body modal-container"},s.createElement(ee.a,{elements:this.state.groups.map(e=>e.name),elementsTotalCount:this.state.groupsTotalCount,needToReload:this.state.needToReload&&this.state.lastSearchParams&&this.state.lastSearchParams.filter!==$.SelectListFilter.All,onSearch:this.fetchUsers,onSelect:this.handleSelect,onUnselect:this.handleUnselect,renderElement:this.renderElement,selectedElements:this.state.selectedGroups,withPaging:!0})),s.createElement("footer",{className:"modal-foot"},s.createElement("a",{className:"js-modal-close",href:"#",onClick:this.handleCloseClick},Object(l.translate)("Done"))))}}class se extends s.PureComponent{constructor(){super(...arguments),this.state={openForm:!1,showMore:!1},this.handleOpenForm=()=>this.setState({openForm:!0}),this.handleCloseForm=()=>this.setState({openForm:!1}),this.toggleShowMore=e=>{e.preventDefault(),this.setState(e=>({showMore:!e.showMore}))}}render(){const{groups:e}=this.props,t=e.length>3?2:3;return s.createElement("ul",null,e.slice(0,t).map(e=>s.createElement("li",{className:"little-spacer-bottom",key:e},e)),e.length>3&&this.state.showMore&&e.slice(t).map(e=>s.createElement("li",{className:"little-spacer-bottom",key:e},e)),s.createElement("li",{className:"little-spacer-bottom"},e.length>3&&!this.state.showMore&&s.createElement("a",{className:"js-user-more-groups spacer-right",href:"#",onClick:this.toggleShowMore},Object(l.translateWithParameters)("more_x",e.length-t)),s.createElement(d.ButtonIcon,{className:"js-user-groups button-small",onClick:this.handleOpenForm,tooltip:Object(l.translate)("users.update_groups")},s.createElement(T.a,null))),this.state.openForm&&s.createElement(ne,{onClose:this.handleCloseForm,onUpdateUsers:this.props.onUpdateUsers,user:this.props.user}))}}var ae=n(775),re=n(339),oe=n(350);function le({identityProvider:e,user:t}){return s.createElement("td",{className:"text-middle"},s.createElement("div",null,s.createElement("strong",{className:"js-user-name"},t.name),s.createElement("span",{className:"js-user-login note little-spacer-left"},t.login)),t.email&&s.createElement("div",{className:"js-user-email little-spacer-top"},t.email),!t.local&&"sonarqube"!==t.externalProvider&&s.createElement(ie,{identityProvider:e,user:t}))}function ie({identityProvider:e,user:t}){return e?s.createElement("div",{className:"js-user-identity-provider little-spacer-top"},s.createElement("div",{className:"identity-provider",style:{backgroundColor:e.backgroundColor,color:Object(ae.getTextColor)(e.backgroundColor,oe.colors.secondFontColor)}},s.createElement("img",{alt:e.name,className:"little-spacer-right",height:"14",src:Object(re.getBaseUrl)()+e.iconPath,width:"14"}),t.externalIdentity)):s.createElement("div",{className:"js-user-identity-provider little-spacer-top"},s.createElement("span",null,t.externalProvider,": ",t.externalIdentity))}class ce extends s.PureComponent{constructor(){super(...arguments),this.state={showMore:!1},this.toggleShowMore=e=>{e.preventDefault(),this.setState(e=>({showMore:!e.showMore}))}}render(){const{scmAccounts:e}=this.props,t=e.length>3?2:3;return s.createElement("ul",{className:"js-scm-accounts"},e.slice(0,t).map((e,t)=>s.createElement("li",{className:"little-spacer-bottom",key:t},e)),e.length>3&&(this.state.showMore?e.slice(t).map((e,n)=>s.createElement("li",{className:"little-spacer-bottom",key:n+t},e)):s.createElement("li",{className:"little-spacer-bottom"},s.createElement("a",{className:"js-user-more-scm",href:"#",onClick:this.toggleShowMore},Object(l.translateWithParameters)("more_x",e.length-t)))))}}class ue extends s.PureComponent{constructor(){super(...arguments),this.state={openTokenForm:!1},this.handleOpenTokensForm=()=>this.setState({openTokenForm:!0}),this.handleCloseTokensForm=()=>this.setState({openTokenForm:!1})}render(){const{identityProvider:e,onUpdateUsers:t,user:n}=this.props;return s.createElement("tr",null,s.createElement("td",{className:"thin nowrap text-middle"},s.createElement(M.a,{hash:n.avatar,name:n.name,size:36})),s.createElement(le,{identityProvider:e,user:n}),s.createElement("td",{className:"thin nowrap text-middle"},s.createElement(ce,{scmAccounts:n.scmAccounts||[]})),s.createElement("td",{className:"thin nowrap text-middle"},s.createElement(A.a,{date:n.lastConnectionDate,hourPrecision:!0})),s.createElement("td",{className:"thin nowrap text-middle"},s.createElement(se,{groups:n.groups||[],onUpdateUsers:t,user:n})),s.createElement("td",{className:"thin nowrap text-middle"},n.tokensCount,s.createElement(d.ButtonIcon,{className:"js-user-tokens spacer-left button-small",onClick:this.handleOpenTokensForm,tooltip:Object(l.translate)("users.update_tokens")},s.createElement(T.a,null))),s.createElement("td",{className:"thin nowrap text-right text-middle"},s.createElement(X,{isCurrentUser:this.props.isCurrentUser,onUpdateUsers:t,user:n})),this.state.openTokenForm&&s.createElement(W,{onClose:this.handleCloseTokensForm,updateTokensCount:this.props.updateTokensCount,user:n}))}}function me({currentUser:e,identityProviders:t,onUpdateUsers:n,updateTokensCount:a,users:r}){return s.createElement("div",{className:"boxed-group boxed-group-inner"},s.createElement("table",{className:"data zebra",id:"users-list"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null),s.createElement("th",{className:"nowrap"}),s.createElement("th",{className:"nowrap"},Object(l.translate)("my_profile.scm_accounts")),s.createElement("th",{className:"nowrap"},Object(l.translate)("users.last_connection")),s.createElement("th",{className:"nowrap"},Object(l.translate)("my_profile.groups")),s.createElement("th",{className:"nowrap"},Object(l.translate)("users.tokens")),s.createElement("th",{className:"nowrap"}," "))),s.createElement("tbody",null,r.map(r=>s.createElement(ue,{identityProvider:t.find(e=>r.externalProvider===e.key),isCurrentUser:e.isLoggedIn&&e.login===r.login,key:r.login,onUpdateUsers:n,updateTokensCount:a,user:r})))))}var de=n(588),he=n.n(de),pe=n(479);const ge=he()(e=>({search:Object(pe.parseAsString)(e.search)})),fe=he()(e=>Object(pe.cleanQuery)({search:e.search?Object(pe.serializeString)(e.search):void 0}));function Ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,s)}return n}function be(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ee(Object(n),!0).forEach((function(t){ve(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class Ce extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={identityProviders:[],loading:!0,users:[]},this.finishLoading=()=>{this.mounted&&this.setState({loading:!1})},this.fetchIdentityProviders=()=>Object(i.d)().then(({identityProviders:e})=>{this.mounted&&this.setState({identityProviders:e})}),this.fetchUsers=({location:e}=this.props)=>{this.setState({loading:!0}),Object(i.f)({q:ge(e.query).search}).then(({paging:e,users:t})=>{this.mounted&&this.setState({loading:!1,paging:e,users:t})},this.finishLoading)},this.fetchMoreUsers=()=>{const{paging:e}=this.state;e&&(this.setState({loading:!0}),Object(i.f)({p:e.pageIndex+1,q:ge(this.props.location.query).search}).then(({paging:e,users:t})=>{this.mounted&&this.setState(n=>({loading:!1,users:[...n.users,...t],paging:e}))},this.finishLoading))},this.updateQuery=e=>{const t=fe(be({},ge(this.props.location.query),{},e));this.props.router.push(be({},this.props.location,{query:t}))},this.updateTokensCount=(e,t)=>{this.setState(n=>({users:n.users.map(n=>n.login===e?be({},n,{tokensCount:t}):n)}))}}componentDidMount(){this.mounted=!0,this.fetchIdentityProviders(),this.fetchUsers()}componentWillReceiveProps(e){e.location.query.search!==this.props.location.query.search&&this.fetchUsers(e)}componentWillUnmount(){this.mounted=!1}render(){const e=ge(this.props.location.query),{loading:t,paging:n,users:r}=this.state;return s.createElement("div",{className:"page page-limited",id:"users-page"},s.createElement(c.a,{suggestions:"users"}),s.createElement(a.a,{defer:!1,title:Object(l.translate)("users.page")}),s.createElement(S,{loading:t,onUpdateUsers:this.fetchUsers}),s.createElement(F,{query:e,updateQuery:this.updateQuery}),s.createElement(me,{currentUser:this.props.currentUser,identityProviders:this.state.identityProviders,onUpdateUsers:this.fetchUsers,updateTokensCount:this.updateTokensCount,users:r}),void 0!==n&&s.createElement(o.a,{count:r.length,loadMore:this.fetchMoreUsers,ready:!t,total:n.total}))}}t.default=Object(m.a)(Object(u.a)(Ce))},341:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var s=n(2),a=n(379);function r({suggestions:e}){return s.createElement(a.a.Consumer,null,({addSuggestions:t,removeSuggestions:n})=>s.createElement(o,{addSuggestions:t,removeSuggestions:n,suggestions:e}))}class o extends s.PureComponent{componentDidMount(){this.props.addSuggestions(this.props.suggestions)}componentDidUpdate(e){e.suggestions!==this.props.suggestions&&(this.props.removeSuggestions(this.props.suggestions),this.props.addSuggestions(e.suggestions))}componentWillUnmount(){this.props.removeSuggestions(this.props.suggestions)}render(){return null}}},358:function(e,t,n){"use strict";var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),l=n(31),i=n(319),c=n(312),u=n(442),m=n(332),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.handleSubmit=function(){var e=t.props.onConfirm(t.props.confirmData);return e?e.then(t.props.onClose,(function(){})):void t.props.onClose()},t.renderModalContent=function(e){var n=e.onCloseClick,s=e.onFormSubmit,a=e.submitting,r=t.props,m=r.children,d=r.confirmButtonText,h=r.confirmDisable,p=r.header,g=r.headerDescription,f=r.isDestructive,E=r.cancelButtonText,b=void 0===E?l.translate("cancel"):E;return o.createElement(u.default,null,o.createElement("form",{onSubmit:s},o.createElement("header",{className:"modal-head"},o.createElement("h2",null,p),g),o.createElement("div",{className:"modal-body"},m),o.createElement("footer",{className:"modal-foot"},o.createElement(i.default,{className:"spacer-right",loading:a}),o.createElement(c.SubmitButton,{autoFocus:!0,className:f?"button-red":void 0,disabled:a||h},d),o.createElement(c.ResetButtonLink,{disabled:a,onClick:n},b))))},t}return a(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this.props,t={header:e.header,onClose:e.onClose,noBackdrop:e.noBackdrop,size:e.size};return o.createElement(m.default,r({onSubmit:this.handleSubmit},t),this.renderModalContent)},t}(o.PureComponent);t.default=d},363:function(e,t,n){"use strict";var s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var a=n(2),r=n(316),o=n(26);t.formatterOption={year:"numeric",month:"short",day:"2-digit"},t.longFormatterOption={year:"numeric",month:"long",day:"numeric"},t.default=function(e){var n=e.children,l=e.date,i=e.long;return a.createElement(r.FormattedDate,s({value:o.parseDate(l)},i?t.longFormatterOption:t.formatterOption),n)}},366:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n(451),a=n(2),r=n(316),o=n(26),l=n(31),i=n(365);t.default=function(e){var t=e.children,n=void 0===t?function(e){return e}:t,c=e.date,u=e.hourPrecision,m=n;if(!c)return a.createElement(a.Fragment,null,n(l.translate("never")));c&&u&&s.differenceInHours(Date.now(),c)<1&&(m=function(){return n(l.translate("less_than_1_hour_ago"))});var d=o.parseDate(c);return a.createElement(i.default,{date:d},(function(e){return a.createElement("span",{title:e},a.createElement(r.FormattedRelative,{value:d},m))}))}},394:function(e,t,n){"use strict";var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),r=this&&this.__assign||function(){return(r=Object.assign||function(e){for(var t,n=1,s=arguments.length;n<s;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(s=Object.getOwnPropertySymbols(e);a<s.length;a++)t.indexOf(s[a])<0&&Object.prototype.propertyIsEnumerable.call(e,s[a])&&(n[s[a]]=e[s[a]])}return n};Object.defineProperty(t,"__esModule",{value:!0});var l=n(2),i=n(358),c=n(395),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderConfirmModal=function(e){var n=e.onClose,s=t.props,a=(s.children,s.modalBody),c=s.modalHeader,u=s.modalHeaderDescription,m=o(s,["children","modalBody","modalHeader","modalHeaderDescription"]);return l.createElement(i.default,r({header:c,headerDescription:u,onClose:n},m),a)},t}return a(t,e),t.prototype.render=function(){return l.createElement(c.default,{modal:this.renderConfirmModal},this.props.children)},t}(l.PureComponent);t.default=u},395:function(e,t,n){"use strict";var s,a=this&&this.__extends||(s=function(e,t){return(s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var r=n(2),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={modal:!1},t.handleButtonClick=function(){t.setState({modal:!0})},t.handleFormSubmit=function(e){e&&e.preventDefault(),t.setState({modal:!0})},t.handleCloseModal=function(){t.mounted&&t.setState({modal:!1})},t}return a(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){return r.createElement(r.Fragment,null,this.props.children({onClick:this.handleButtonClick,onFormSubmit:this.handleFormSubmit}),this.state.modal&&this.props.modal({onClose:this.handleCloseModal}))},t}(r.PureComponent);t.default=o},437:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var s=n(416),a=n(414);function r(e){Object(a.default)().dispatch(s.b(e))}},605:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return l}));var s=n(9),a=n(324);function r(e){return Object(s.getJSON)("/api/user_tokens/search",{login:e}).then(e=>e.userTokens,a.a)}function o(e){return Object(s.postJSON)("/api/user_tokens/generate",e).catch(a.a)}function l(e){return Object(s.post)("/api/user_tokens/revoke",e).catch(a.a)}},806:function(e,t,n){"use strict";n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return o})),n.d(t,"a",(function(){return l})),n.d(t,"e",(function(){return i})),n.d(t,"b",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"c",(function(){return m}));var s=n(9),a=n(324);function r(e){return Object(s.getJSON)("/api/user_groups/search",e).catch(a.a)}function o(e){return Object(s.getJSON)("/api/user_groups/users",e).catch(a.a)}function l(e){return Object(s.post)("/api/user_groups/add_user",e).catch(a.a)}function i(e){return Object(s.post)("/api/user_groups/remove_user",e).catch(a.a)}function c(e){return Object(s.postJSON)("/api/user_groups/create",e).then(e=>e.group,a.a)}function u(e){return Object(s.post)("/api/user_groups/update",e).catch(a.a)}function m(e){return Object(s.post)("/api/user_groups/delete",e).catch(a.a)}},982:function(e,t,n){"use strict";n.d(t,"a",(function(){return k}));var s=n(2),a=n(312),r=n(319),o=n.n(r),l=n(31),i=n(605),c=n(316),u=n(394),m=n.n(u),d=n(317),h=n.n(d),p=n(363),g=n.n(p),f=n(366),E=n.n(f),b=n(406);class v extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={loading:!1,showConfirmation:!1},this.handleClick=()=>{this.state.showConfirmation?this.handleRevoke().then(()=>{this.mounted&&this.setState({showConfirmation:!1})}):this.setState({showConfirmation:!0})},this.handleRevoke=()=>(this.setState({loading:!0}),Object(i.c)({login:this.props.login,name:this.props.token.name}).then(()=>this.props.onRevokeToken(this.props.token),()=>{this.mounted&&this.setState({loading:!1})}))}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}render(){const{deleteConfirmation:e,token:t}=this.props,{loading:n,showConfirmation:r}=this.state;return s.createElement("tr",null,s.createElement("td",null,s.createElement(h.a,{overlay:t.name},s.createElement("span",null,Object(b.limitComponentName)(t.name,20)))),s.createElement("td",{className:"nowrap"},s.createElement(E.a,{date:t.lastConnectionDate,hourPrecision:!0})),s.createElement("td",{className:"thin nowrap text-right"},s.createElement(g.a,{date:t.createdAt,long:!0})),s.createElement("td",{className:"thin nowrap text-right"},s.createElement(o.a,{loading:n},s.createElement("i",{className:"deferred-spinner-placeholder"})),"modal"===e?s.createElement(m.a,{confirmButtonText:Object(l.translate)("users.tokens.revoke_token"),isDestructive:!0,modalBody:s.createElement(c.FormattedMessage,{defaultMessage:Object(l.translate)("users.tokens.sure_X"),id:"users.tokens.sure_X",values:{token:s.createElement("strong",null,t.name)}}),modalHeader:Object(l.translate)("users.tokens.revoke_token"),onConfirm:this.handleRevoke},({onClick:e})=>s.createElement(a.Button,{className:"spacer-left button-red input-small",disabled:n,onClick:e,title:Object(l.translate)("users.tokens.revoke_token")},Object(l.translate)("users.tokens.revoke"))):s.createElement(a.Button,{className:"button-red input-small spacer-left",disabled:n,onClick:this.handleClick},r?Object(l.translate)("users.tokens.sure"):Object(l.translate)("users.tokens.revoke"))))}}var C=n(354),O=n(322);function w({token:e}){return s.createElement("div",{className:"panel panel-white big-spacer-top"},s.createElement(O.Alert,{variant:"warning"},Object(l.translateWithParameters)("users.tokens.new_token_created",e.name)),s.createElement(C.ClipboardButton,{copyValue:e.token}),s.createElement("code",{className:"big-spacer-left text-success"},e.token))}class k extends s.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={generating:!1,loading:!0,newTokenName:"",tokens:[]},this.fetchTokens=()=>{this.setState({loading:!0}),Object(i.b)(this.props.login).then(e=>{this.mounted&&this.setState({loading:!1,tokens:e})},()=>{this.mounted&&this.setState({loading:!1})})},this.updateTokensCount=()=>{this.props.updateTokensCount&&this.props.updateTokensCount(this.props.login,this.state.tokens.length)},this.handleGenerateToken=e=>{e.preventDefault(),this.state.newTokenName.length>0&&(this.setState({generating:!0}),Object(i.a)({name:this.state.newTokenName,login:this.props.login}).then(e=>{this.mounted&&this.setState(t=>{const n=[...t.tokens,{name:e.name,createdAt:e.createdAt}];return{generating:!1,newToken:e,newTokenName:"",tokens:n}},this.updateTokensCount)},()=>{this.mounted&&this.setState({generating:!1})}))},this.handleRevokeToken=e=>{this.setState(t=>({tokens:t.tokens.filter(t=>t.name!==e.name)}),this.updateTokensCount)},this.handleNewTokenChange=e=>this.setState({newTokenName:e.currentTarget.value})}componentDidMount(){this.mounted=!0,this.fetchTokens()}componentWillUnmount(){this.mounted=!1}renderItems(){const{tokens:e}=this.state;return e.length<=0?s.createElement("tr",null,s.createElement("td",{className:"note",colSpan:3},Object(l.translate)("users.no_tokens"))):e.map(e=>s.createElement(v,{deleteConfirmation:this.props.deleteConfirmation,key:e.name,login:this.props.login,onRevokeToken:this.handleRevokeToken,token:e}))}render(){const{generating:e,loading:t,newToken:n,newTokenName:r,tokens:i}=this.state,c=s.createElement("tr",null,s.createElement("td",null,s.createElement("i",{className:"spinner"})));return s.createElement(s.Fragment,null,s.createElement("h3",{className:"spacer-bottom"},Object(l.translate)("users.generate_tokens")),s.createElement("form",{autoComplete:"off",className:"display-flex-center",id:"generate-token-form",onSubmit:this.handleGenerateToken},s.createElement("input",{className:"input-large spacer-right",maxLength:100,onChange:this.handleNewTokenChange,placeholder:Object(l.translate)("users.enter_token_name"),required:!0,type:"text",value:r}),s.createElement(a.SubmitButton,{className:"js-generate-token",disabled:e||r.length<=0},Object(l.translate)("users.generate"))),n&&s.createElement(w,{token:n}),s.createElement("table",{className:"data zebra big-spacer-top"},s.createElement("thead",null,s.createElement("tr",null,s.createElement("th",null,Object(l.translate)("name")),s.createElement("th",null,Object(l.translate)("my_account.tokens_last_usage")),s.createElement("th",{className:"text-right"},Object(l.translate)("created")),s.createElement("th",null))),s.createElement("tbody",null,s.createElement(o.a,{customSpinner:c,loading:t&&i.length<=0},this.renderItems()))))}}}}]);
//# sourceMappingURL=316.m.94ea787c.chunk.js.map