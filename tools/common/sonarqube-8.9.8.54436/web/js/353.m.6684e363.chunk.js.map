{"version":3,"sources":["webpack:///./src/main/js/apps/coding-rules/components/ActivationFormModal.tsx","webpack:///./src/main/js/components/shared/SeverityHelper.tsx","webpack:///./src/main/js/helpers/sanitize.ts"],"names":["ActivationFormModal","props","super","mounted","getParams","activation","rule","this","params","param","key","defaultValue","value","getQualityProfilesWithDepth","profiles","filter","profile","isBuiltIn","actions","edit","language","lang","map","depth","handleFormSubmit","event","preventDefault","setState","submitting","data","state","severity","then","onDone","onClose","handleParameterChange","name","currentTarget","handleProfileChange","handleSeverityChange","renderSeverityOption","profilesWithDepth","length","isCustomRule","templateKey","activeInAllProfiles","isUpdateMode","contentLabel","modalHeader","onRequestClose","size","onSubmit","className","variant","clearable","disabled","onChange","options","label","repeat","optionRenderer","searchable","valueRenderer","title","type","placeholder","rows","undefined","htmlDesc","dangerouslySetInnerHTML","__html","onClick","SeverityHelper","sanitizeStringRestricted","html","ALLOWED_TAGS","ALLOWED_ATTR","sanitizeString","USE_PROFILES"],"mappings":"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","file":"js/353.m.6684e363.chunk.js","sourcesContent":["/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as classNames from 'classnames';\nimport * as React from 'react';\nimport { ResetButtonLink, SubmitButton } from 'sonar-ui-common/components/controls/buttons';\nimport Modal from 'sonar-ui-common/components/controls/Modal';\nimport Select from 'sonar-ui-common/components/controls/Select';\nimport { Alert } from 'sonar-ui-common/components/ui/Alert';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\nimport { activateRule, Profile } from '../../../api/quality-profiles';\nimport SeverityHelper from '../../../components/shared/SeverityHelper';\nimport { SEVERITIES } from '../../../helpers/constants';\nimport { sanitizeString } from '../../../helpers/sanitize';\nimport { sortProfiles } from '../../quality-profiles/utils';\n\ninterface Props {\n  activation?: T.RuleActivation;\n  modalHeader: string;\n  onClose: () => void;\n  onDone: (severity: string) => Promise<void>;\n  profiles: Profile[];\n  rule: T.Rule | T.RuleDetails;\n}\n\ninterface State {\n  params: T.Dict<string>;\n  profile: string;\n  severity: string;\n  submitting: boolean;\n}\n\nexport default class ActivationFormModal extends React.PureComponent<Props, State> {\n  mounted = false;\n\n  constructor(props: Props) {\n    super(props);\n    const profilesWithDepth = this.getQualityProfilesWithDepth(props);\n    this.state = {\n      params: this.getParams(props),\n      profile: profilesWithDepth.length > 0 ? profilesWithDepth[0].key : '',\n      severity: props.activation ? props.activation.severity : props.rule.severity,\n      submitting: false\n    };\n  }\n\n  componentDidMount() {\n    this.mounted = true;\n  }\n\n  componentWillUnmount() {\n    this.mounted = false;\n  }\n\n  getParams = ({ activation, rule } = this.props) => {\n    const params: T.Dict<string> = {};\n    if (rule && rule.params) {\n      for (const param of rule.params) {\n        params[param.key] = param.defaultValue || '';\n      }\n      if (activation && activation.params) {\n        for (const param of activation.params) {\n          params[param.key] = param.value;\n        }\n      }\n    }\n    return params;\n  };\n\n  // Choose QP which a user can administrate, which are the same language and which are not built-in\n  getQualityProfilesWithDepth = ({ profiles } = this.props) => {\n    return sortProfiles(\n      profiles.filter(\n        profile =>\n          !profile.isBuiltIn &&\n          profile.actions &&\n          profile.actions.edit &&\n          profile.language === this.props.rule.lang\n      )\n    ).map(profile => ({\n      ...profile,\n      // Decrease depth by 1, so the top level starts at 0\n      depth: profile.depth - 1\n    }));\n  };\n\n  handleFormSubmit = (event: React.SyntheticEvent<HTMLFormElement>) => {\n    event.preventDefault();\n    this.setState({ submitting: true });\n    const data = {\n      key: this.state.profile,\n      params: this.state.params,\n      rule: this.props.rule.key,\n      severity: this.state.severity\n    };\n    activateRule(data)\n      .then(() => this.props.onDone(data.severity))\n      .then(\n        () => {\n          if (this.mounted) {\n            this.setState({ submitting: false });\n            this.props.onClose();\n          }\n        },\n        () => {\n          if (this.mounted) {\n            this.setState({ submitting: false });\n          }\n        }\n      );\n  };\n\n  handleParameterChange = (event: React.SyntheticEvent<HTMLInputElement | HTMLTextAreaElement>) => {\n    const { name, value } = event.currentTarget;\n    this.setState((state: State) => ({ params: { ...state.params, [name]: value } }));\n  };\n\n  handleProfileChange = ({ value }: { value: string }) => {\n    this.setState({ profile: value });\n  };\n\n  handleSeverityChange = ({ value }: { value: string }) => {\n    this.setState({ severity: value });\n  };\n\n  renderSeverityOption = ({ value }: { value: string }) => {\n    return <SeverityHelper severity={value} />;\n  };\n\n  render() {\n    const { activation, rule } = this.props;\n    const { profile, severity, submitting } = this.state;\n    const { params = [] } = rule;\n    const profilesWithDepth = this.getQualityProfilesWithDepth();\n    const isCustomRule = !!(rule as T.RuleDetails).templateKey;\n    const activeInAllProfiles = profilesWithDepth.length <= 0;\n    const isUpdateMode = !!activation;\n\n    return (\n      <Modal contentLabel={this.props.modalHeader} onRequestClose={this.props.onClose} size=\"small\">\n        <form onSubmit={this.handleFormSubmit}>\n          <div className=\"modal-head\">\n            <h2>{this.props.modalHeader}</h2>\n          </div>\n\n          <div className={classNames('modal-body', { 'modal-container': params.length > 0 })}>\n            {!isUpdateMode && activeInAllProfiles && (\n              <Alert variant=\"info\">{translate('coding_rules.active_in_all_profiles')}</Alert>\n            )}\n\n            <div className=\"modal-field\">\n              <label>{translate('coding_rules.quality_profile')}</label>\n              <Select\n                className=\"js-profile\"\n                clearable={false}\n                disabled={submitting || profilesWithDepth.length === 1}\n                onChange={this.handleProfileChange}\n                options={profilesWithDepth.map(profile => ({\n                  label: '   '.repeat(profile.depth) + profile.name,\n                  value: profile.key\n                }))}\n                value={profile}\n              />\n            </div>\n            <div className=\"modal-field\">\n              <label>{translate('severity')}</label>\n              <Select\n                className=\"js-severity\"\n                clearable={false}\n                disabled={submitting}\n                onChange={this.handleSeverityChange}\n                optionRenderer={this.renderSeverityOption}\n                options={SEVERITIES.map(severity => ({\n                  label: translate('severity', severity),\n                  value: severity\n                }))}\n                searchable={false}\n                value={severity}\n                valueRenderer={this.renderSeverityOption}\n              />\n            </div>\n            {isCustomRule ? (\n              <div className=\"modal-field\">\n                <p className=\"note\">{translate('coding_rules.custom_rule.activation_notice')}</p>\n              </div>\n            ) : (\n              params.map(param => (\n                <div className=\"modal-field\" key={param.key}>\n                  <label title={param.key}>{param.key}</label>\n                  {param.type === 'TEXT' ? (\n                    <textarea\n                      disabled={submitting}\n                      name={param.key}\n                      onChange={this.handleParameterChange}\n                      placeholder={param.defaultValue}\n                      rows={3}\n                      value={this.state.params[param.key] || ''}\n                    />\n                  ) : (\n                    <input\n                      disabled={submitting}\n                      name={param.key}\n                      onChange={this.handleParameterChange}\n                      placeholder={param.defaultValue}\n                      type=\"text\"\n                      value={this.state.params[param.key] || ''}\n                    />\n                  )}\n                  {param.htmlDesc !== undefined && (\n                    <div\n                      className=\"note\"\n                      // eslint-disable-next-line react/no-danger\n                      dangerouslySetInnerHTML={{ __html: sanitizeString(param.htmlDesc) }}\n                    />\n                  )}\n                </div>\n              ))\n            )}\n          </div>\n\n          <footer className=\"modal-foot\">\n            {submitting && <i className=\"spinner spacer-right\" />}\n            <SubmitButton disabled={submitting || activeInAllProfiles}>\n              {isUpdateMode ? translate('save') : translate('coding_rules.activate')}\n            </SubmitButton>\n            <ResetButtonLink disabled={submitting} onClick={this.props.onClose}>\n              {translate('cancel')}\n            </ResetButtonLink>\n          </footer>\n        </form>\n      </Modal>\n    );\n  }\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\nimport * as React from 'react';\nimport SeverityIcon from 'sonar-ui-common/components/icons/SeverityIcon';\nimport { translate } from 'sonar-ui-common/helpers/l10n';\n\ninterface Props {\n  className?: string;\n  severity: string;\n}\n\nexport default function SeverityHelper({ className, severity }: Props) {\n  if (!severity) {\n    return null;\n  }\n  return (\n    <span className={className}>\n      <SeverityIcon className=\"little-spacer-right\" severity={severity} />\n      {translate('severity', severity)}\n    </span>\n  );\n}\n","/*\n * SonarQube\n * Copyright (C) 2009-2021 SonarSource SA\n * mailto:info AT sonarsource DOT com\n *\n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU Lesser General Public\n * License as published by the Free Software Foundation; either\n * version 3 of the License, or (at your option) any later version.\n *\n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n * Lesser General Public License for more details.\n *\n * You should have received a copy of the GNU Lesser General Public License\n * along with this program; if not, write to the Free Software Foundation,\n * Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n */\n\nimport { sanitize } from 'dompurify';\n\nexport function sanitizeStringRestricted(html: string) {\n  return sanitize(html, {\n    ALLOWED_TAGS: ['b', 'br', 'code', 'i', 'li', 'p', 'strong', 'ul', 'a'],\n    ALLOWED_ATTR: ['target', 'href']\n  });\n}\n\nexport function sanitizeString(html: string) {\n  return sanitize(html, { USE_PROFILES: { html: true } });\n}\n"],"sourceRoot":""}