(window.webpackJsonp=window.webpackJsonp||[]).push([[314],{1872:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return _}));var n=a(2),i=a(31),s=a(501),r=a(437),l=a(638);var o=a(335),c=a(312),u=a(323),d=a.n(u),p=a(398),m=a.n(p),h=a(348),g=a.n(h),b=a(322),f=a(368),y=a(341),v=a(810);function k(e){const{allQualityGates:t,currentQualityGate:a,loading:s,selectedQualityGateId:r,submitting:l}=e,u=null==t?void 0:t.find(e=>e.isDefault);if(s)return n.createElement("i",{className:"spinner"});if(void 0===t||void 0===u||void 0===a)return null;const p="-1"===r,h=p?u.id!==a.id:r!==a.id,k=t.map(e=>({label:e.name,value:e.id}));return n.createElement("div",{className:"page page-limited",id:"project-quality-gate"},n.createElement(y.a,{suggestions:"project_quality_gate"}),n.createElement(o.a,{defer:!1,title:Object(i.translate)("project_quality_gate.page")}),n.createElement(f.a,{anchor:"qg_main"}),n.createElement("header",{className:"page-header"},n.createElement("div",{className:"page-title display-flex-center"},n.createElement("h1",null,Object(i.translate)("project_quality_gate.page")),n.createElement(d.a,{className:"spacer-left",overlay:n.createElement("div",{className:"big-padded-top big-padded-bottom"},Object(i.translate)("quality_gates.projects.help"))}))),n.createElement("div",{className:"boxed-group"},n.createElement("h2",{className:"boxed-group-header"},Object(i.translate)("project_quality_gate.subtitle")),n.createElement("form",{className:"boxed-group-inner",onSubmit:t=>{t.preventDefault(),e.onSubmit()}},n.createElement("p",{className:"big-spacer-bottom"},Object(i.translate)("project_quality_gate.page.description")),n.createElement("div",{className:"big-spacer-bottom"},n.createElement(m.a,{className:"display-flex-start",checked:p,disabled:l,onCheck:()=>e.onSelect("-1"),value:"-1"},n.createElement("div",{className:"spacer-left"},n.createElement("div",{className:"little-spacer-bottom"},Object(i.translate)("project_quality_gate.always_use_default")),n.createElement("div",{className:"display-flex-center"},n.createElement("span",{className:"text-muted little-spacer-right"},Object(i.translate)("current_noun"),":"),u.name,u.isBuiltIn&&n.createElement(v.a,{className:"spacer-left"}))))),n.createElement("div",{className:"big-spacer-bottom"},n.createElement(m.a,{className:"display-flex-start",checked:!p,disabled:l,onCheck:t=>e.onSelect(t),value:p?a.id:r},n.createElement("div",{className:"spacer-left"},n.createElement("div",{className:"little-spacer-bottom"},Object(i.translate)("project_quality_gate.always_use_specific")),n.createElement("div",{className:"display-flex-center"},n.createElement(g.a,{className:"abs-width-300",clearable:!1,disabled:l||p,onChange:({value:t})=>e.onSelect(t),options:k,optionRenderer:e=>n.createElement("span",null,e.label),value:r})))),h&&n.createElement(b.Alert,{className:"big-spacer-top",variant:"warning"},Object(i.translate)("project_quality_gate.requires_new_analysis"))),n.createElement("div",null,n.createElement(c.SubmitButton,{disabled:l},Object(i.translate)("save")),l&&n.createElement("i",{className:"spinner spacer-left"})))))}class _ extends n.PureComponent{constructor(){super(...arguments),this.mounted=!1,this.state={loading:!0,selectedQualityGateId:"-1",submitting:!1},this.checkPermissions=()=>{const{configuration:e}=this.props.component;return!!(e&&e.showQualityGates)},this.isUsingDefault=async e=>{const{component:t}=this.props;return!!e.isDefault&&!await Object(s.n)({gateName:e.name,query:t.key}).then(({results:e})=>{var a;return Boolean(null===(a=e.find(e=>e.key===t.key))||void 0===a?void 0:a.selected)}).catch(()=>!1)},this.fetchQualityGates=async()=>{const{component:e}=this.props;this.setState({loading:!0});const[t,a]=await Promise.all([Object(s.i)().then(({qualitygates:e})=>e),Object(s.k)({project:e.key})]).catch(()=>[]);if(t&&a){const e=await this.isUsingDefault(a);this.mounted&&this.setState({allQualityGates:t,currentQualityGate:a,selectedQualityGateId:e?"-1":a.id,loading:!1})}else this.mounted&&this.setState({loading:!1})},this.handleSelect=e=>{this.setState({selectedQualityGateId:e})},this.handleSubmit=async()=>{const{component:e}=this.props,{allQualityGates:t,currentQualityGate:a,selectedQualityGateId:n}=this.state;if(void 0!==t&&void 0!==a&&(this.setState({submitting:!0}),"-1"===n?await Object(s.g)({gateId:a.id,projectKey:e.key}).catch(()=>{}):await Object(s.a)({gateId:n,projectKey:e.key}).catch(()=>{}),this.mounted)){Object(r.a)(Object(i.translate)("project_quality_gate.successfully_updated"));const e="-1"===n?t.find(e=>e.isDefault):t.find(e=>e.id===n);e&&(this.setState({currentQualityGate:e,submitting:!1}),this.props.onComponentChange({qualityGate:e}))}}}componentDidMount(){this.mounted=!0,this.checkPermissions()?this.fetchQualityGates():Object(l.a)()}componentWillUnmount(){this.mounted=!1}render(){if(!this.checkPermissions())return null;const{allQualityGates:e,currentQualityGate:t,loading:a,selectedQualityGateId:i,submitting:s}=this.state;return n.createElement(k,{allQualityGates:e,currentQualityGate:t,loading:a,onSubmit:this.handleSubmit,onSelect:this.handleSelect,selectedQualityGateId:i,submitting:s})}}},323:function(e,t,a){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,a=1,n=arguments.length;a<n;a++)for(var i in t=arguments[a])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},i=this&&this.__rest||function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(n=Object.getOwnPropertySymbols(e);i<n.length;i++)t.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(e,n[i])&&(a[n[i]]=e[n[i]])}return a};Object.defineProperty(t,"__esModule",{value:!0});var s=a(311),r=a(2),l=a(380),o=a(342);a(343);var c=a(317);function u(e){var t=e.size,a=void 0===t?12:t,n=i(e,["size"]);return r.createElement("div",{className:s("help-tooltip",n.className)},r.createElement(c.default,{mouseLeaveDelay:.25,onShow:n.onShow,overlay:n.overlay,placement:n.placement},r.createElement("span",{className:"display-inline-flex-center"},n.children||r.createElement(o.ThemeConsumer,null,(function(e){return r.createElement(l.default,{fill:e.colors.gray71,size:a})})))))}t.default=u,t.DarkHelpTooltip=function(e){var t=e.size,a=void 0===t?12:t,s=i(e,["size"]);return r.createElement(u,n({},s),r.createElement(o.ThemeConsumer,null,(function(e){var t=e.colors;return r.createElement(l.default,{fill:t.transparentBlack,fillInner:t.white,size:a})})))}},341:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(2),i=a(379);function s({suggestions:e}){return n.createElement(i.a.Consumer,null,({addSuggestions:t,removeSuggestions:a})=>n.createElement(r,{addSuggestions:t,removeSuggestions:a,suggestions:e}))}class r extends n.PureComponent{componentDidMount(){this.props.addSuggestions(this.props.suggestions)}componentDidUpdate(e){e.suggestions!==this.props.suggestions&&(this.props.removeSuggestions(this.props.suggestions),this.props.addSuggestions(e.suggestions))}componentWillUnmount(){this.props.removeSuggestions(this.props.suggestions)}render(){return null}}},343:function(e,t,a){var n=a(313),i=a(344);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var s={insert:"head",singleton:!1},r=(n(i,s),i.locals?i.locals:{});e.exports=r},344:function(e,t,a){(t=a(314)(!1)).push([e.i,".help-tooltip{display:inline-flex;align-items:center;vertical-align:middle}.help-toolip-link{display:block;width:12px;height:12px;border:none}",""]),e.exports=t},368:function(e,t,a){"use strict";a.d(t,"a",(function(){return r}));var n=a(2),i=a(31),s=a(433);function r(e){return n.createElement(s.a.Consumer,null,({addA11ySkipLink:t,removeA11ySkipLink:a})=>n.createElement(l,Object.assign({addA11ySkipLink:t,removeA11ySkipLink:a},e)))}class l extends n.PureComponent{constructor(){super(...arguments),this.getLink=()=>{const{anchor:e,label:t=Object(i.translate)("skip_to_content"),weight:a}=this.props;return{key:e,label:t,weight:a}}}componentDidMount(){this.props.addA11ySkipLink(this.getLink())}componentWillUnmount(){this.props.removeA11ySkipLink(this.getLink())}render(){const{anchor:e}=this.props;return n.createElement("span",{id:"a11y_target__".concat(e)})}}},398:function(e,t,a){"use strict";var n,i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var a in t)t.hasOwnProperty(a)&&(e[a]=t[a])})(e,t)},function(e,t){function a(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)});Object.defineProperty(t,"__esModule",{value:!0});var s=a(311),r=a(2);a(403);var l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(e){e.preventDefault(),t.props.disabled||t.props.onCheck(t.props.value)},t}return i(t,e),t.prototype.render=function(){var e=this.props,t=e.className,a=e.checked,n=e.children,i=e.disabled;return r.createElement("a",{"aria-checked":a,className:s("display-inline-flex-center link-radio",t,{disabled:i}),href:"#",onClick:this.handleClick,role:"radio"},r.createElement("i",{className:s("icon-radio","spacer-right",{"is-checked":a})}),n)},t}(r.PureComponent);t.default=l},403:function(e,t,a){var n=a(313),i=a(412);"string"==typeof(i=i.__esModule?i.default:i)&&(i=[[e.i,i,""]]);var s={insert:"head",singleton:!1},r=(n(i,s),i.locals?i.locals:{});e.exports=r},412:function(e,t,a){(t=a(314)(!1)).push([e.i,'.icon-radio{position:relative;display:inline-block;vertical-align:top;width:14px;height:14px;margin:1px;border:1px solid #cdcdcd;border-radius:12px;box-sizing:border-box;transition:border-color .3s ease;flex-shrink:0}.icon-radio:after{position:absolute;top:2px;left:2px;display:block;width:8px;height:8px;border-radius:8px;background-color:#236a97;content:"";opacity:0;transition:opacity .3s ease}.link-radio .icon-radio.is-checked:after{opacity:1}.link-radio{border-bottom:none}.link-radio,.link-radio:not(.disabled):active,.link-radio:not(.disabled):focus,.link-radio:not(.disabled):hover{color:inherit}.link-radio:not(.disabled):hover>.icon-radio{border-color:#4b9fd5}.link-radio.disabled,.link-radio.disabled:hover,.link-radio.disabled label{color:#bbb;cursor:not-allowed}.link-radio.disabled .icon-radio:after{background-color:#ebebeb}',""]),e.exports=t},437:function(e,t,a){"use strict";a.d(t,"a",(function(){return s}));var n=a(416),i=a(414);function s(e){Object(i.default)().dispatch(n.b(e))}},638:function(e,t,a){"use strict";a.d(t,"a",(function(){return l}));var n=a(36),i=a.n(n),s=a(560),r=a(414);function l(){const e=Object(r.default)(),t=i()(),a=window.location.pathname+window.location.search+window.location.hash;e.dispatch(Object(s.c)()),t.replace({pathname:"/sessions/new",query:{return_to:a}})}},810:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a(311),i=a(2),s=a(317),r=a.n(s),l=a(31);function o({className:e}){return i.createElement(r.a,{overlay:Object(l.translate)("quality_gates.built_in.help")},i.createElement("div",{className:n("badge",e)},Object(l.translate)("quality_gates.built_in")))}}}]);
//# sourceMappingURL=314.m.ef01c938.chunk.js.map