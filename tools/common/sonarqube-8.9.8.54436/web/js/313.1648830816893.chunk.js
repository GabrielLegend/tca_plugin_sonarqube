(window.webpackJsonp=window.webpackJsonp||[]).push([[313],{1206:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(660),a=n(13),o=n(899),i=n.n(o),c=n(176),s=n(727);function l(e){var t=e.error,n=e.help,o=e.label,l=e.placeholder,u=e.projectKey,p=e.touched,d=e.validating,m=p&&void 0!==t,g=p&&!d&&void 0===t;return a.createElement(i.a,{className:"form-field",description:Object(c.translate)("onboarding.create_project.project_key.description"),error:t,help:n,id:"project-key",isInvalid:m,isValid:g,label:o,required:void 0!==o},a.createElement("input",{autoFocus:!0,className:r("input-super-large",{"is-invalid":m,"is-valid":g}),id:"project-key",maxLength:s.d,minLength:1,onChange:e.onProjectKeyChange,placeholder:l,type:"text",value:u}))}},1207:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(686),a=n(727);function o(e){return 0===e.length?r.b.Empty:e.length>a.d?r.b.TooLong:/^[\w\-.:]*[a-z\-_.:]+[\w\-.:]*$/i.test(e)?r.b.Valid:/^[0-9]+$/.test(e)?r.b.OnlyDigits:r.b.InvalidChar}},2041:function(e,t,n){var r=n(662),a=n(2042);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1},i=(r(a,o),a.locals?a.locals:{});e.exports=i},2042:function(e,t,n){(t=n(663)(!1)).push([e.i,".manual-project-create{max-width:700px}.manual-project-create .button{margin-top:8px}",""]),e.exports=t},2043:function(e,t,n){var r=n(662),a=n(2044);"string"==typeof(a=a.__esModule?a.default:a)&&(a=[[e.i,a,""]]);var o={insert:"head",singleton:!1},i=(r(a,o),a.locals?a.locals:{});e.exports=i},2044:function(e,t,n){(t=n(663)(!1)).push([e.i,"#create-project{padding-top:0!important}#create-project header{padding-top:20px;background-color:#f3f3f3;position:-webkit-sticky;position:sticky;top:48px;z-index:50}.create-project-manual{display:flex!important;justify-content:space-between}.create-project-azdo-repo{width:410px;min-height:40px;box-sizing:border-box;margin-right:auto}.create-project-import-bbs .open .boxed-group-header{border-bottom:1px solid #e6e6e6}.create-project-import-bbs .boxed-group-inner{padding-top:24px}.create-project-import-bbs-repo{width:250px;min-height:40px}.create-project-github-repository{box-sizing:border-box;width:33.33%}.create-project-github-repository .notice{display:block;position:absolute}.create-project-github-repository .notice svg{color:#0a0}.create-project-import-gitlab table>tbody>tr>td{vertical-align:middle}.create-project-import-gitlab .project-name,.create-project-import-gitlab .project-path{max-width:400px}.create-project-import-gitlab .sq-project-link{max-width:300px}.create-project-import-gitlab .already-set-up svg{color:#0a0}",""]),e.exports=t},2183:function(e,t,n){"use strict";n.r(t),n.d(t,"CreateProjectPage",(function(){return mt}));var r=n(13),a=n(684),o=n(176),i=n(832),c=n(717),s=n(988),l=n(789),u=n(670),p=n(719),d=n(733),m=n.n(d),g=n(49),h=n(673),b=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}};function j(e,t){return Object(g.post)("/api/alm_integrations/set_pat",{almSetting:e,pat:t}).catch(h.a)}function y(e){var t=this;return Object(g.get)("/api/alm_integrations/check_pat",{almSetting:e}).then((function(){return{status:!0}})).catch((function(e){return b(t,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return 400!==e.status?[3,2]:[4,Object(g.parseError)(e)];case 1:return[2,{status:!1,error:t.sent()}];case 2:return[2,Object(h.a)(e)]}}))}))}))}function v(e,t){return Object(g.getJSON)("/api/alm_integrations/search_azure_repos",{almSetting:e,searchQuery:t}).catch(h.a)}function _(e,t){return Object(g.getJSON)("/api/alm_integrations/list_github_organizations",{almSetting:e,token:t}).catch((function(e){e&&400!==e.status&&Object(h.a)(e)}))}function k(e){var t=e.almSetting,n=e.organization,r=e.pageSize,a=e.page,o=void 0===a?1:a,i=e.query;return Object(g.getJSON)("/api/alm_integrations/list_github_repositories",{almSetting:t,organization:n,p:o,ps:r,q:i||void 0}).catch(h.a)}function E(e){var t=e.almSetting,n=e.pageSize,r=e.page,a=e.query;return Object(g.getJSON)("/api/alm_integrations/search_gitlab_repos",{almSetting:t,projectName:a||void 0,p:r,ps:n}).then((function(e){return{projects:e.repositories,projectsPaging:e.paging}})).catch(h.a)}function O(e){var t=e.almSetting,n=e.gitlabProjectId;return Object(g.postJSON)("/api/alm_integrations/import_gitlab_project",{almSetting:t,gitlabProjectId:n}).catch(h.a)}var S=n(661),N=n(709),P=n.n(N),w=n(668),R=n.n(w),x=n(687),A=n(660),z=n.n(A),C=n(665),M=n(899),I=n.n(M),T=n(732),F=n.n(T);function B(e){return e.replace(/\/$/,"")+"/_usersSettings/tokens"}function K(e){var t=e.almSetting,n=t.alm,a=t.url,i=e.submitting,c=void 0!==i&&i,s=e.validationFailed,l=r.useState(!1),u=l[0],p=l[1];r.useEffect((function(){p(!1)}),[c]);var d,m=r.useState(""),g=m[0],h=m[1],b=s&&!u||u&&!g;return g?b&&(d=Object(o.translate)("onboarding.create_project.pat_incorrect",n)):d=Object(o.translate)("onboarding.create_project.pat_form.pat_required"),r.createElement("div",{className:"boxed-group abs-width-600"},r.createElement("div",{className:"boxed-group-inner"},r.createElement("h2",null,Object(o.translate)("onboarding.create_project.pat_form.title",n)),r.createElement("div",{className:"big-spacer-top big-spacer-bottom"},r.createElement(C.FormattedMessage,{id:"onboarding.create_project.pat_help.instructions",defaultMessage:Object(o.translate)("onboarding.create_project.pat_help.instructions",n),values:{link:a?r.createElement("a",{className:"link-with-icon",href:B(a),rel:"noopener noreferrer",target:"_blank"},r.createElement(F.a,{className:"little-spacer-right"}),r.createElement("span",null,Object(o.translate)("onboarding.create_project.pat_help.instructions.link",n))):Object(o.translate)("onboarding.create_project.pat_help.instructions.link",n),scope:r.createElement("strong",null,r.createElement("em",null,"Code (Read & Write)"))}})),r.createElement("form",{onSubmit:function(t){t.preventDefault(),e.onPersonalAccessTokenCreate(g)}},r.createElement(I.a,{error:d,id:"personal_access_token",isInvalid:b,isValid:!1,label:Object(o.translate)("onboarding.create_project.enter_pat"),required:!0},r.createElement("input",{autoFocus:!0,className:A("width-100 little-spacer-bottom",{"is-invalid":b}),id:"personal_access_token",minLength:1,name:"personal_access_token",onChange:function(e){h(e.target.value),p(!0)},type:"text",value:g})),r.createElement(S.SubmitButton,{disabled:b||c||!u},Object(o.translate)("onboarding.create_project.pat_form.list_repositories")),r.createElement(R.a,{className:"spacer-left",loading:c}))))}var q,L=n(667),V=n(699),D=n.n(V),G=n(671),Q=n(954),U=n.n(Q),J=n(746),W=n.n(J),H=n(872),$=n.n(H),X=n(698);!function(e){e.Manual="manual",e.AzureDevOps="azure",e.BitbucketServer="bitbucket",e.GitHub="github",e.GitLab="gitlab"}(q||(q={}));function Y(e,t,n){if(void 0===n&&(n=!1),!t||!e.toLowerCase().includes(t.toLowerCase()))return e;var a=e.split(new RegExp("("+t+")(.*)","i")),o=a[0],i=a[1],c=a[2];return r.createElement(r.Fragment,null,o,r.createElement("strong",{className:A({underline:n})},i),c)}function Z(e){var t=e.importing,n=e.loading,a=e.startsOpen,i=e.project,c=e.repositories,s=void 0===c?[]:c,l=e.searchQuery,p=e.selectedRepository,d=r.useState(a),m=d[0],g=d[1],h=r.useState(1),b=h[0],f=h[1],j=s.slice(0,30*b),y=function(e){return(null==p?void 0:p.projectName)===i.name&&p.name===e.name};return r.createElement(U.a,{className:A("big-spacer-bottom",{open:m}),onClick:function(){m||e.onOpen(i.name),g(!m)},open:m,title:r.createElement("h3",{title:i.description},Y(i.name,l,!0))},m&&r.createElement(R.a,{loading:n},n||0!==s.length?r.createElement(r.Fragment,null,r.createElement("div",{className:"display-flex-wrap"},j.map((function(n){return r.createElement("div",{className:"create-project-azdo-repo display-flex-start spacer-bottom padded-right",key:n.name},n.sqProjectKey?r.createElement(r.Fragment,null,r.createElement($.a,{className:"spacer-right",fill:X.colors.green,size:14}),r.createElement("div",{className:"overflow-hidden"},r.createElement("div",{className:"little-spacer-bottom text-ellipsis"},r.createElement(L.c,{to:Object(u.v)(n.sqProjectKey),title:n.sqProjectName},Y(n.sqProjectName||n.name,l))),r.createElement("em",null,Object(o.translate)("onboarding.create_project.repository_imported")))):r.createElement(W.a,{checked:y(n),className:"overflow-hidden",disabled:t,onCheck:function(){return e.onSelectRepository(n)},value:n.name},r.createElement("span",{className:"text-ellipsis",title:n.name},Y(n.name,l))))}))),r.createElement(D.a,{count:j.length,total:s.length,loadMore:function(){return f((function(e){return e+1}))}})):r.createElement(G.Alert,{variant:"warning"},r.createElement(C.FormattedMessage,{defaultMessage:Object(o.translate)("onboarding.create_project.azure.no_repositories"),id:"onboarding.create_project.azure.no_repositories",values:{link:r.createElement(L.c,{to:{pathname:"/projects/create",query:{mode:q.AzureDevOps,resetPat:1}}},Object(o.translate)("onboarding.create_project.update_your_token"))}}))))}function ee(e){var t=e.importing,n=e.loadingRepositories,a=e.projects,i=void 0===a?[]:a,c=e.repositories,s=e.searchResults,l=e.searchQuery,u=e.selectedRepository,p=r.useState(1),d=p[0],m=p[1],g=s?i.filter((function(e){return void 0!==s[e.name]})):i;if(0===g.length)return r.createElement(G.Alert,{className:"spacer-top",variant:"warning"},s?Object(o.translate)("onboarding.create_project.azure.no_results"):r.createElement(C.FormattedMessage,{defaultMessage:Object(o.translate)("onboarding.create_project.azure.no_projects"),id:"onboarding.create_project.azure.no_projects",values:{link:r.createElement(L.c,{to:{pathname:"/projects/create",query:{mode:q.AzureDevOps,resetPat:1}}},Object(o.translate)("onboarding.create_project.update_your_token"))}}));var h=g.slice(0,10*d),b=s?" - result":"";return r.createElement("div",null,h.map((function(a,o){return r.createElement(Z,{key:""+a.name+b,importing:t,loading:Boolean(n[a.name]),onOpen:e.onOpenProject,onSelectRepository:e.onSelectRepository,project:a,repositories:s?s[a.name]:c[a.name],selectedRepository:u,searchQuery:l,startsOpen:void 0!==s||0===o})})),r.createElement(D.a,{count:h.length,loadMore:function(){return m((function(e){return e+1}))},total:g.length}))}function te(e){var t=e.additionalActions,n=e.title;return r.createElement("header",{className:"huge-spacer-bottom bordered-bottom overflow-hidden"},r.createElement("h1",{className:"pull-left huge big-spacer-bottom"},n),t)}var ne=n(968);function re(e){var t=e.alm,n=e.canAdmin;return r.createElement(G.Alert,{variant:"error"},n?r.createElement(C.FormattedMessage,{defaultMessage:Object(o.translate)("onboarding.create_project.wrong_binding_count.admin"),id:"onboarding.create_project.wrong_binding_count.admin",values:{alm:Object(o.translate)("onboarding.alm",t),url:r.createElement(L.c,{to:{pathname:"/admin/settings",query:{category:ne.a}}},Object(o.translate)("settings.page"))}}):r.createElement(C.FormattedMessage,{defaultMessage:Object(o.translate)("onboarding.create_project.wrong_binding_count"),id:"onboarding.create_project.wrong_binding_count",values:{alm:Object(o.translate)("onboarding.alm",t)}}))}function ae(e){var t=e.canAdmin,n=e.importing,a=e.loading,i=e.loadingRepositories,c=e.projects,s=e.repositories,l=e.searching,u=e.searchResults,d=e.searchQuery,m=e.selectedRepository,g=e.settings,h=e.showPersonalAccessTokenForm,b=e.submittingToken,f=e.tokenValidationFailed;return r.createElement(r.Fragment,null,r.createElement(te,{additionalActions:!h&&r.createElement("div",{className:"display-flex-center pull-right"},r.createElement(R.a,{className:"spacer-right",loading:n}),r.createElement(S.Button,{className:"button-large button-primary",disabled:!m||n,onClick:e.onImportRepository},Object(o.translate)("onboarding.create_project.import_selected_repo"))),title:r.createElement("span",{className:"text-middle"},r.createElement("img",{alt:"",className:"spacer-right",height:"24",src:Object(x.getBaseUrl)()+"/images/alm/azure.svg"}),Object(o.translate)("onboarding.create_project.azure.title"))}),a&&r.createElement("i",{className:"spinner"}),!a&&!(g&&g.url)&&r.createElement(re,{alm:p.a.Azure,canAdmin:!!t}),!a&&g&&(h?r.createElement("div",{className:"display-flex-justify-center"},r.createElement(K,{almSetting:g,onPersonalAccessTokenCreate:e.onPersonalAccessTokenCreate,submitting:b,validationFailed:f})):r.createElement(r.Fragment,null,r.createElement("div",{className:"huge-spacer-bottom"},r.createElement(P.a,{onChange:e.onSearch,placeholder:Object(o.translate)("onboarding.create_project.search_projects_repositories")})),r.createElement(R.a,{loading:Boolean(l)},r.createElement(ee,{importing:n,loadingRepositories:i,onOpenProject:e.onOpenProject,onSelectRepository:e.onSelectRepository,projects:c,repositories:s,searchResults:u,searchQuery:d,selectedRepository:m})))))}var oe,ie=(oe=function(e,t){return(oe=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}oe(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),ce=function(){return(ce=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},se=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},le=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},ue=function(e){function t(t){var n=e.call(this,t)||this;return n.mounted=!1,n.fetchInitialData=function(){return se(n,void 0,void 0,(function(){var e,t,n,r,a;return le(this,(function(o){switch(o.label){case 0:return this.setState({loading:!0}),[4,this.checkPersonalAccessToken().catch((function(){return!1}))];case 1:return(e=o.sent())?[4,this.fetchAzureProjects()]:[3,3];case 2:t=o.sent(),o.label=3;case 3:return n=this.state.repositories,t&&t.length>0?(r=t[0].name,this.setState((function(e){var t,n=e.loadingRepositories;return{loadingRepositories:ce(ce({},n),(t={},t[r]=!0,t))}})),[4,this.fetchAzureRepositories(r)]):[3,5];case 4:a=o.sent(),n[r]=a,o.label=5;case 5:return this.mounted&&this.setState((function(a){var o=a.loadingRepositories;return r&&(o[r]=!1),{patIsValid:e,loading:!1,loadingRepositories:ce({},o),projects:t,repositories:n}})),[2]}}))}))},n.fetchAzureProjects=function(){var e,t=n.state.settings;return t?(e=t.key,Object(g.getJSON)("/api/alm_integrations/list_azure_projects",{almSetting:e}).catch(h.a)).then((function(e){return e.projects})):Promise.resolve(void 0)},n.fetchAzureRepositories=function(e){var t=n.state.settings;return t?function(e,t){return Object(g.getJSON)("/api/alm_integrations/search_azure_repos",{almSetting:e,projectName:t}).catch(h.a)}(t.key,e).then((function(e){return e.repositories})).catch((function(){return[]})):Promise.resolve([])},n.cleanUrl=function(){var e=n.props,t=e.location,r=e.router;delete t.query.resetPat,r.replace(t)},n.handleOpenProject=function(e){return se(n,void 0,void 0,(function(){var t;return le(this,(function(n){switch(n.label){case 0:return this.state.searchResults?[2]:(this.setState((function(t){var n,r=t.loadingRepositories;return{loadingRepositories:ce(ce({},r),(n={},n[e]=!0,n))}})),[4,this.fetchAzureRepositories(e)]);case 1:return t=n.sent(),this.setState((function(n){var r,a,o=n.loadingRepositories,i=n.repositories;return{loadingRepositories:ce(ce({},o),(r={},r[e]=!1,r)),repositories:ce(ce({},i),(a={},a[e]=t,a))}})),[2]}}))}))},n.handleSearchRepositories=function(e){return se(n,void 0,void 0,(function(){var t,n;return le(this,(function(r){switch(r.label){case 0:return(t=this.state.settings)?0===e.length?(this.setState({searchResults:void 0,searchQuery:void 0}),[2]):(this.setState({searching:!0}),[4,v(t.key,e).then((function(e){return e.repositories})).catch((function(){return[]}))]):[2];case 1:return n=r.sent(),this.mounted&&this.setState({searching:!1,searchResults:m()(n,"projectName"),searchQuery:e}),[2]}}))}))},n.handleImportRepository=function(){return se(n,void 0,void 0,(function(){var e,t,n,r;return le(this,(function(a){switch(a.label){case 0:return e=this.state,t=e.selectedRepository,(n=e.settings)&&t?(this.setState({importing:!0}),[4,(o=n.key,i=t.projectName,c=t.name,Object(g.postJSON)("/api/alm_integrations/import_azure_project",{almSetting:o,projectName:i,repositoryName:c}).catch(h.a)).then((function(e){return e.project})).catch((function(){}))]):[2];case 1:return r=a.sent(),this.mounted&&(this.setState({importing:!1}),r&&this.props.onProjectCreate([r.key])),[2]}var o,i,c}))}))},n.handleSelectRepository=function(e){n.setState({selectedRepository:e})},n.checkPersonalAccessToken=function(){var e=n.state.settings;return e?y(e.key).then((function(e){return e.status})):Promise.resolve(!1)},n.handlePersonalAccessTokenCreate=function(e){return se(n,void 0,void 0,(function(){var t,n;return le(this,(function(r){switch(r.label){case 0:if(!(t=this.state.settings)||e.length<1)return[2];this.setState({submittingToken:!0,tokenValidationFailed:!1}),r.label=1;case 1:return r.trys.push([1,4,,5]),[4,j(t.key,e)];case 2:return r.sent(),[4,this.checkPersonalAccessToken()];case 3:return n=r.sent(),this.mounted&&(this.setState({submittingToken:!1,patIsValid:n,tokenValidationFailed:!n}),n&&(this.cleanUrl(),this.fetchInitialData())),[3,5];case 4:return r.sent(),this.mounted&&this.setState({submittingToken:!1}),[3,5];case 5:return[2]}}))}))},n.state={settings:t.settings[0],importing:!1,loading:!1,loadingRepositories:{},repositories:{},tokenValidationFailed:!1},n}return ie(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.fetchInitialData()},t.prototype.componentDidUpdate=function(e){var t=this;0===e.settings.length&&this.props.settings.length>0&&this.setState({settings:1===this.props.settings.length?this.props.settings[0]:void 0},(function(){return t.fetchInitialData()}))},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this.props,t=e.canAdmin,n=e.loadingBindings,a=e.location,o=this.state,i=o.importing,c=o.loading,s=o.loadingRepositories,l=o.patIsValid,u=o.projects,p=o.repositories,d=o.searching,m=o.searchResults,g=o.searchQuery,h=o.selectedRepository,b=o.settings,f=o.submittingToken,j=o.tokenValidationFailed;return r.createElement(ae,{canAdmin:t,importing:i,loading:c||n,loadingRepositories:s,onImportRepository:this.handleImportRepository,onOpenProject:this.handleOpenProject,onPersonalAccessTokenCreate:this.handlePersonalAccessTokenCreate,onSearch:this.handleSearchRepositories,onSelectRepository:this.handleSelectRepository,projects:u,repositories:p,searching:d,searchResults:m,searchQuery:g,selectedRepository:h,settings:b,showPersonalAccessTokenForm:!l||Boolean(a.query.resetPat),submittingToken:f,tokenValidationFailed:j})},t}(r.PureComponent),pe=n(701),de=n.n(pe),me=n(805),ge=n.n(me);function he(e){var t,n=e.disableRepositories,a=e.open,i=e.project,c=e.repositories,s=e.selectedRepository,l=e.showingAllRepositories,p=c.length,d=null!==(t=null==i?void 0:i.name)&&void 0!==t?t:Object(o.translate)("search_results");return r.createElement(U.a,{className:A("big-spacer-bottom",{open:a,"not-clickable":!e.onClick,"no-hover":!e.onClick}),onClick:e.onClick?e.onClick:function(){},open:a,title:r.createElement("h3",null,d)},a&&r.createElement(r.Fragment,null,r.createElement("div",{className:"display-flex-wrap"},0===p&&r.createElement(G.Alert,{variant:"warning"},r.createElement(C.FormattedMessage,{defaultMessage:Object(o.translate)("onboarding.create_project.no_bbs_repos"),id:"onboarding.create_project.no_bbs_repos",values:{link:r.createElement(L.c,{to:{pathname:"/projects/create",query:{mode:q.BitbucketServer,resetPat:1}}},Object(o.translate)("onboarding.create_project.update_your_token"))}})),c.map((function(t){return t.sqProjectKey?r.createElement("div",{className:"display-flex-start spacer-right spacer-bottom create-project-import-bbs-repo",key:t.id},r.createElement($.a,{className:"spacer-right",fill:X.colors.green,size:14}),r.createElement("div",{className:"overflow-hidden"},r.createElement("div",{className:"little-spacer-bottom text-ellipsis"},r.createElement("strong",{title:t.name},r.createElement(L.c,{to:Object(u.v)(t.sqProjectKey)},t.name))),r.createElement("em",null,Object(o.translate)("onboarding.create_project.repository_imported")))):r.createElement(W.a,{checked:(null==s?void 0:s.id)===t.id,className:A("display-flex-start spacer-right spacer-bottom create-project-import-bbs-repo overflow-hidden",{disabled:n,"text-muted":n,"link-no-underline":n}),key:t.id,onCheck:function(){return e.onSelectRepository(t)},value:String(t.id)},r.createElement("strong",{className:"text-ellipsis",title:t.name},t.name))}))),!l&&p>0&&r.createElement(G.Alert,{variant:"warning"},Object(o.translateWithParameters)("onboarding.create_project.only_showing_X_first_repos",p))))}var be=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,c=o.length;i<c;i++,a++)r[a]=o[i];return r};function fe(e){var t=e.disableRepositories,n=e.projects,a=e.projectRepositories,i=e.selectedRepository,c=r.useState(n.length>0?[n[0].key]:[]),s=c[0],l=c[1],u=n.length<=s.length;return r.createElement(r.Fragment,null,r.createElement("div",{className:"overflow-hidden spacer-bottom"},r.createElement(S.ButtonLink,{className:"pull-right",onClick:function(){return l(u?[]:n.map((function(e){return e.key})))}},u?Object(o.translate)("collapse_all"):Object(o.translate)("expand_all"))),n.map((function(n){var o=s.includes(n.key),c=a[n.key]||{},u=c.allShown,p=c.repositories,d=void 0===p?[]:p;return r.createElement(he,{disableRepositories:t,key:n.key,onClick:function(){return function(e,t){l(e?de()(s,t):ge()(be(s,[t])))}(o,n.key)},onSelectRepository:e.onSelectRepository,open:o,project:n,repositories:d,selectedRepository:i,showingAllRepositories:u})})))}function je(e){var t=e.disableRepositories,n=e.projects,a=e.searching,i=e.searchResults,c=void 0===i?[]:i,s=e.selectedRepository;if(0===c.length&&!a)return r.createElement(G.Alert,{className:"big-spacer-top",variant:"warning"},Object(o.translate)("onboarding.create_project.no_bbs_repos.filter"));var l=n.filter((function(e){return c.some((function(t){return t.projectKey===e.key}))})),u=l.map((function(e){return e.key})),p=c.filter((function(e){return!u.includes(e.projectKey)}));return r.createElement("div",{className:"big-spacer-top"},r.createElement(R.a,{loading:a},p.length>0&&r.createElement(he,{disableRepositories:t,onSelectRepository:e.onSelectRepository,open:!0,repositories:p,selectedRepository:s,showingAllRepositories:!0}),l.map((function(n){var a=c.filter((function(e){return e.projectKey===n.key}));return r.createElement(he,{disableRepositories:t,key:n.key,onSelectRepository:e.onSelectRepository,open:!0,project:n,repositories:a,selectedRepository:s,showingAllRepositories:!0})}))))}function ye(e){var t=e.disableRepositories,n=e.projects,a=void 0===n?[]:n,i=e.projectRepositories,c=void 0===i?{}:i,s=e.searchResults,l=e.searching,u=e.selectedRepository;return 0===a.length?r.createElement(G.Alert,{className:"spacer-top",variant:"warning"},r.createElement(C.FormattedMessage,{defaultMessage:Object(o.translate)("onboarding.create_project.no_bbs_projects"),id:"onboarding.create_project.no_bbs_projects",values:{link:r.createElement(L.c,{to:{pathname:"/projects/create",query:{mode:q.BitbucketServer,resetPat:1}}},Object(o.translate)("onboarding.create_project.update_your_token"))}})):r.createElement("div",{className:"create-project-import-bbs"},r.createElement(P.a,{onChange:e.onSearch,placeholder:Object(o.translate)("onboarding.create_project.search_repositories_by_name")}),l||s?r.createElement(je,{disableRepositories:t,onSelectRepository:e.onSelectRepository,projects:a,searchResults:s,searching:l,selectedRepository:u}):r.createElement(fe,{disableRepositories:t,onSelectRepository:e.onSelectRepository,projectRepositories:c,projects:a,selectedRepository:u}))}function ve(e,t){return e===p.a.BitbucketServer?t.replace(/\/$/,"")+"/plugins/servlet/access-tokens/add":t.endsWith("/api/v4")?t.replace("/api/v4","").replace(/\/$/,"")+"/profile/personal_access_tokens":"https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html#creating-a-personal-access-token"}function _e(e){var t=e.almSetting,n=t.alm,a=t.url,i=e.submitting,c=void 0!==i&&i,s=e.validationFailed,l=e.validationErrorMessage,u=r.useState(!1),d=u[0],m=u[1];r.useEffect((function(){m(!1)}),[c]);var g=s&&!d,h=null!=l?l:Object(o.translate)("onboarding.create_project.pat_incorrect",n);return r.createElement("div",{className:"display-flex-start"},r.createElement("form",{className:"width-50",onSubmit:function(t){t.preventDefault();var n=new FormData(t.currentTarget).get("personal_access_token");e.onPersonalAccessTokenCreate(n)}},r.createElement("h2",{className:"big"},Object(o.translate)("onboarding.create_project.pat_form.title",n)),r.createElement("p",{className:"big-spacer-top big-spacer-bottom"},Object(o.translate)("onboarding.create_project.pat_form.help",n)),r.createElement(I.a,{error:g?h:void 0,id:"personal_access_token",isInvalid:g,isValid:!1,label:Object(o.translate)("onboarding.create_project.enter_pat"),required:!0},r.createElement("input",{autoFocus:!0,className:A("input-super-large",{"is-invalid":g}),id:"personal_access_token",minLength:1,name:"personal_access_token",onChange:function(){m(!0)},type:"text"})),r.createElement(S.SubmitButton,{disabled:g||c||!d},Object(o.translate)("save")),r.createElement(R.a,{className:"spacer-left",loading:c})),r.createElement(G.Alert,{className:"big-spacer-left width-50",display:"block",variant:"info"},r.createElement("h3",null,Object(o.translate)("onboarding.create_project.pat_help.title")),r.createElement("p",{className:"big-spacer-top big-spacer-bottom"},r.createElement(C.FormattedMessage,{id:"onboarding.create_project.pat_help.instructions",defaultMessage:Object(o.translate)("onboarding.create_project.pat_help.instructions"),values:{alm:Object(o.translate)("onboarding.alm",n)}})),a&&r.createElement("div",{className:"text-middle"},r.createElement("img",{alt:"",className:"spacer-right",height:"16",src:Object(x.getBaseUrl)()+"/images/alm/"+n+".svg"}),r.createElement("a",{href:ve(n,a),rel:"noopener noreferrer",target:"_blank"},Object(o.translate)("onboarding.create_project.pat_help.link"))),r.createElement("p",{className:"big-spacer-top big-spacer-bottom"},Object(o.translate)("onboarding.create_project.pat_help.instructions2",n)),r.createElement("ul",null,n===p.a.BitbucketServer&&r.createElement(r.Fragment,null,r.createElement("li",null,r.createElement(C.FormattedMessage,{defaultMessage:Object(o.translate)("onboarding.create_project.pat_help.bbs_permission_projects"),id:"onboarding.create_project.pat_help.bbs_permission_projects",values:{perm:r.createElement("strong",null,Object(o.translate)("onboarding.create_project.pat_help.read_permission"))}})),r.createElement("li",null,r.createElement(C.FormattedMessage,{defaultMessage:Object(o.translate)("onboarding.create_project.pat_help.bbs_permission_repos"),id:"onboarding.create_project.pat_help.bbs_permission_repos",values:{perm:r.createElement("strong",null,Object(o.translate)("onboarding.create_project.pat_help.read_permission"))}}))),n===p.a.GitLab&&r.createElement("li",{className:"spacer-bottom"},r.createElement("strong",null,Object(o.translate)("onboarding.create_project.pat_help.gitlab.read_api_permission"))))))}function ke(e){var t=e.bitbucketSetting,n=e.canAdmin,a=e.importing,i=e.loading,c=e.projects,s=e.projectRepositories,l=e.selectedRepository,u=e.searching,d=e.searchResults,m=e.showPersonalAccessTokenForm,g=e.submittingToken,h=e.tokenValidationFailed;return r.createElement(r.Fragment,null,r.createElement(te,{additionalActions:!m&&r.createElement("div",{className:"display-flex-center pull-right"},r.createElement(R.a,{className:"spacer-right",loading:a}),r.createElement(S.Button,{className:"button-large button-primary",disabled:!l||a,onClick:e.onImportRepository},Object(o.translate)("onboarding.create_project.import_selected_repo"))),title:r.createElement("span",{className:"text-middle"},r.createElement("img",{alt:"",className:"spacer-right",height:"24",src:Object(x.getBaseUrl)()+"/images/alm/bitbucket.svg"}),Object(o.translate)("onboarding.create_project.from_bbs"))}),i&&r.createElement("i",{className:"spinner"}),!i&&!t&&r.createElement(re,{alm:p.a.BitbucketServer,canAdmin:!!n}),!i&&t&&(m?r.createElement(_e,{almSetting:t,onPersonalAccessTokenCreate:e.onPersonalAccessTokenCreate,submitting:g,validationFailed:h}):r.createElement(ye,{disableRepositories:a,onSearch:e.onSearch,onSelectRepository:e.onSelectRepository,projectRepositories:s,projects:c,searchResults:d,searching:u,selectedRepository:l})))}var Ee=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Oe=function(){return(Oe=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},Se=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},Ne=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},Pe=function(e){function t(t){var n=e.call(this,t)||this;return n.mounted=!1,n.fetchInitialData=function(){return Se(n,void 0,void 0,(function(){var e,t,n;return Ne(this,(function(r){switch(r.label){case 0:return this.setState({loading:!0}),[4,this.checkPersonalAccessToken().catch((function(){return!1}))];case 1:return(e=r.sent())?[4,this.fetchBitbucketProjects().catch((function(){}))]:[3,3];case 2:t=r.sent(),r.label=3;case 3:return t&&t.length>0?[4,this.fetchBitbucketRepositories(t).catch((function(){}))]:[3,5];case 4:n=r.sent(),r.label=5;case 5:return this.mounted&&this.setState({patIsValid:e,projects:t,projectRepositories:n,loading:!1}),[2]}}))}))},n.checkPersonalAccessToken=function(){var e=n.state.bitbucketSetting;return e?y(e.key).then((function(e){return e.status})):Promise.resolve(!1)},n.fetchBitbucketProjects=function(){var e,t=n.state.bitbucketSetting;return t?(e=t.key,Object(g.getJSON)("/api/alm_integrations/list_bitbucketserver_projects",{almSetting:e})).then((function(e){return e.projects})):Promise.resolve(void 0)},n.fetchBitbucketRepositories=function(e){var t=n.state.bitbucketSetting;return t?Promise.all(e.map((function(e){return(n=t.key,r=e.name,Object(g.getJSON)("/api/alm_integrations/search_bitbucketserver_repos",{almSetting:n,projectName:r})).then((function(t){var n=t.isLastPage,r=t.repositories.filter((function(t){return t.projectKey===e.key}));return{repositories:r,isLastPage:n||r.length<25,projectKey:e.key}}));var n,r}))).then((function(e){return e.reduce((function(e,t){var n,r=t.isLastPage,a=t.projectKey,o=t.repositories;return Oe(Oe({},e),((n={})[a]={allShown:r,repositories:o},n))}),{})})):Promise.resolve(void 0)},n.handlePersonalAccessTokenCreate=function(e){var t=n.state.bitbucketSetting;!t||e.length<1||(n.setState({submittingToken:!0,tokenValidationFailed:!1}),j(t.key,e).then(n.checkPersonalAccessToken).then((function(e){n.mounted&&(n.setState({submittingToken:!1,patIsValid:e,tokenValidationFailed:!e}),e&&n.fetchInitialData())})).catch((function(){n.mounted&&n.setState({submittingToken:!1})})))},n.handleImportRepository=function(){var e,t,r,a=n.state,o=a.bitbucketSetting,i=a.selectedRepository;o&&i&&(n.setState({importing:!0}),(e=o.key,t=i.projectKey,r=i.slug,Object(g.postJSON)("/api/alm_integrations/import_bitbucketserver_project",{almSetting:e,projectKey:t,repositorySlug:r}).catch(h.a)).then((function(e){var t=e.project.key;n.mounted&&(n.setState({importing:!1}),n.props.onProjectCreate([t]))})).catch((function(){n.mounted&&n.setState({importing:!1})})))},n.handleSearch=function(e){var t,r,a=n.state.bitbucketSetting;a&&(e?(n.setState({searching:!0,selectedRepository:void 0}),(t=a.key,r=e,Object(g.getJSON)("/api/alm_integrations/search_bitbucketserver_repos",{almSetting:t,repositoryName:r})).then((function(e){var t=e.repositories;n.mounted&&n.setState({searching:!1,searchResults:t})})).catch((function(){n.mounted&&n.setState({searching:!1})}))):n.setState({searching:!1,searchResults:void 0,selectedRepository:void 0}))},n.handleSelectRepository=function(e){n.setState({selectedRepository:e})},n.state={bitbucketSetting:t.bitbucketSettings[0],importing:!1,loading:!1,searching:!1,tokenValidationFailed:!1},n}return Ee(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.fetchInitialData()},t.prototype.componentDidUpdate=function(e){var t=this;0===e.bitbucketSettings.length&&this.props.bitbucketSettings.length>0&&this.setState({bitbucketSetting:this.props.bitbucketSettings[0]},(function(){return t.fetchInitialData()}))},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this.props,t=e.canAdmin,n=e.loadingBindings,a=e.location,o=this.state,i=o.bitbucketSetting,c=o.importing,s=o.loading,l=o.patIsValid,u=o.projectRepositories,p=o.projects,d=o.searching,m=o.searchResults,g=o.selectedRepository,h=o.submittingToken,b=o.tokenValidationFailed;return r.createElement(ke,{bitbucketSetting:i,canAdmin:t,importing:c,loading:s||n,onImportRepository:this.handleImportRepository,onPersonalAccessTokenCreate:this.handlePersonalAccessTokenCreate,onProjectCreate:this.props.onProjectCreate,onSearch:this.handleSearch,onSelectRepository:this.handleSelectRepository,projectRepositories:u,projects:p,searchResults:m,searching:d,selectedRepository:g,showPersonalAccessTokenForm:!l||Boolean(a.query.resetPat),submittingToken:h,tokenValidationFailed:b})},t}(r.PureComponent),we=n(833),Re=n(727);function xe(e,t,n){var a=e.almCounts,i=e.appState.canAdmin,c=e.loadingBindings,s=a[t],l=1!==s||c,u=[];return 0===s&&(i&&u.push({href:"/admin/settings?category="+ne.a+"&alm="+t,label:Object(o.translateWithParameters)("onboarding.create_project.set_up_x",Object(o.translate)("alm",t,"short"))}),u.push({href:Re.a[t],label:Object(o.translateWithParameters)("onboarding.create_project.help_set_up_x",Object(o.translate)("alm",t,"short"))})),r.createElement("div",{className:"big-spacer-left display-flex-column"},r.createElement("button",{className:A("button button-huge display-flex-column create-project-mode-type-alm",{disabled:l}),disabled:l,onClick:function(){return e.onSelectMode(n)},type:"button"},r.createElement("img",{alt:"",height:80,src:Object(x.getBaseUrl)()+"/images/alm/"+t+".svg"}),r.createElement("div",{className:"medium big-spacer-top abs-height-50 display-flex-center"},Object(o.translate)("onboarding.create_project.select_method",t)),c&&r.createElement("span",null,Object(o.translate)("onboarding.create_project.check_alm_supported"),r.createElement("i",{className:"little-spacer-left spinner"})),!c&&l&&r.createElement("div",{className:"text-muted small spacer-top",style:{lineHeight:1.5}},Object(o.translate)("onboarding.create_project.alm_not_configured"),r.createElement(we.a,{className:"little-spacer-left",content:0===s?Object(o.translate)("onboarding.create_project.zero_alm_instances",t):Object(o.translate)("onboarding.create_project.too_many_alm_instances",t)+" \n                "+Object(o.translateWithParameters)("onboarding.create_project.alm_instances_count_X",s),links:0===s?u:void 0}))))}var Ae=Object(l.a)((function(e){return r.createElement(r.Fragment,null,r.createElement("header",{className:"huge-spacer-top big-spacer-bottom padded"},r.createElement("h1",{className:"text-center huge big-spacer-bottom"},Object(o.translate)("my_account.create_new.TRK")),r.createElement("p",{className:"text-center big"},Object(o.translate)("onboarding.create_project.select_method"))),r.createElement("div",{className:"create-project-modes huge-spacer-top display-flex-justify-center"},r.createElement("button",{className:"button button-huge display-flex-column create-project-mode-type-manual",onClick:function(){return e.onSelectMode(q.Manual)},type:"button"},r.createElement("img",{alt:"",height:80,src:Object(x.getBaseUrl)()+"/images/sonarcloud/analysis/manual.svg"}),r.createElement("div",{className:"medium big-spacer-top"},Object(o.translate)("onboarding.create_project.select_method.manual"))),xe(e,p.a.Azure,q.AzureDevOps),xe(e,p.a.BitbucketServer,q.BitbucketServer),xe(e,p.a.GitHub,q.GitHub),xe(e,p.a.GitLab,q.GitLab)))})),ze=n(731),Ce=n.n(ze),Me=n(1002),Ie=n.n(Me),Te=n(38);function Fe(e){return{value:e.key,label:e.name}}var Be=function(e){return function(t){return Promise.resolve(e.filter((function(e){return!t||e.name.includes(t)})).map(Fe))}};function Ke(e){var t=e.canAdmin,n=e.error,a=e.importing,i=e.loadingBindings,c=e.loadingOrganizations,s=e.organizations,l=e.selectedOrganization,u=e.selectedRepository;return i?r.createElement(R.a,null):r.createElement("div",null,r.createElement(te,{additionalActions:l&&r.createElement("div",{className:"display-flex-center pull-right"},r.createElement(R.a,{className:"spacer-right",loading:a}),r.createElement(S.Button,{className:"button-large button-primary",disabled:!u||a,onClick:e.onImportRepository},Object(o.translate)("onboarding.create_project.import_selected_repo"))),title:r.createElement("span",{className:"text-middle display-flex-center"},r.createElement("img",{alt:"",className:"spacer-right",height:24,src:Object(Te.getBaseUrl)()+"/images/alm/github.svg"}),Object(o.translate)("onboarding.create_project.github.title"))}),n?r.createElement("div",{className:"display-flex-justify-center"},r.createElement("div",{className:"boxed-group padded width-50 huge-spacer-top"},r.createElement("h2",{className:"big-spacer-bottom"},Object(o.translate)("onboarding.create_project.github.warning.title")),r.createElement(G.Alert,{variant:"warning"},t?r.createElement(C.FormattedMessage,{id:"onboarding.create_project.github.warning.message_admin",defaultMessage:Object(o.translate)("onboarding.create_project.github.warning.message_admin"),values:{link:r.createElement(L.c,{to:"/admin/settings?category=almintegration"},Object(o.translate)("onboarding.create_project.github.warning.message_admin.link"))}}):Object(o.translate)("onboarding.create_project.github.warning.message")))):r.createElement(R.a,{loading:c},r.createElement("div",{className:"form-field"},r.createElement("label",null,Object(o.translate)("onboarding.create_project.github.choose_organization")),s.length>0?r.createElement(Ie.a,{defaultOptions:s.map(Fe),onSearch:Be(s),minimumQueryLength:0,onSelect:function(t){var n=t.value;return e.onSelectOrganization(n)},value:l&&Fe(l)}):!c&&r.createElement(G.Alert,{className:"spacer-top",variant:"error"},t?r.createElement(C.FormattedMessage,{id:"onboarding.create_project.github.no_orgs_admin",defaultMessage:Object(o.translate)("onboarding.create_project.github.no_orgs_admin"),values:{link:r.createElement(L.c,{to:"/admin/settings?category=almintegration"},Object(o.translate)("onboarding.create_project.github.warning.message_admin.link"))}}):Object(o.translate)("onboarding.create_project.github.no_orgs")))),function(e){var t=e.importing,n=e.loadingRepositories,a=e.repositories,i=e.repositoryPaging,c=e.searchQuery,s=e.selectedOrganization,l=e.selectedRepository,u=function(e){return!!e.sqProjectKey||n||t};return s&&a&&r.createElement("div",{className:"boxed-group padded display-flex-wrap"},r.createElement("div",{className:"width-100"},r.createElement(P.a,{className:"big-spacer-bottom",onChange:e.onSearch,placeholder:Object(o.translate)("onboarding.create_project.search_repositories"),value:c})),0===a.length?r.createElement("div",{className:"padded"},r.createElement(R.a,{loading:n},Object(o.translate)("no_results"))):a.map((function(t){return r.createElement(W.a,{className:"spacer-top spacer-bottom padded create-project-github-repository",key:t.key,checked:(n=t,!!n.sqProjectKey||!!l&&l.key===n.key),disabled:u(t),value:t.key,onCheck:e.onSelectRepository},r.createElement("div",{className:"big overflow-hidden",title:t.name},r.createElement("div",{className:"text-ellipsis"},t.name),t.sqProjectKey&&r.createElement("em",{className:"notice text-muted-2 small display-flex-center"},Object(o.translate)("onboarding.create_project.repository_imported"),r.createElement($.a,{className:"little-spacer-left",size:12}))));var n})),r.createElement("div",{className:"display-flex-justify-center width-100"},r.createElement(D.a,{count:a.length,total:i.total,loadMore:e.onLoadMore,loading:n})))}(e))}var qe=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Le=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},Ve=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},De=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,c=o.length;i<c;i++,a++)r[a]=o[i];return r},Ge=function(e){function t(t){var n=e.call(this,t)||this;return n.mounted=!1,n.triggerSearch=function(e){var t=n.state.selectedOrganization;t&&(n.setState({selectedRepository:void 0}),n.fetchRepositories({organizationKey:t.key,query:e}))},n.handleSelectOrganization=function(e){n.setState((function(t){return{searchQuery:"",selectedRepository:void 0,selectedOrganization:t.organizations.find((function(t){return t.key===e}))}})),n.fetchRepositories({organizationKey:e})},n.handleSelectRepository=function(e){n.setState((function(t){var n=t.repositories;return{selectedRepository:null==n?void 0:n.find((function(t){return t.key===e}))}}))},n.handleSearch=function(e){n.setState({searchQuery:e}),n.triggerSearch(e)},n.handleLoadMore=function(){var e=n.state,t=e.repositoryPaging,r=e.searchQuery,a=e.selectedOrganization;a&&n.fetchRepositories({organizationKey:a.key,page:t.pageIndex+1,query:r})},n.handleImportRepository=function(){return Le(n,void 0,void 0,(function(){var e,t,n,r,a;return Ve(this,(function(o){switch(o.label){case 0:if(e=this.state,t=e.selectedOrganization,n=e.selectedRepository,!((r=e.settings)&&t&&n))return[3,4];this.setState({importing:!0}),o.label=1;case 1:return o.trys.push([1,,3,4]),[4,(i=r.key,c=t.key,s=n.key,Object(g.postJSON)("/api/alm_integrations/import_github_project",{almSetting:i,organization:c,repositoryKey:s}).catch(h.a))];case 2:return a=o.sent().project,this.props.onProjectCreate([a.key]),[3,4];case 3:return this.mounted&&this.setState({importing:!1}),[7];case 4:return[2]}var i,c,s}))}))},n.state={error:!1,importing:!1,loadingOrganizations:!0,loadingRepositories:!1,organizations:[],repositories:[],repositoryPaging:{pageSize:30,total:0,pageIndex:1},searchQuery:"",settings:t.settings[0]},n.triggerSearch=Ce()(n.triggerSearch,250),n}return qe(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.initialize()},t.prototype.componentDidUpdate=function(e){var t=this;0===e.settings.length&&this.props.settings.length>0&&this.setState({settings:this.props.settings[0]},(function(){return t.initialize()}))},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.initialize=function(){var e;return Le(this,void 0,void 0,(function(){var t,n,r,a,o;return Ve(this,(function(i){switch(i.label){case 0:if(t=this.props,n=t.location,r=t.router,!(a=this.state.settings)||!a.url)return this.setState({error:!0}),[2];this.setState({error:!1}),o=null===(e=n.query)||void 0===e?void 0:e.code,i.label=1;case 1:return i.trys.push([1,6,,7]),o?[3,3]:[4,this.redirectToGithub(a)];case 2:return i.sent(),[3,5];case 3:return delete n.query.code,r.replace(n),[4,this.fetchOrganizations(a,o)];case 4:i.sent(),i.label=5;case 5:return[3,7];case 6:return i.sent(),this.mounted&&this.setState({error:!0}),[3,7];case 7:return[2]}}))}))},t.prototype.redirectToGithub=function(e){return Le(this,void 0,void 0,(function(){var t,n,r;return Ve(this,(function(a){switch(a.label){case 0:return e.url?[4,(o=e.key,Object(g.getJSON)("/api/alm_integrations/get_github_client_id",{almSetting:o}))]:[2];case 1:return(t=a.sent().clientId)?(n=[{param:"client_id",value:t},{param:"redirect_uri",value:Object(x.getHostUrl)()+"/projects/create?mode="+p.a.GitHub}].map((function(e){return e.param+"="+e.value})).join("&"),r=(r=e.url.includes("/api/v3")?e.url.replace("/api/v3",""):e.url.replace("api.","")).replace(/\/$/,""),window.location.replace(r+"/login/oauth/authorize?"+n),[2]):(this.setState({error:!0}),[2])}var o}))}))},t.prototype.fetchOrganizations=function(e,t){return Le(this,void 0,void 0,(function(){var n;return Ve(this,(function(r){switch(r.label){case 0:return[4,_(e.key,t)];case 1:return n=r.sent().organizations,this.mounted&&this.setState({loadingOrganizations:!1,organizations:n}),[2]}}))}))},t.prototype.fetchRepositories=function(e){return Le(this,void 0,void 0,(function(){var t,n,r,a,o,i;return Ve(this,(function(c){switch(c.label){case 0:if(t=e.organizationKey,n=e.page,r=void 0===n?1:n,a=e.query,!(o=this.state.settings))return this.setState({error:!0}),[2];this.setState({loadingRepositories:!0}),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,k({almSetting:o.key,organization:t,pageSize:30,page:r,query:a})];case 2:return i=c.sent(),this.mounted&&this.setState((function(e){var t=e.repositories;return{loadingRepositories:!1,repositoryPaging:i.paging,repositories:1===r?i.repositories:De(t,i.repositories)}})),[3,4];case 3:return c.sent(),this.mounted&&this.setState({loadingRepositories:!1,repositoryPaging:{pageIndex:1,pageSize:30,total:0},repositories:[]}),[3,4];case 4:return[2]}}))}))},t.prototype.render=function(){var e=this.props,t=e.canAdmin,n=e.loadingBindings,a=this.state,o=a.error,i=a.importing,c=a.loadingOrganizations,s=a.loadingRepositories,l=a.organizations,u=a.repositoryPaging,p=a.repositories,d=a.searchQuery,m=a.selectedOrganization,g=a.selectedRepository;return r.createElement(Ke,{canAdmin:t,error:o,importing:i,loadingBindings:n,loadingOrganizations:c,loadingRepositories:s,onImportRepository:this.handleImportRepository,onLoadMore:this.handleLoadMore,onSearch:this.handleSearch,onSelectOrganization:this.handleSelectOrganization,onSelectRepository:this.handleSelectRepository,organizations:l,repositoryPaging:u,searchQuery:d,repositories:p,selectedOrganization:m,selectedRepository:g})},t}(r.Component),Qe=n(666),Ue=n.n(Qe),Je=n(694),We=n.n(Je),He=n(669);function $e(e){var t,n=e.className,a=e.count,i=e.loading,c=e.needReload,s=e.total,l=e.pageSize,u=e.ready,p=void 0===u||u,d=!1;return void 0!==s?d=s>a:void 0!==l&&(d=a%l==0),c&&e.reload?t=r.createElement(S.Button,{className:"spacer-left","data-test":"reload",disabled:i,onClick:e.reload},Object(o.translate)("reload")):d&&e.loadMore&&(t=r.createElement(S.Button,{className:"spacer-left",disabled:i,"data-test":"show-more",onClick:e.loadMore},Object(o.translate)("show_more"))),r.createElement("footer",{className:z()("spacer-top note text-center",{"new-loading":!p},n)},void 0!==s?Object(o.translateWithParameters)("x_of_y_shown",Object(He.formatMeasure)(a,"INT",null),Object(He.formatMeasure)(s,"INT",null)):Object(o.translateWithParameters)("x_show",Object(He.formatMeasure)(a,"INT",null)),t,i&&r.createElement(R.a,{className:"text-bottom spacer-left position-absolute"}))}var Xe=n(686);function Ye(e){var t=e.importingGitlabProjectId,n=e.loadingMore,a=e.projects,i=void 0===a?[]:a,c=e.projectsPaging,s=e.searching,l=e.searchQuery;return 0!==i.length||0!==l.length||s?r.createElement("div",{className:"boxed-group big-padded create-project-import-gitlab"},r.createElement(P.a,{className:"spacer",loading:s,minLength:3,onChange:e.onSearch,placeholder:Object(o.translate)("onboarding.create_project.gitlab.search_prompt")}),r.createElement("hr",null),0===i.length?r.createElement("div",{className:"padded"},Object(o.translate)("no_results")):r.createElement("table",{className:"data zebra zebra-hover"},r.createElement("tbody",null,i.map((function(n){return r.createElement("tr",{key:n.id},r.createElement("td",null,r.createElement(Ue.a,{overlay:n.slug},r.createElement("strong",{className:"project-name display-inline-block text-ellipsis"},n.sqProjectKey?r.createElement(L.c,{to:Object(u.v)(n.sqProjectKey)},r.createElement(We.a,{className:"spacer-right",qualifier:Xe.a.Project}),n.sqProjectName):n.name)),r.createElement("br",null),r.createElement(Ue.a,{overlay:n.pathSlug},r.createElement("span",{className:"text-muted project-path display-inline-block text-ellipsis"},n.pathName))),r.createElement("td",null,r.createElement("a",{className:"display-inline-flex-center big-spacer-right",href:n.url,rel:"noopener noreferrer",target:"_blank"},r.createElement(F.a,{className:"little-spacer-right"}),Object(o.translate)("onboarding.create_project.gitlab.link"))),n.sqProjectKey?r.createElement("td",null,r.createElement("span",{className:"display-flex-center display-flex-justify-end already-set-up"},r.createElement($.a,{className:"little-spacer-right",size:12}),Object(o.translate)("onboarding.create_project.repository_imported"))):r.createElement("td",{className:"text-right"},r.createElement(S.Button,{disabled:!!t,onClick:function(){return e.onImport(n.id)}},Object(o.translate)("onboarding.create_project.gitlab.set_up"),t===n.id&&r.createElement(R.a,{className:"spacer-left"}))))})))),r.createElement($e,{count:i.length,loadMore:e.onLoadMore,loading:n,pageSize:c.pageSize,total:c.total})):r.createElement(G.Alert,{className:"spacer-top",variant:"warning"},r.createElement(C.FormattedMessage,{defaultMessage:Object(o.translate)("onboarding.create_project.gitlab.no_projects"),id:"onboarding.create_project.gitlab.no_projects",values:{link:r.createElement(L.c,{to:{pathname:"/projects/create",query:{mode:q.GitLab,resetPat:1}}},Object(o.translate)("onboarding.create_project.update_your_token"))}}))}function Ze(e){var t=e.canAdmin,n=e.importingGitlabProjectId,a=e.loading,i=e.loadingMore,c=e.projects,s=e.projectsPaging,l=e.searching,u=e.searchQuery,d=e.settings,m=e.showPersonalAccessTokenForm,g=e.submittingToken,h=e.tokenValidationErrorMessage;return r.createElement(r.Fragment,null,r.createElement(te,{title:r.createElement("span",{className:"text-middle"},r.createElement("img",{alt:"",className:"spacer-right",height:"24",src:Object(x.getBaseUrl)()+"/images/alm/gitlab.svg"}),Object(o.translate)("onboarding.create_project.gitlab.title"))}),a&&r.createElement("i",{className:"spinner"}),!a&&!d&&r.createElement(re,{alm:p.a.GitLab,canAdmin:!!t}),!a&&d&&(m?r.createElement(_e,{almSetting:d,onPersonalAccessTokenCreate:e.onPersonalAccessTokenCreate,submitting:g,validationFailed:Boolean(h),validationErrorMessage:h}):r.createElement(Ye,{importingGitlabProjectId:n,loadingMore:i,onImport:e.onImport,onLoadMore:e.onLoadMore,onSearch:e.onSearch,projects:c,projectsPaging:s,searching:l,searchQuery:u})))}var et=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),tt=function(e,t,n,r){return new(n||(n=Promise))((function(a,o){function i(e){try{s(r.next(e))}catch(e){o(e)}}function c(e){try{s(r.throw(e))}catch(e){o(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,c)}s((r=r.apply(e,t||[])).next())}))},nt=function(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function c(o){return function(c){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=(a=i.trys).length>0&&a[a.length-1])&&(6===o[0]||2===o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(e){o=[6,e],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,c])}}},rt=function(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),a=0;for(t=0;t<n;t++)for(var o=arguments[t],i=0,c=o.length;i<c;i++,a++)r[a]=o[i];return r},at=function(e){function t(t){var n=e.call(this,t)||this;return n.mounted=!1,n.fetchInitialData=function(){return tt(n,void 0,void 0,(function(){var e,t,n,r,a,o;return nt(this,(function(i){switch(i.label){case 0:return this.setState({loading:!0}),[4,this.checkPersonalAccessToken()];case 1:return e=i.sent(),t=e.status,n=e.error,t?[4,this.fetchProjects()]:[3,3];case 2:r=i.sent(),i.label=3;case 3:return this.mounted&&(r?(a=r.projects,o=r.projectsPaging,this.setState({tokenIsValid:t,loading:!1,projects:a,projectsPaging:o})):this.setState({loading:!1,tokenValidationErrorMessage:t?void 0:n})),[2]}}))}))},n.checkPersonalAccessToken=function(){var e=n.state.settings;return e?y(e.key):Promise.resolve({status:!1,error:Object(o.translate)("onboarding.create_project.pat_incorrect",p.a.GitLab)})},n.handleError=function(){n.mounted&&n.setState({tokenIsValid:!1})},n.fetchProjects=function(e,t){return void 0===e&&(e=1),tt(n,void 0,void 0,(function(){var n;return nt(this,(function(r){switch(r.label){case 0:if(!(n=this.state.settings))return[2,Promise.resolve(void 0)];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,E({almSetting:n.key,page:e,pageSize:30,query:t})];case 2:return[2,r.sent()];case 3:return r.sent(),[2,this.handleError()];case 4:return[2]}}))}))},n.doImport=function(e){return tt(n,void 0,void 0,(function(){var t;return nt(this,(function(n){switch(n.label){case 0:if(!(t=this.state.settings))return[2,Promise.resolve(void 0)];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,O({almSetting:t.key,gitlabProjectId:e})];case 2:return[2,n.sent()];case 3:return n.sent(),[2,this.handleError()];case 4:return[2]}}))}))},n.handleImport=function(e){return tt(n,void 0,void 0,(function(){var t;return nt(this,(function(n){switch(n.label){case 0:return this.setState({importingGitlabProjectId:e}),[4,this.doImport(e)];case 1:return t=n.sent(),this.mounted&&(this.setState({importingGitlabProjectId:void 0}),t&&this.props.onProjectCreate([t.project.key])),[2]}}))}))},n.handleLoadMore=function(){return tt(n,void 0,void 0,(function(){var e,t,n,r;return nt(this,(function(a){switch(a.label){case 0:return this.setState({loadingMore:!0}),e=this.state,t=e.projectsPaging.pageIndex,n=e.searchQuery,[4,this.fetchProjects(t+1,n)];case 1:return r=a.sent(),this.mounted&&this.setState((function(e){var t=e.projects,n=void 0===t?[]:t,a=e.projectsPaging;return{loadingMore:!1,projects:r?rt(n,r.projects):n,projectsPaging:r?r.projectsPaging:a}})),[2]}}))}))},n.handleSearch=function(e){return tt(n,void 0,void 0,(function(){var t;return nt(this,(function(n){switch(n.label){case 0:return this.setState({searching:!0,searchQuery:e}),[4,this.fetchProjects(1,e)];case 1:return t=n.sent(),this.mounted&&this.setState((function(e){var n=e.projects,r=e.projectsPaging;return{searching:!1,projects:t?t.projects:n,projectsPaging:t?t.projectsPaging:r}})),[2]}}))}))},n.cleanUrl=function(){var e=n.props,t=e.location,r=e.router;delete t.query.resetPat,r.replace(t)},n.handlePersonalAccessTokenCreate=function(e){return tt(n,void 0,void 0,(function(){var t,n,r,a;return nt(this,(function(o){switch(o.label){case 0:if(!(t=this.state.settings)||e.length<1)return[2];this.setState({submittingToken:!0,tokenValidationErrorMessage:void 0}),o.label=1;case 1:return o.trys.push([1,6,,7]),[4,j(t.key,e)];case 2:return o.sent(),[4,this.checkPersonalAccessToken()];case 3:return n=o.sent(),r=n.status,a=n.error,this.mounted?(this.setState({submittingToken:!1,tokenIsValid:r,tokenValidationErrorMessage:a}),r?(this.cleanUrl(),[4,this.fetchInitialData()]):[3,5]):[3,5];case 4:o.sent(),o.label=5;case 5:return[3,7];case 6:return o.sent(),this.mounted&&this.setState({submittingToken:!1}),[3,7];case 7:return[2]}}))}))},n.state={loading:!1,loadingMore:!1,projectsPaging:{pageIndex:1,total:0,pageSize:30},tokenIsValid:!1,searching:!1,searchQuery:"",settings:1===t.settings.length?t.settings[0]:void 0,submittingToken:!1},n}return et(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.fetchInitialData()},t.prototype.componentDidUpdate=function(e){var t=this;0===e.settings.length&&this.props.settings.length>0&&this.setState({settings:1===this.props.settings.length?this.props.settings[0]:void 0},(function(){return t.fetchInitialData()}))},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this.props,t=e.canAdmin,n=e.loadingBindings,a=e.location,o=this.state,i=o.importingGitlabProjectId,c=o.loading,s=o.loadingMore,l=o.projects,u=o.projectsPaging,p=o.tokenIsValid,d=o.searching,m=o.searchQuery,g=o.settings,h=o.submittingToken,b=o.tokenValidationErrorMessage;return r.createElement(Ze,{settings:g,canAdmin:t,importingGitlabProjectId:i,loading:c||n,loadingMore:s,onImport:this.handleImport,onLoadMore:this.handleLoadMore,onPersonalAccessTokenCreate:this.handlePersonalAccessTokenCreate,onSearch:this.handleSearch,projects:l,projectsPaging:u,searching:d,searchQuery:m,showPersonalAccessTokenForm:!p||Boolean(a.query.resetPat),submittingToken:h,tokenValidationErrorMessage:b})},t}(r.PureComponent),ot=n(695),it=n.n(ot),ct=n(724),st=n(1206),lt=n(1207),ut=(n(2041),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),pt=function(e){function t(t){var n=e.call(this,t)||this;return n.mounted=!1,n.checkFreeKey=function(e){return Object(ct.f)({component:e}).then((function(t){n.mounted&&e===n.state.projectKey&&(t?n.setState({projectKeyError:Object(o.translate)("onboarding.create_project.project_key.taken"),touched:!0,validating:!1}):n.setState({projectKeyError:void 0,validating:!1}))})).catch((function(){n.mounted&&e===n.state.projectKey&&n.setState({projectKeyError:void 0,validating:!1})}))},n.handleFormSubmit=function(e){e.preventDefault();var t=n.state;n.canSubmit(t)&&(n.setState({submitting:!0}),Object(ct.c)({project:t.projectKey,name:(t.projectName||t.projectKey).trim()}).then((function(e){var t=e.project;return n.props.onProjectCreate([t.key])}),(function(){n.mounted&&n.setState({submitting:!1})})))},n.handleProjectKeyChange=function(e){var t=e.currentTarget.value||"",r=n.validateKey(t);n.setState((function(e){var a=e.projectNameChanged?e.projectName:t;return{projectKey:t,projectKeyError:r,projectName:a,projectNameError:n.validateName(a),touched:!0,validating:void 0===r}})),void 0===r&&n.checkFreeKey(t)},n.handleProjectNameChange=function(e){var t=e.currentTarget.value;n.setState({projectName:t,projectNameChanged:!0,projectNameError:n.validateName(t)})},n.validateKey=function(e){var t=Object(lt.a)(e);return t===Xe.b.Valid?void 0:Object(o.translate)("onboarding.create_project.project_key.error",t)},n.validateName=function(e){return 0===e.length?Object(o.translate)("onboarding.create_project.display_name.error.empty"):e.length>255?Object(o.translate)("onboarding.create_project.display_name.error.too_long"):void 0},n.state={projectKey:"",projectName:"",projectNameChanged:!1,submitting:!1,touched:!1,validating:!1},n.checkFreeKey=Ce()(n.checkFreeKey,250),n}return ut(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.canSubmit=function(e){var t=e.projectKey,n=e.projectKeyError,r=e.projectName,a=e.projectNameError;return Boolean(void 0===n&&void 0===a&&t.length>0&&r.length>0)},t.prototype.render=function(){var e=this.state,t=e.projectKey,n=e.projectKeyError,a=e.projectName,i=e.projectNameError,c=e.submitting,s=e.touched,l=e.validating,u=s&&void 0!==i,p=s&&void 0===i;return r.createElement(r.Fragment,null,r.createElement(te,{title:Object(o.translate)("onboarding.create_project.setup_manually")}),r.createElement("div",{className:"create-project-manual"},r.createElement("div",{className:"flex-1 huge-spacer-right"},r.createElement("form",{className:"manual-project-create",onSubmit:this.handleFormSubmit},r.createElement(it.a,{className:"big-spacer-bottom"}),r.createElement(st.a,{error:n,help:Object(o.translate)("onboarding.create_project.project_key.help"),label:Object(o.translate)("onboarding.create_project.project_key"),onProjectKeyChange:this.handleProjectKeyChange,projectKey:t,touched:s,validating:l}),r.createElement(I.a,{className:"form-field",description:Object(o.translate)("onboarding.create_project.display_name.description"),error:i,help:Object(o.translate)("onboarding.create_project.display_name.help"),id:"project-name",isInvalid:u,isValid:p,label:Object(o.translate)("onboarding.create_project.display_name"),required:!0},r.createElement("input",{className:A("input-super-large",{"is-invalid":u,"is-valid":p}),id:"project-name",maxLength:255,minLength:1,onChange:this.handleProjectNameChange,type:"text",value:a})),r.createElement(S.SubmitButton,{disabled:!this.canSubmit(this.state)||c},Object(o.translate)("set_up")),r.createElement(R.a,{className:"spacer-left",loading:c})))))},t}(r.PureComponent),dt=(n(2043),function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}()),mt=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={azureSettings:[],bitbucketSettings:[],githubSettings:[],gitlabSettings:[],loading:!0},t.fetchAlmBindings=function(){t.setState({loading:!0}),Object(i.j)().then((function(e){t.mounted&&t.setState({azureSettings:e.filter((function(e){return e.alm===p.a.Azure})),bitbucketSettings:e.filter((function(e){return e.alm===p.a.BitbucketServer})),githubSettings:e.filter((function(e){return e.alm===p.a.GitHub})),gitlabSettings:e.filter((function(e){return e.alm===p.a.GitLab})),loading:!1})})).catch((function(){t.mounted&&t.setState({loading:!1})}))},t.handleModeSelect=function(e){var n=t.props,r=n.router,a=n.location;r.push({pathname:a.pathname,query:{mode:e}})},t.handleProjectCreate=function(e){1===e.length&&t.props.router.push(Object(u.v)(e[0]))},t}return dt(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.fetchAlmBindings()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.renderForm=function(e){var t,n=this.props,a=n.appState.canAdmin,o=n.location,i=n.router,c=this.state,s=c.azureSettings,l=c.bitbucketSettings,u=c.githubSettings,d=c.gitlabSettings,m=c.loading;switch(e){case q.AzureDevOps:return r.createElement(ue,{canAdmin:!!a,loadingBindings:m,location:o,onProjectCreate:this.handleProjectCreate,router:i,settings:s});case q.BitbucketServer:return r.createElement(Pe,{canAdmin:!!a,bitbucketSettings:l,loadingBindings:m,location:o,onProjectCreate:this.handleProjectCreate});case q.GitHub:return r.createElement(Ge,{canAdmin:!!a,loadingBindings:m,location:o,onProjectCreate:this.handleProjectCreate,router:i,settings:u});case q.GitLab:return r.createElement(at,{canAdmin:!!a,loadingBindings:m,location:o,onProjectCreate:this.handleProjectCreate,router:i,settings:d});case q.Manual:return r.createElement(pt,{onProjectCreate:this.handleProjectCreate});default:var g=((t={})[p.a.Azure]=s.length,t[p.a.BitbucketServer]=l.length,t[p.a.GitHub]=u.length,t[p.a.GitLab]=d.length,t);return r.createElement(Ae,{almCounts:g,loadingBindings:m,onSelectMode:this.handleModeSelect})}},t.prototype.render=function(){var e,t=null===(e=this.props.location.query)||void 0===e?void 0:e.mode;return r.createElement(r.Fragment,null,r.createElement(a.a,{title:Object(o.translate)("my_account.create_new.TRK"),titleTemplate:"%s"}),r.createElement(c.a,{anchor:"create_project_main"}),r.createElement("div",{className:"page page-limited huge-spacer-bottom position-relative",id:"create-project"},this.renderForm(t)))},t}(r.PureComponent);t.default=Object(s.a)(Object(l.a)(mt))},717:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r,a=n(13),o=n(176),i=n(781),c=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),s=function(){return(s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function l(e){return a.createElement(i.a.Consumer,null,(function(t){var n=t.addA11ySkipLink,r=t.removeA11ySkipLink;return a.createElement(u,s({addA11ySkipLink:n,removeA11ySkipLink:r},e))}))}var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.getLink=function(){var e=t.props,n=e.anchor,r=e.label;return{key:n,label:void 0===r?Object(o.translate)("skip_to_content"):r,weight:e.weight}},t}return c(t,e),t.prototype.componentDidMount=function(){this.props.addA11ySkipLink(this.getLink())},t.prototype.componentWillUnmount=function(){this.props.removeA11ySkipLink(this.getLink())},t.prototype.render=function(){var e=this.props.anchor;return a.createElement("span",{id:"a11y_target__"+e})},t}(a.PureComponent)},832:function(e,t,n){"use strict";n.d(t,"i",(function(){return o})),n.d(t,"j",(function(){return i})),n.d(t,"k",(function(){return c})),n.d(t,"w",(function(){return s})),n.d(t,"e",(function(){return l})),n.d(t,"u",(function(){return u})),n.d(t,"b",(function(){return p})),n.d(t,"r",(function(){return d})),n.d(t,"d",(function(){return m})),n.d(t,"t",(function(){return g})),n.d(t,"c",(function(){return h})),n.d(t,"s",(function(){return b})),n.d(t,"f",(function(){return f})),n.d(t,"v",(function(){return j})),n.d(t,"g",(function(){return y})),n.d(t,"a",(function(){return v})),n.d(t,"l",(function(){return _})),n.d(t,"h",(function(){return k})),n.d(t,"m",(function(){return E})),n.d(t,"n",(function(){return O})),n.d(t,"o",(function(){return S})),n.d(t,"p",(function(){return N})),n.d(t,"q",(function(){return P}));var r=n(49),a=n(673);function o(){return Object(r.getJSON)("/api/alm_settings/list_definitions")}function i(e){return c(e).catch(a.a)}function c(e){return Object(r.getJSON)("/api/alm_settings/list",{project:e}).then((function(e){return e.almSettings}))}function s(e){return Object(r.get)("/api/alm_settings/validate",{key:e}).then((function(){return""})).catch((function(e){return e.status===r.HttpStatus.BadRequest?Object(r.parseError)(e):Object(a.a)(e)}))}function l(e){return Object(r.post)("/api/alm_settings/create_github",e).catch(a.a)}function u(e){return Object(r.post)("/api/alm_settings/update_github",e).catch(a.a)}function p(e){return Object(r.post)("/api/alm_settings/create_azure",e).catch(a.a)}function d(e){return Object(r.post)("/api/alm_settings/update_azure",e).catch(a.a)}function m(e){return Object(r.post)("/api/alm_settings/create_bitbucket",e).catch(a.a)}function g(e){return Object(r.post)("/api/alm_settings/update_bitbucket",e).catch(a.a)}function h(e){return Object(r.post)("/api/alm_settings/create_bitbucketcloud",e).catch(a.a)}function b(e){return Object(r.post)("/api/alm_settings/update_bitbucketcloud",e).catch(a.a)}function f(e){return Object(r.post)("/api/alm_settings/create_gitlab",e).catch(a.a)}function j(e){return Object(r.post)("/api/alm_settings/update_gitlab",e).catch(a.a)}function y(e){return Object(r.post)("/api/alm_settings/delete",{key:e}).catch(a.a)}function v(e){return Object(r.getJSON)("/api/alm_settings/count_binding",{almSetting:e}).then((function(e){return e.projects})).catch(a.a)}function _(e){return Object(r.getJSON)("/api/alm_settings/get_binding",{project:e})}function k(e){return Object(r.post)("/api/alm_settings/delete_binding",{project:e}).catch(a.a)}function E(e){return Object(r.post)("/api/alm_settings/set_azure_binding",e).catch(a.a)}function O(e){return Object(r.post)("/api/alm_settings/set_bitbucket_binding",e).catch(a.a)}function S(e){return Object(r.post)("/api/alm_settings/set_bitbucketcloud_binding",e).catch(a.a)}function N(e){return Object(r.post)("/api/alm_settings/set_github_binding",e).catch(a.a)}function P(e){return Object(r.post)("/api/alm_settings/set_gitlab_binding",e).catch(a.a)}},833:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(13),a=n(667),o=n(672),i=n.n(o),c=n(732),s=n.n(c),l=n(774);function u(e){var t=e.className,n=e.content,o=e.links,c=e.title;return r.createElement(i.a,{className:t,overlay:r.createElement("div",{className:"big-padded-top big-padded-bottom"},c&&r.createElement("div",{className:"spacer-bottom"},r.createElement("strong",null,c)),n&&r.createElement("p",null,n),o&&r.createElement(r.Fragment,null,r.createElement("hr",{className:"big-spacer-top big-spacer-bottom"}),o.map((function(e){var t=e.href,n=e.label,o=e.inPlace;return r.createElement("div",{className:"little-spacer-bottom",key:n},o?r.createElement(a.c,{to:t},r.createElement("span",null,n)):r.createElement("a",{className:"display-inline-flex-center link-with-icon",href:t,rel:"noopener noreferrer",target:"_blank"},Object(l.isWebUri)(t)&&r.createElement(s.a,{size:14,className:"spacer-right"}),r.createElement("span",null,n)))}))))},e.children)}},968:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"d",(function(){return i})),n.d(t,"e",(function(){return c}));var r="almintegration",a="exclusions",o="languages",i="new_code_period",c="pull_request_decoration_binding"},988:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var r,a=n(13),o=n(180),i=n.n(o),c=n(702),s=n(875),l=n(773),u=(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),p=function(){return(p=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function d(e){var t=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return u(n,t),n.prototype.componentDidMount=function(){Object(c.b)(this.props.currentUser)||i()()},n.prototype.render=function(){return Object(c.b)(this.props.currentUser)?a.createElement(e,p({},this.props)):null},n.displayName=Object(s.a)(e,"whenLoggedIn"),n}(a.Component);return Object(l.a)(t)}}}]);
//# sourceMappingURL=313.1648830816893.chunk.js.map