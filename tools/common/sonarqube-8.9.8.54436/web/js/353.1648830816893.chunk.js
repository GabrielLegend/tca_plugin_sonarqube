(window.webpackJsonp=window.webpackJsonp||[]).push([[353],{1302:function(e,t,o){"use strict";var n,r=o(660),s=o(13),i=o(746),a=o.n(i),p=o(176),l=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return l(t,e),t.prototype.render=function(){var e=this;return s.createElement("div",{className:r(this.props.className)},["public","private"].map((function(t){return s.createElement(a.a,{className:"huge-spacer-right visibility-"+t,key:t,value:t,checked:e.props.visibility===t,onCheck:e.props.onChange,disabled:"private"===t&&!e.props.canTurnToPrivate},s.createElement("div",null,Object(p.translate)("visibility",t),e.props.showDetails&&s.createElement("p",{className:"note"},Object(p.translate)("visibility",t,"description.long"))))})))},t}(s.PureComponent);t.a=c},1303:function(e,t,o){"use strict";var n,r=o(13),s=o(661),i=o(697),a=o.n(i),p=o(681),l=o.n(p),c=o(671),u=o(668),m=o.n(u),d=o(688),g=o.n(d),f=o(695),h=o.n(f),y=o(176),v=o(873),P=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),b=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={done:!1,loading:!0},t.fetchPermissionTemplates=function(){Object(v.l)().then((function(e){var o=e.permissionTemplates;t.mounted&&t.setState({loading:!1,permissionTemplates:o})}),(function(){t.mounted&&t.setState({loading:!1})}))},t.handleSubmit=function(){return t.state.permissionTemplate?Object(v.b)({projectKey:t.props.project.key,templateId:t.state.permissionTemplate}).then((function(){t.mounted&&(t.props.onApply&&t.props.onApply(),t.setState({done:!0}))})):Promise.reject(void 0)},t.handlePermissionTemplateChange=function(e){var o=e.value;t.setState({permissionTemplate:o})},t}return P(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.fetchPermissionTemplates()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this,t=Object(y.translateWithParameters)("projects_role.apply_template_to_xxx",this.props.project.name);return r.createElement(l.a,{header:t,onClose:this.props.onClose,onSubmit:this.handleSubmit,size:"small"},(function(o){var n=o.onCloseClick,i=o.onFormSubmit,p=o.submitting;return r.createElement("form",{id:"project-permissions-apply-template-form",onSubmit:i},r.createElement("header",{className:"modal-head"},r.createElement("h2",null,t)),r.createElement("div",{className:"modal-body"},e.state.done&&r.createElement(c.Alert,{variant:"success"},Object(y.translate)("projects_role.apply_template.success")),e.state.loading&&r.createElement("i",{className:"spinner"}),!e.state.done&&!e.state.loading&&r.createElement(r.Fragment,null,r.createElement(h.a,{className:"modal-field"}),r.createElement("div",{className:"modal-field"},r.createElement("label",{htmlFor:"project-permissions-template"},Object(y.translate)("template"),r.createElement(g.a,null)),e.state.permissionTemplates&&r.createElement(a.a,{clearable:!1,id:"project-permissions-template",onChange:e.handlePermissionTemplateChange,options:e.state.permissionTemplates.map((function(e){return{label:e.name,value:e.id}})),value:e.state.permissionTemplate})))),r.createElement("footer",{className:"modal-foot"},r.createElement(m.a,{className:"spacer-right",loading:p}),!e.state.done&&r.createElement(s.SubmitButton,{disabled:p||!e.state.permissionTemplate},Object(y.translate)("apply")),r.createElement(s.ResetButtonLink,{onClick:n},Object(y.translate)(e.state.done?"close":"cancel"))))}))},t}(r.PureComponent);t.a=b},2208:function(e,t,o){"use strict";o.r(t);var n,r=o(674),s=o(676),i=o(701),a=o.n(i),p=o(13),l=o(684),c=o(176),u=o(873),m=o(1302),d=(o(1300),o(699)),g=o.n(d),f=o(1327),h=o(1301),y=o(967),v=(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),P=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleToggleUser=function(e,o){return e.permissions.includes(o)?t.props.revokePermissionFromUser(e.login,o):t.props.grantPermissionToUser(e.login,o)},t.handleToggleGroup=function(e,o){return e.permissions.includes(o)?t.props.revokePermissionFromGroup(e.name,o):t.props.grantPermissionToGroup(e.name,o)},t.handleSelectPermission=function(e){t.props.onPermissionSelect(e)},t}return v(t,e),t.prototype.render=function(){var e=this.props,t=e.filter,o=e.groups,n=e.groupsPaging,r=e.users,s=e.usersPaging,i=y.a[this.props.component.qualifier];"public"===this.props.visibility&&(i=a()(i,"user","codeviewer"));var l=Object(y.d)(i,"projects_role"),c=0,u=0;return"users"!==t&&(c+=o.length,u+=n?n.total:o.length),"groups"!==t&&(c+=r.length,u+=s?s.total:r.length),p.createElement(p.Fragment,null,p.createElement(f.a,{filter:this.props.filter,groups:this.props.groups,onSelectPermission:this.handleSelectPermission,onToggleGroup:this.handleToggleGroup,onToggleUser:this.handleToggleUser,permissions:l,query:this.props.query,selectedPermission:this.props.selectedPermission,users:this.props.users},p.createElement(h.a,{filter:this.props.filter,onFilter:this.props.onFilterChange,onSearch:this.props.onQueryChange,query:this.props.query})),p.createElement(g.a,{count:c,loadMore:this.props.onLoadMore,total:u}))},t}(p.PureComponent),b=o(661),_=o(686),j=o(1303),O=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),T=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.mounted=!1,t.state={applyTemplateModal:!1},t.handleApplyTemplate=function(){t.setState({applyTemplateModal:!0})},t.handleApplyTemplateClose=function(){t.mounted&&t.setState({applyTemplateModal:!1})},t}return O(t,e),t.prototype.componentDidMount=function(){this.mounted=!0},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this.props.component,t=e.configuration,o=null!=t&&t.canApplyPermissionTemplate,n=Object(c.translate)("roles.page.description2");Object(_.e)(e.qualifier)?n=Object(c.translate)("roles.page.description_portfolio"):Object(_.d)(e.qualifier)&&(n=Object(c.translate)("roles.page.description_application"));var r="TRK"===e.qualifier&&e.visibility?Object(c.translate)("visibility",e.visibility,"description",e.qualifier):void 0;return p.createElement("header",{className:"page-header"},p.createElement("h1",{className:"page-title"},Object(c.translate)("permissions.page")),this.props.loading&&p.createElement("i",{className:"spinner"}),o&&p.createElement("div",{className:"page-actions"},p.createElement(b.Button,{className:"js-apply-template",onClick:this.handleApplyTemplate},Object(c.translate)("projects_role.apply_template")),this.state.applyTemplateModal&&p.createElement(j.a,{onApply:this.props.loadHolders,onClose:this.handleApplyTemplateClose,project:e})),p.createElement("div",{className:"page-description"},p.createElement("p",null,n),r&&p.createElement("p",null,r)))},t}(p.PureComponent),C=o(706),E=o.n(C),S=o(671);function k(e){var t=e.component,o=e.onClose,n=e.onConfirm,r=t.qualifier;return p.createElement(E.a,{confirmButtonText:Object(c.translate)("projects_role.turn_project_to_public",r),header:Object(c.translateWithParameters)("projects_role.turn_x_to_public",t.name),onClose:o,onConfirm:n},p.createElement(S.Alert,{variant:"warning"},Object(c.translate)("projects_role.are_you_sure_to_turn_project_to_public.warning",r)),p.createElement("p",null,Object(c.translate)("projects_role.are_you_sure_to_turn_project_to_public",r)))}var U=function(){var e=function(t,o){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(t,o)};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),F=function(){return(F=Object.assign||function(e){for(var t,o=1,n=arguments.length;o<n;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)},w=function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var n=Array(e),r=0;for(t=0;t<o;t++)for(var s=arguments[t],i=0,a=s.length;i<a;i++,r++)n[r]=s[i];return n},N=function(e){function t(t){var o=e.call(this,t)||this;return o.mounted=!1,o.stopLoading=function(){o.mounted&&o.setState({loading:!1})},o.loadUsersAndGroups=function(e,t){var n=o.props.component,r=o.state,s=r.filter,i=r.query,a=r.selectedPermission,p="groups"!==s?u.n({projectKey:n.key,q:i||void 0,permission:a,p:e}):Promise.resolve({paging:void 0,users:[]}),l="users"!==s?u.m({projectKey:n.key,q:i||void 0,permission:a,p:t}):Promise.resolve({paging:void 0,groups:[]});return Promise.all([p,l])},o.loadHolders=function(){return o.setState({loading:!0}),o.loadUsersAndGroups().then((function(e){var t=e[0],n=e[1];o.mounted&&o.setState({groups:n.groups,groupsPaging:n.paging,loading:!1,users:t.users,usersPaging:t.paging})}),o.stopLoading)},o.onLoadMore=function(){var e=o.state,t=e.usersPaging,n=e.groupsPaging;return o.setState({loading:!0}),o.loadUsersAndGroups(t?t.pageIndex+1:1,n?n.pageIndex+1:1).then((function(e){var t=e[0],n=e[1];o.mounted&&o.setState((function(e){var o=e.groups,r=e.users;return{groups:w(o,n.groups),groupsPaging:n.paging,loading:!1,users:w(r,t.users),usersPaging:t.paging}}))}),o.stopLoading)},o.handleFilterChange=function(e){o.mounted&&o.setState({filter:e},o.loadHolders)},o.handleQueryChange=function(e){o.mounted&&o.setState({query:e},o.loadHolders)},o.handlePermissionSelect=function(e){o.mounted&&o.setState((function(t){return{selectedPermission:t.selectedPermission===e?void 0:e}}),o.loadHolders)},o.addPermissionToGroup=function(e,t){return o.state.groups.map((function(o){return o.name===e?F(F({},o),{permissions:w(o.permissions,[t])}):o}))},o.addPermissionToUser=function(e,t){return o.state.users.map((function(o){return o.login===e?F(F({},o),{permissions:w(o.permissions,[t])}):o}))},o.removePermissionFromGroup=function(e,t){return o.state.groups.map((function(o){return o.name===e?F(F({},o),{permissions:a()(o.permissions,t)}):o}))},o.removePermissionFromUser=function(e,t){return o.state.users.map((function(o){return o.login===e?F(F({},o),{permissions:a()(o.permissions,t)}):o}))},o.grantPermissionToGroup=function(e,t){return o.mounted?(o.setState({loading:!0,groups:o.addPermissionToGroup(e,t)}),u.o({projectKey:o.props.component.key,groupName:e,permission:t}).then(o.stopLoading,(function(){o.mounted&&o.setState({loading:!1,groups:o.removePermissionFromGroup(e,t)})}))):Promise.resolve()},o.grantPermissionToUser=function(e,t){return o.mounted?(o.setState({loading:!0,users:o.addPermissionToUser(e,t)}),u.p({projectKey:o.props.component.key,login:e,permission:t}).then(o.stopLoading,(function(){o.mounted&&o.setState({loading:!1,users:o.removePermissionFromUser(e,t)})}))):Promise.resolve()},o.revokePermissionFromGroup=function(e,t){return o.mounted?(o.setState({loading:!0,groups:o.removePermissionFromGroup(e,t)}),u.t({projectKey:o.props.component.key,groupName:e,permission:t}).then(o.stopLoading,(function(){o.mounted&&o.setState({loading:!1,groups:o.addPermissionToGroup(e,t)})}))):Promise.resolve()},o.revokePermissionFromUser=function(e,t){return o.mounted?(o.setState({loading:!0,users:o.removePermissionFromUser(e,t)}),u.u({projectKey:o.props.component.key,login:e,permission:t}).then(o.stopLoading,(function(){o.mounted&&o.setState({loading:!1,users:o.addPermissionToUser(e,t)})}))):Promise.resolve()},o.handleVisibilityChange=function(e){"public"===e?o.openDisclaimer():o.turnProjectToPrivate()},o.turnProjectToPublic=function(){o.props.onComponentChange({visibility:"public"}),u.e(o.props.component.key,"public").then((function(){o.loadHolders()}),(function(){o.props.onComponentChange({visibility:"private"})}))},o.turnProjectToPrivate=function(){o.props.onComponentChange({visibility:"private"}),u.e(o.props.component.key,"private").then((function(){o.loadHolders()}),(function(){o.props.onComponentChange({visibility:"public"})}))},o.openDisclaimer=function(){o.mounted&&o.setState({disclaimer:!0})},o.closeDisclaimer=function(){o.mounted&&o.setState({disclaimer:!1})},o.state={disclaimer:!1,filter:"all",groups:[],loading:!0,query:"",users:[]},o}return U(t,e),t.prototype.componentDidMount=function(){this.mounted=!0,this.loadHolders()},t.prototype.componentWillUnmount=function(){this.mounted=!1},t.prototype.render=function(){var e=this.props.component,t=e.configuration&&e.configuration.canUpdateProjectVisibilityToPrivate;return p.createElement("div",{className:"page page-limited",id:"project-permissions-page"},p.createElement(l.a,{defer:!1,title:Object(c.translate)("permissions.page")}),p.createElement(T,{component:e,loadHolders:this.loadHolders,loading:this.state.loading}),p.createElement("div",null,p.createElement(m.a,{canTurnToPrivate:t,className:"big-spacer-top big-spacer-bottom",onChange:this.handleVisibilityChange,visibility:e.visibility}),this.state.disclaimer&&p.createElement(k,{component:e,onClose:this.closeDisclaimer,onConfirm:this.turnProjectToPublic})),p.createElement(P,{component:e,filter:this.state.filter,grantPermissionToGroup:this.grantPermissionToGroup,grantPermissionToUser:this.grantPermissionToUser,groups:this.state.groups,groupsPaging:this.state.groupsPaging,onFilterChange:this.handleFilterChange,onLoadMore:this.onLoadMore,onPermissionSelect:this.handlePermissionSelect,onQueryChange:this.handleQueryChange,query:this.state.query,revokePermissionFromGroup:this.revokePermissionFromGroup,revokePermissionFromUser:this.revokePermissionFromUser,selectedPermission:this.state.selectedPermission,users:this.state.users,usersPaging:this.state.usersPaging,visibility:e.visibility}))},t}(p.PureComponent);t.default=Object(r.b)((function(e){return{currentUser:Object(s.getCurrentUser)(e)}}))(N)}}]);
//# sourceMappingURL=353.1648830816893.chunk.js.map